// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0:2 = call @inputs() : () -> (tensor<2x3x10xf32>, tensor<3x3x5xf32>)
    %1 = call @expected() : () -> tensor<2x3x6xf32>
    %2 = stablehlo.convolution(%0#0, %0#1) dim_numbers = [b, f, 0]x[o, i, 0]->[b, f, 0], window = {} {batch_group_count = 1 : i64, feature_group_count = 1 : i64} : (tensor<2x3x10xf32>, tensor<3x3x5xf32>) -> tensor<2x3x6xf32>
    %3 = stablehlo.custom_call @check.eq(%2, %1) : (tensor<2x3x6xf32>, tensor<2x3x6xf32>) -> tensor<i1>
    return %3 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<2x3x10xf32>, tensor<3x3x5xf32>) {
    %0 = stablehlo.constant dense<[[[-2.39628553, -2.61640573, -1.71100402, 0.754390299, 4.43838644, 0.543790221, -4.81503296, 2.85119772, 0.0272705927, -1.70016646], [3.82113361, -0.536128283, -2.83340192, -3.46321607, 1.16630661, -2.06615543, 0.120180897, -0.32935223, 2.26144934, -2.39108396], [-1.33467293, 0.329310775, 1.34398723, 2.51446867, 2.428520e+00, 3.4680829, -3.10366297, 3.0266571, 2.62947488, -0.478714615]], [[-4.57713127, -3.58981895, 1.54749513, 0.514547884, 2.09321499, -0.390078187, -0.13165769, 5.04404354, 0.0416141041, 0.771804571], [3.50332165, 4.41446114, 5.62385559, -5.87154913, -4.40485573, 6.00450706, 6.13054466, 8.6186285, -0.558318675, -4.69300604], [-0.848347127, -0.702094197, -1.04472029, -0.052434817, -1.83562136, -3.88773799, 3.57837367, -2.34969687, 1.86881018, -1.13490331]]]> : tensor<2x3x10xf32>
    %1 = stablehlo.constant dense<[[[7.660650e-01, 3.57861495, 6.736780e+00, -3.81931186, -3.55869794], [-3.55001354, 0.11664889, 4.946780e+00, -2.04585624, -5.01829767], [1.09930515, 3.48784447, 3.81765532, -3.41729975, 2.87953019]], [[1.07684827, 2.18463969, -1.48767233, 1.09800053, 0.996845901], [2.23116779, -1.94385302, 1.27256846, -0.673200488, -1.19993186], [0.76928246, 3.64450717, 0.108128168, -1.11739159, 1.73053598]], [[5.4585433, 0.812036573, -1.19025648, -0.801120817, -1.12692165], [0.858582735, -0.642224252, 3.22822118, 0.577595055, -0.287795871], [-1.0398047, -0.445783377, -3.34618831, 2.61982918, 1.01340723]]]> : tensor<3x3x5xf32>
    return %0, %1 : tensor<2x3x10xf32>, tensor<3x3x5xf32>
  }
  func.func private @expected() -> tensor<2x3x6xf32> {
    %0 = stablehlo.constant dense<[[[-64.6005173, -13.1720247, 64.1259765, 75.7806625, -52.3943367, 15.6097279], [8.10753154, 8.04759788, -6.64463901, 14.8116179, 35.9085655, -31.8386917], [-20.8398323, -28.7684898, -1.139490e+01, -22.8750305, 46.8684464, -9.30794429]], [[22.1968269, -75.071373, -51.1515579, -58.2465324, 23.2354698, 66.6141129], [-3.23387218, -21.1651211, 15.4175558, -15.9901562, -20.9873314, 16.8030148], [-13.6150389, -50.6145439, 3.61083722, 38.5015564, 11.8753338, 34.9818726]]]> : tensor<2x3x6xf32>
    return %0 : tensor<2x3x6xf32>
  }
}

