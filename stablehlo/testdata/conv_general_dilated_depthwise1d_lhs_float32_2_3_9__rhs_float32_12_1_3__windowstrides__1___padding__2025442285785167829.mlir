// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0:2 = call @inputs() : () -> (tensor<2x3x9xf32>, tensor<12x1x3xf32>)
    %1 = call @expected() : () -> tensor<2x12x7xf32>
    %2 = stablehlo.convolution(%0#0, %0#1) dim_numbers = [b, f, 0]x[o, i, 0]->[b, f, 0], window = {} {batch_group_count = 1 : i64, feature_group_count = 3 : i64} : (tensor<2x3x9xf32>, tensor<12x1x3xf32>) -> tensor<2x12x7xf32>
    %3 = stablehlo.custom_call @check.eq(%2, %1) : (tensor<2x12x7xf32>, tensor<2x12x7xf32>) -> tensor<i1>
    return %3 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<2x3x9xf32>, tensor<12x1x3xf32>) {
    %0 = stablehlo.constant dense<[[[-1.96511757, -5.55958605, -1.50374639, 1.2120446, 3.21186447, 1.02349842, 5.26346111, -0.576352775, -2.11138129], [2.14414096, -1.50321436, 2.67583466, 4.80866337, 1.8576318, -4.17470455, -0.173302904, -6.73420906, -0.265416831], [-0.179974869, 2.97624516, -4.66533756, 2.16204596, 3.08222961, 2.36635828, -0.860805928, 3.5810957, 3.5065918]], [[1.85445964, 3.97995543, 0.977302432, 2.28219128, 1.52758765, 3.04823041, 0.792750239, -2.62015224, 0.797125578], [1.68729472, 4.16192293, -0.865549385, -1.65564895, 1.02495849, 3.03293586, 1.41485655, 2.36943197, -2.79530549], [2.75504136, -0.195227623, -3.81070256, 0.56287992, -3.70327806, -1.78669858, 0.2387449, -3.83501959, -2.27439022]]]> : tensor<2x3x9xf32>
    %1 = stablehlo.constant dense<[[[-1.80246711, 1.96004879, -0.605032503]], [[4.45640278, -5.46205235, 1.1135869]], [[-4.13330603, -3.73956728, -4.24840975]], [[3.73067904, -4.542027, -2.5989809]], [[-0.119584844, -0.0161871985, -0.134076193]], [[1.08771026, -2.79720259, 2.24169183]], [[-2.83143401, 0.309991777, 2.02455497]], [[-1.20667934, -0.505252481, 2.85701632]], [[0.257799268, 1.51054871, -1.96405339]], [[-0.451475561, 0.847560584, -1.11103594]], [[-0.222673655, 4.257411, -3.94667459]], [[-0.5362221, 2.006420e+00, 0.046573516]]]> : tensor<12x1x3xf32>
    return %0, %1 : tensor<2x3x9xf32>, tensor<12x1x3xf32>
  }
  func.func private @expected() -> tensor<2x12x7xf32> {
    %0 = stablehlo.constant dense<"0xF53ECEC027E3CA404124494096745F40B6F7DEC0E5200D415A6E15C18E7A9F41636673C1F2EA1BC13F0930C137596941D6A3C6C11306C241A5340D42EAA0BB41F8653FC1A9F3AAC18BDB1DC226B8ABC130152AC155A1AE410B7D88C1A1B39BC17AA04BC11512CBC05CB994C1A9EEDD41454117BFA21E02BFBB9A25BF33E539BDE87B06BEDFD4B33F3D49293EFB904841B36ED43F7A08CCC0AF2F15C1FDF354418E3799C17D6D9041264F8FBF66236D4194CB14C08EEEABC1B0F3DCC016FDEEBFCF9608C0CF25BA40A8346341BFCDB3BEA75895C14A9E20BF9FD561C1699C364023CC5941CE6B28C17D647FC0B9C9103F97E9C1409C28F7C0738DD9BF6B30F9402566F6C00BA8033FFF2A7EBF0F05C93F6FDAB8C0DDB9F1BE6DFDF8418B76E8C107E3F5BF174E53409C914C41E89992C1969BCC3FF139BB409BB12DC13576DF40E652A44011864340641235C02BECF940017D77408372D4C0DDC9E43F5FAD3DC09B762F4011BC16C08B7FE1C0DB2D46C1B4086F414B17CDC00013A74018590FC13AC3CA40EADA95414D9AD5C1EE67EEC17E8298C1E1C3E0C1D8A5A8C1AAD58DC082A44840B72D5BC1C0488F40020A2BC1A516CBC0064E23C1C94B6941DA954C41FBC41CBEB8FE85BE412AE9BBACA666BE8C04B9BE2B0A34BF683F2B3EAFF23BC1EB244F407498BF40B5620840834F86C028E494403FAE35C13FABA7C0BC7876C12A678040C0553241B80C673FD68556C0A2E40EC15493D3C03F0A15C1A8E599406B52224114F4A23F7845194032402EC1EBCAFC40FD2FDDC08185E4401948F8BF90EB83C0A9D4ED4040D8A1BF0AC53440311771C0D0FBC9408D32B4BF9377DCBD94A2A84018CE54BFF8845941CD3693C17CE28E4173710DC1C22DF7C01D668441B4EEECC0DDF902C0A07AF0C09D0440408817FAC08F42CBBFDA15A13F25B7FDC0"> : tensor<2x12x7xf32>
    return %0 : tensor<2x12x7xf32>
  }
}

