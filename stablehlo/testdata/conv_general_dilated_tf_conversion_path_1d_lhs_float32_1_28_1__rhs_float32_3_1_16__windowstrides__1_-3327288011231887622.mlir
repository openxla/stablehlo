// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0:2 = call @inputs() : () -> (tensor<1x28x1xf32>, tensor<3x1x16xf32>)
    %1 = call @expected() : () -> tensor<1x28x16xf32>
    %2 = stablehlo.convolution(%0#0, %0#1) dim_numbers = [b, 0, f]x[0, i, o]->[b, 0, f], window = {pad = [[1, 1]]} {batch_group_count = 1 : i64, feature_group_count = 1 : i64} : (tensor<1x28x1xf32>, tensor<3x1x16xf32>) -> tensor<1x28x16xf32>
    %3 = stablehlo.custom_call @check.eq(%2, %1) : (tensor<1x28x16xf32>, tensor<1x28x16xf32>) -> tensor<i1>
    return %3 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<1x28x1xf32>, tensor<3x1x16xf32>) {
    %0 = stablehlo.constant dense<[[[-0.467909843], [3.0104866], [1.79241717], [-2.66431046], [0.943148195], [0.417969763], [-3.74905968], [3.16968536], [-5.34840393], [0.546826541], [-2.03253365], [0.221049443], [-1.28537452], [-3.92773461], [-3.46224833], [-6.31273508], [-1.36294055], [-0.348805457], [-1.48003304], [-2.109411], [2.18338346], [2.66028404], [-2.67348027], [-4.70081472], [2.17808843], [-4.80057335], [-0.520323932], [-3.46543169]]]> : tensor<1x28x1xf32>
    %1 = stablehlo.constant dense<[[[1.86612034, -2.69200087, 3.64211726, -0.905698835, -0.781734287, 3.59102416, 1.76857328, -0.165421158, 3.81084895, 2.13960075, 1.54851282, 1.18953419, 2.73690462, 1.39771187, 0.182823494, -2.9513216]], [[4.55942965, -3.55209756, 1.15906274, 1.3861196, -2.87826657, -5.87348413, 2.54662919, 4.35670042, 6.92599821, -3.36722088, 0.160179541, 2.87391615, 0.706002235, 0.168740258, -0.562571108, 0.90919727]], [[1.72864258, 0.410824031, 1.69746757, 3.05829334, -1.61078143, -3.05013394, -1.17601025, -0.797711431, -5.79306793, -4.6189518, -1.4868108, 1.63480639, 2.47044754, 0.880895197, -0.240365773, 1.13968313]]]> : tensor<3x1x16xf32>
    return %0, %1 : tensor<1x28x1xf32>, tensor<3x1x16xf32>
  }
  func.func private @expected() -> tensor<1x28x16xf32> {
    %0 = stablehlo.constant dense<"0x958544409F863940F62B924018EF08416A2860C05DE4CDC02F6C97C0D4148EC01172A5C19A4645C193A191C0C5EA6440C26BE34082AB2440A2B7EBBE665B4040D4387F4135290BC1C47C9A403241214179FB32C1ADA2C6C1A8659740B8363C413EF10A416E569BC1B7113AC0A368304141BBA840E269B73F89700DC0D125C5407DF41241D80C79C1D44F0841CD3E06C121224EC0508D0641B35A504167FB164108491D42BF644B4139900E41F00D8C40970F3B40FA720A4023D03A3EE6AA24C12685E5C062D6A0405050A14034A61BC039F197405CAB99412B2C97C0E3804AC155B088C14B330741C84F723F73E97EC06859AB40C2BC384032C8CC3F5866D4C0BB22503DCA9B7F4097D5FCC0F8F49F40C00DA7BF670E83C1524F33C029EC8640175BC1C030E92CC1271393C0D5ED653E2BFEB2C028954CC09C1F8FBF50271341D22934C0E20AB2C003711CC067D93BC1B32783407EDF45412186E440D7FA944030A9E141176B8F410F40E3405F9373C0B255CCC0CAF5F4BFD8A3563FE5A3D5C075592DC190E757416BAB2340CCCB8340DD77AB40F6A55D41CA9248C1077397C103F12AC28FAB8FBFFC4F95C01C0EA3C0087CCA4083992F40F339B63F37CF83BF7D15E5BFB44857C0A37998C1251609C12B0D1B4072447CC1D866F7407691954166991A42D14DC04051E02940A80083C041E3A9C189AA16C1146D97BFEC3BFB4000348CC1DB092B411BC0C8408ECA09C1419140415E832442C1850AC17318C2C19D0DE1C1711FB241AB444F40A94D2BC16300C840EE4D80400C3E5D40478259C1650430C1A0ED3941F05DB2C1F2331DBFDA31BC408ABF81C16DA3B5C0616E9C40BB3D9AC03C6179C00785A5C062D001C1AC2F9AC17FC712C110014CBF0C735F4116ABFBC018D5BA40FD2A343C6ABD28C0E621A240CDA35341BF018FC06DF311C1546254C15BC6DF40EC28453E2D8B9AC02F941B3FEBB51D3F405B983F246F4DC0B839A0C00B1185401D4115C12B53E4BFCA7A414010A795C0F293C2BFB5C6144020A49D3F1B0D583FB4B699BFA89078C0DB5009C168E57BC08B7A3FBED0829740B3CD43C1C5DA16402043EBC0A3E75FC13AA81D419B96A241C449DE3F0A3720C0A6186B417F8BB741133DBF409BA21DC18C1720C1EA8A57C05093DA3F7784C9C0C655D2C134D57F41C7C671C145E66DC132188F41AB1CE841174403C1083362C18DB740C112BDD34127CD214010D193C102826DC1994BB0C041A33340274C6EC0A31C08C2EE39A2416C45E8C12F62A4C11CA2B9416DE2CB41716F05C1496016C1BE2718C07EA601427CF12F40368AC7C1D650E6C1A2283AC192CF2F40A4F39F3FDE6516C29F78F9412CECB1C109861CC1D492B841426AE641D8C5A4C1EBBDCEC1FB1444C2B526A14105138BC039E9C3C1D5658AC18A5CE3C03DBE4F4034393B40B6C794C1FD88AD41EF4EC9C13CBC3040D6B61641E39959C1959A63C181B193C0BECEFBC12CCDE9C0D79917C157F13FC175CF98C124C515C18D679BBE20F487419C26D6C08F998940C02DFCC0EFA071C06F828E405396D53F3E73C7BFEF88E8BD3CD2763F9E06A34084C80B3D7762A1C03940F4C0852051C08C089B3E513001401CBA30C1298CAA40C120D2C015FD02C1DCC5FD4069FD5D41B1E0F3BF26A596C0B1D7233F61B05F4167FB1640C3DE01C168BEE6C0B31B26C02D50A33FD3182EC07AAF09C131FC45412B2284C00302A340FE886D40F58DD43EF2E928C1C2FD2AC1039803C2B9C2C4C04C08BCC0F11B88C03C8715BE3F5300BF3D58C83E96089E4040E0294100F17BBF6CE422BF652A51415BBA0EC11C1BE4C16642A6BF1EA7F7406F3E05C14139C1C1E1E7DBC0C9D501419EC71540222B72BEB33710C083E13341475139419B6783C1F0EACF40F4EBCEC08DD6A1C02366BD3EFD7B5C41E7C85541EBEE2842ECFF0041CC06F94096E7BB4055E59F3F6FA2923F1DDDE8BE594EE2C05D9E75C1B0BACE3E82CFB1BFE6EEA3C157FF524128601E421E2F5B40546705C117D49641C0A0114234E32A41B04243C16B07C7C04FAD5FBFFFB24740733B7AC16641B5C10D51C6419FD037C1FA442440A0C94141D2DB354164169AC1C533AEC19C745DC268AC443DCC1902C12A1152C1E728A8C09B1F27C0E6ECD03F3F28C3403C7AE4C01A853C4029F6B5C155F5ECC04F6DA440458070C1873A3840B78A6141E3D9C7413D0399400B21543EBEC3E5C00680B9C10FE826C18B4C6EBFEF1F264134C895C14E992F415F23BE3F997D23C18D3E4F413B6B1642485CF8C010E1A6C11679AFC151D3B9416D2858400CE640C163AEA43FFA51E33FFE544E40B22C36C110928AC13590554125C2BFC1E017DFC0BE512D419D3867C0E4ACB7C04E54A53F0249E9BFC198EF407B5617C01FF04DC1AF89B0C1D49A1DC14DFC7D3E6CED1B41C92B86C13E5D5B41EC2CBDC0C2A18AC05C192641A3E2934129ED1BC13B3070C127E0CFC1B1E32841552FAEBFBB4029C137B977C04CF0A7BFC75DED3F2EBCCEBF"> : tensor<1x28x16xf32>
    return %0 : tensor<1x28x16xf32>
  }
}

