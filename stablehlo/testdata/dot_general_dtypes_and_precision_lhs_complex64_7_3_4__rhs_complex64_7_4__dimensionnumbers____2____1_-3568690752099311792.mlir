// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0:2 = call @inputs() : () -> (tensor<7x3x4xcomplex<f32>>, tensor<7x4xcomplex<f32>>)
    %1 = call @expected() : () -> tensor<7x3xcomplex<f32>>
    %2 = "stablehlo.dot_general"(%0#0, %0#1) {dot_dimension_numbers = #stablehlo.dot<lhs_batching_dimensions = [0], rhs_batching_dimensions = [0], lhs_contracting_dimensions = [2], rhs_contracting_dimensions = [1]>, precision_config = [#stablehlo<precision HIGHEST>, #stablehlo<precision HIGHEST>]} : (tensor<7x3x4xcomplex<f32>>, tensor<7x4xcomplex<f32>>) -> tensor<7x3xcomplex<f32>>
    %3 = stablehlo.custom_call @check.eq(%2, %1) : (tensor<7x3xcomplex<f32>>, tensor<7x3xcomplex<f32>>) -> tensor<i1>
    return %3 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<7x3x4xcomplex<f32>>, tensor<7x4xcomplex<f32>>) {
    %0 = stablehlo.constant dense<[[[(2.64786744,0.578804731), (3.87130404,-2.21339417), (-6.37255859,6.43799734), (0.473479837,1.67047405)], [(0.521580875,-6.19362116), (-4.51594782,1.72377729), (-1.89930284,1.68518102), (-2.03340697,-0.908157587)], [(-2.67650604,-6.01287174), (-0.995293676,-3.62344241), (-1.50766909,3.45898581), (6.9606514,4.42985868)]], [[(-1.17530203,1.0884831), (-0.841757595,0.455801189), (-6.55106639,4.96990204), (-1.34493268,-0.929399252)], [(-0.302775562,4.99156618), (1.49342227,0.366397738), (1.06037915,-1.45771551), (0.278123617,0.983347296)], [(3.87577748,-3.43644166), (-2.39048123,0.789392769), (-0.0657871887,-6.142930e+00), (3.33037806,-1.56925416)]], [[(0.150253445,-1.44529712), (-1.36352718,-3.33952451), (-4.42011833,-1.58935702), (2.54911089,0.0484393388)], [(5.28581572,0.621738255), (1.10314846,-0.733065545), (1.59025824,-1.57806754), (1.81223297,-1.2609576)], [(-0.333554268,-4.74057055), (2.91516018,3.89877129), (1.74793851,-4.812470e+00), (-1.3098743,2.61291218)]], [[(4.59124231,-1.301860e+00), (-1.919960e+00,-5.21441889), (3.58353519,-4.72057533), (1.27560163,-1.91787481)], [(-2.16998243,-1.52188838), (0.134248674,-4.6986289), (-0.382684886,2.61957717), (-2.30830812,0.529487669)], [(-3.4509747,2.16808295), (-3.0305829,0.0517795421), (-0.221745521,-0.28922835), (4.38323402,-2.02999353)]], [[(2.43990493,-0.533835173), (-0.840545475,2.40774465), (5.01010084,1.87437809), (1.21859777,2.24911714)], [(-2.10923123,2.55845761), (2.483890e-01,5.57875299), (2.22289062,2.6651752), (-1.7098273,2.1239543)], [(0.373023748,-6.45067358), (-3.32070899,-1.1458919), (0.945634484,0.345725536), (-2.56730032,3.87761426)]], [[(3.73756242,-3.83172846), (0.592238367,1.23425758), (1.367589,5.31334829), (3.68733525,1.58851981)], [(4.62299538,5.095430e+00), (-2.352470e+00,-1.84010422), (-0.845938265,1.8625114), (-2.12645268,-3.45583606)], [(1.36380172,-0.364090532), (-0.668876349,0.173281476), (0.643222987,-5.61517715), (-3.82556868,3.97270274)]], [[(0.246059895,-3.4575069), (2.0132761,-0.446363479), (0.220483109,1.16694295), (4.3117137,-2.00203443)], [(0.00995015725,-3.17411447), (0.283805341,1.95436835), (4.8024106,-4.72358036), (-1.54221749,4.22689247)], [(2.8740561,5.26394463), (1.35790634,3.864645), (-0.212893322,3.04261351), (-0.375027061,4.13953924)]]]> : tensor<7x3x4xcomplex<f32>>
    %1 = stablehlo.constant dense<[[(-3.233120e+00,-3.9479382), (3.43799877,-0.581492841), (1.41147029,-4.80188465), (0.506707668,-1.60773087)], [(-0.0964418947,-3.67133093), (2.64522314,-5.467930e+00), (3.11032104,4.19498682), (-3.64595914,-3.11262345)], [(-3.19592714,4.16196346), (-1.70391273,2.71906447), (-1.06630492,-3.38874102), (-2.39818764,7.78734255)], [(0.50143832,-2.41627812), (4.41110229,-1.30992222), (-3.62958694,1.13207376), (-2.08791137,1.2781204)], [(-1.36976397,1.40066338), (0.28443405,2.00060058), (2.70098972,-7.80675697), (-2.17529225,0.961383998)], [(-0.552950859,6.01673126), (-1.3471204,3.06352019), (-0.301245689,0.0369098485), (-0.535951674,-0.3735075)], [(-0.381186157,1.89493561), (1.87047744,0.535891831), (3.60473824,4.80228758), (1.69589353,-0.852412581)]]> : tensor<7x4xcomplex<f32>>
    return %0, %1 : tensor<7x3x4xcomplex<f32>>, tensor<7x4xcomplex<f32>>
  }
  func.func private @expected() -> tensor<7x3xcomplex<f32>> {
    %0 = stablehlo.constant dense<[[(30.5921097,17.5868053), (-37.7410088,40.8257065), (4.51685429,21.3040829)], [(-34.8387108,5.56948757), (35.7687454,-11.1031551), (-6.45914268,-22.765976)], [(9.77560424,43.6351624), (-20.9370766,37.6911736), (-30.1504593,-2.21282387)], [(-24.0178356,-5.40756655), (-7.76184464,-30.4188709), (-15.2170982,24.263401)], [(15.7015877,-34.6189499), (16.7032242,-20.7940693), (16.9821129,-14.9626045)], [(14.4177971,20.9795437), (-24.372879,22.3239136), (5.35436678,7.13939666)], [(11.2593842,0.222957611), (46.4775162,19.5547256), (-23.0878258,28.6813755)]]> : tensor<7x3xcomplex<f32>>
    return %0 : tensor<7x3xcomplex<f32>>
  }
}
