// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0:2 = call @inputs() : () -> (tensor<7x3x4xcomplex<f32>>, tensor<7x4xcomplex<f32>>)
    %1 = call @expected() : () -> tensor<7x3xcomplex<f32>>
    %2 = "stablehlo.dot_general"(%0#0, %0#1) {dot_dimension_numbers = #stablehlo.dot<lhs_batching_dimensions = [0], rhs_batching_dimensions = [0], lhs_contracting_dimensions = [2], rhs_contracting_dimensions = [1]>, precision_config = [#stablehlo<precision HIGH>, #stablehlo<precision HIGH>]} : (tensor<7x3x4xcomplex<f32>>, tensor<7x4xcomplex<f32>>) -> tensor<7x3xcomplex<f32>>
    %3 = stablehlo.custom_call @check.eq(%2, %1) : (tensor<7x3xcomplex<f32>>, tensor<7x3xcomplex<f32>>) -> tensor<i1>
    return %3 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<7x3x4xcomplex<f32>>, tensor<7x4xcomplex<f32>>) {
    %0 = stablehlo.constant dense<[[[(1.99706984,3.13878345), (-2.78298712,-1.51271307), (-0.898433327,1.23385692), (0.0390163623,-7.41424894)], [(0.813151538,4.07968616), (4.40694571,0.92479813), (-3.90184069,-3.76920938), (-0.26610589,-1.3262198)], [(0.671662509,1.26475918), (3.25713038,2.18041754), (1.45374298,-0.655960977), (0.36766845,2.33382058)]], [[(-1.49737155,7.78983164), (-3.405761,0.744393885), (4.74693394,0.475660414), (0.614024878,1.54391611)], [(7.82753325,0.121993788), (2.52896214,3.87309289), (5.99410105,-8.16199779), (2.28892875,0.64841485)], [(-1.81255007,-6.54357433), (0.757966876,-4.231430e+00), (2.44620323,-1.1016109), (-2.06655335,-0.972732901)]], [[(3.4571209,-0.697918653), (0.033709757,2.04441619), (-0.871799588,0.872971832), (0.2215406,-1.43019617)], [(-2.37656236,5.239350e+00), (-2.4692564,-3.89098477), (-2.64747477,-0.341736615), (5.72943449,3.54396701)], [(-1.08253026,2.68961811), (4.92411566,-3.29879522), (2.40889454,4.08965635), (-2.46673107,6.36178398)]], [[(1.13007522,-3.01360846), (1.61618018,-1.53452086), (-0.486187696,-2.314013), (0.596748888,-2.31998825)], [(1.22317445,-0.437696636), (1.48756433,2.4440279), (2.66835737,-2.76217222), (-3.22994018,1.72078156)], [(2.15094161,5.677000e+00), (3.76954198,-1.97793329), (-2.28699327,2.45025253), (5.68727398,-0.373828918)]], [[(-0.0273099244,-1.72554564), (-2.72638583,-0.839432597), (-1.22191334,0.517278075), (3.30784249,-4.47349882)], [(4.62661457,2.83872056), (0.353453428,2.2992022), (0.238971844,0.0910244807), (7.4716854,-2.958880e+00)], [(-2.06831837,0.217164844), (-1.71123993,1.97663271), (3.48192048,3.16755462), (0.398250163,-0.675359189)]], [[(0.332539439,-7.14197779), (-1.92414534,5.14404869), (5.53850126,2.23168612), (-2.09485984,-0.63519591)], [(-3.94679213,4.603400e+00), (-2.91008973,-2.81919456), (-0.0729224831,4.10829544), (2.1372385,-3.62277603)], [(-2.43092752,-0.743604362), (3.41540527,-0.0769996122), (2.09806204,-3.82184458), (1.43617702,-0.94194132)]], [[(4.303220e+00,5.69314814), (3.87578368,-0.703630328), (0.357597202,0.370685399), (-0.552785873,1.85581601)], [(1.56957102,-0.9215191), (-2.33732796,2.88962722), (-4.56222677,0.471605539), (-3.87657952,1.67104638)], [(-0.149098933,-0.606241524), (2.84621549,2.39977479), (-0.896014988,4.20028591), (-4.24441147,-1.03936636)]]]> : tensor<7x3x4xcomplex<f32>>
    %1 = stablehlo.constant dense<[[(-4.002860e+00,-1.219400e+00), (-1.76076531,0.794087529), (2.12905908,-3.3308444), (-5.14937878,-1.79710627)], [(4.35381317,1.7009182), (4.29814148,-1.1457845), (-1.51372647,-4.67654133), (-0.609990239,4.78628826)], [(1.47327435,-0.584229946), (-2.15547347,0.539574265), (-1.60819387,-2.50618052), (2.617347,1.14523816)], [(-2.73528719,-1.24556553), (3.21108627,-1.79181254), (1.62787855,1.32959521), (0.061041303,-5.05662584)], [(-1.24117208,2.85580301), (-0.715344727,4.40898466), (-3.22337961,-3.29109669), (-3.03577662,-1.33062518)], [(2.95276022,1.67136729), (-1.63601947,-0.0873109847), (1.38867474,-0.724515796), (-1.41688395,0.589552104)], [(2.00883651,-1.31423724), (-1.60812354,3.17694569), (0.835464119,-2.79360151), (-1.91337705,-3.04301023)]]> : tensor<7x4xcomplex<f32>>
    return %0, %1 : tensor<7x3x4xcomplex<f32>>, tensor<7x4xcomplex<f32>>
  }
  func.func private @expected() -> tensor<7x3xcomplex<f32>> {
    %0 = stablehlo.constant dense<[[(-9.39327907,29.1824131), (-28.6491089,-3.17183828), (-5.4017477,-26.0516739)], [(-46.2799568,17.5482178), (-2.56339169,22.4779034), (-1.29013205,-69.6982421)], [(9.31737899,-10.1450987), (21.3199806,39.1840134), (-16.2239666,15.5743017)], [(-13.8142471,-8.56038475), (21.7855453,20.3452244), (1.22392607,-59.1462898)], [(0.259748459,2.17669344), (-51.3294907,7.56360865), (-8.45032883,-35.2843056)], [(29.1665726,-30.029192), (-12.8502321,24.013525), (-12.8645363,-11.0769424)], [(20.1685295,16.667799), (6.52871036,5.75177193), (2.6464119,25.0780334)]]> : tensor<7x3xcomplex<f32>>
    return %0 : tensor<7x3xcomplex<f32>>
  }
}
