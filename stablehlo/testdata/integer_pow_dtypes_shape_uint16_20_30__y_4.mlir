// RUN: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = call @inputs() : () -> tensor<20x30xui16>
    %1 = call @expected() : () -> tensor<20x30xui16>
    %2 = call @integer_pow(%0) : (tensor<20x30xui16>) -> tensor<20x30xui16>
    %3 = stablehlo.custom_call @check.eq(%2, %1) : (tensor<20x30xui16>, tensor<20x30xui16>) -> tensor<i1>
    return %3 : tensor<i1>
  }
  func.func private @inputs() -> tensor<20x30xui16> {
    %0 = stablehlo.constant dense<"0x040000000200010000000000000007000000000000000100000003000200030000000000020002000000010009000000000002000300020001000500050002000100000000000100060004000400050001000300010001000400000000000200010001000100020004000200010005000000060001000400030000000300010000000400010005000100010003000400020004000000020005000000000002000100050000000100030006000000010001000000000001000400000001000300000005000000040002000400000002000100040002000100010000000200000003000100010000000200000000000000020000000300010002000200040001000100030000000500020002000200010002000100050000000200010004000300020001000400040000000000000003000300050002000000020005000300000004000000020006000200030001000400030002000200040002000300010002000100060000000200000000000200020000000200000003000100020000000300030000000000040001000100040000000200030006000100010001000300060000000200030003000100010001000100020002000400040001000100010002000000030004000300000001000200030001000600020000000300050000000400060001000300020001000000020002000000000000000100010004000200000000000200000002000500000003000400040004000000020001000000070002000000040005000000020003000000020000000400010001000100040003000400000003000300000004000300050003000500030001000400020003000100040000000000000001000000000002000100010006000200030004000000000000000000020003000400000001000300000003000100030001000300050000000300020000000000060000000200020002000100020002000100000001000000020000000300000001000100070001000800020000000300050001000000030001000300040002000600010003000100010004000200000000000100010000000100000004000000010001000400000001000200040002000000030003000200020002000000020002000100030002000400030001000500020003000100000000000100040001000000040001000200010005000500000001000300040001000200030001000000030006000100060004000000020000000100000000000100010000000400000001000000040002000000040006000000020002000100000001000000030000000100000002000200020007000000000000000200010002000000030000000100010005000500030004000100030005000100020001000200000002000300010001000100010003000300030005000200010001000200010003000200010003000000000000000000040002000200020000000100010001000000050003000600010000000100020000000100010003000100000000000200010007000200030004000000020002000000000000000200020000000100030002000500010000000400000003000000000001000200010002000000010001000600010001000400050001000300020000000300030000000100040001000200030000000200040003000000000005000200"> : tensor<20x30xui16>
    return %0 : tensor<20x30xui16>
  }
  func.func private @expected() -> tensor<20x30xui16> {
    %0 = stablehlo.constant dense<"0x0001000010000100000000000000610900000000000001000000510010005100000000001000100000000100A1190000000010005100100001007102710210000100000000000100100500010001710201005100010001000001000000001000010001000100100000011000010071020000100501000001510000005100010000000001010071020100010051000001100000010000100071020000000010000100710200000100510010050000010001000000000001000001000001005100000071020000000110000001000010000100000110000100010000001000000051000100010000001000000000000000100000005100010010001000000101000100510000007102100010001000010010000100710200001000010000015100100001000001000100000000000051005100710210000000100071025100000000010000100010051000510001000001510010001000000110005100010010000100100500001000000000001000100000001000000051000100100000005100510000000000000101000100000100001000510010050100010001005100100500001000510051000100010001000100100010000001000101000100010010000000510000015100000001001000510001001005100000005100710200000001100501005100100001000000100010000000000000000100010000011000000000001000000010007102000051000001000100010000100001000000610910000000000171020000100051000000100000000001010001000100000151000001000051005100000000015100710251007102510001000001100051000100000100000000000001000000000010000100010010051000510000010000000000000000100051000001000001005100000051000100510001005100710200005100100000000000100500001000100010000100100010000100000001000000100000005100000001000100610901000010100000005100710201000000510001005100000110001005010051000100010000011000000000000100010000000100000000010000010001000001000001001000000110000000510051001000100010000000100010000100510010000001510001007102100051000100000000000100000101000000000101001000010071027102000001005100000101001000510001000000510010050100100500010000100000000100000000000100010000000001000001000000000110000000000110050000100010000100000001000000510000000100000010001000100061090000000000001000010010000000510000000100010071027102510000010100510071020100100001001000000010005100010001000100010051005100510071021000010001001000010051001000010051000000000000000000000110001000100000000100010001000000710251001005010000000100100000000100010051000100000000001000010061091000510000010000100010000000000000001000100000000100510010007102010000000001000051000000000001001000010010000000010001001005010001000001710201005100100000005100510000000100000101001000510000001000000151000000000071021000"> : tensor<20x30xui16>
    return %0 : tensor<20x30xui16>
  }
  func.func private @integer_pow(%arg0: tensor<20x30xui16>) -> tensor<20x30xui16> {
    %0 = stablehlo.multiply %arg0, %arg0 : tensor<20x30xui16>
    %1 = stablehlo.multiply %0, %0 : tensor<20x30xui16>
    return %1 : tensor<20x30xui16>
  }
}
