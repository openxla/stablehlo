// RUN: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = call @inputs() : () -> tensor<20x30xui16>
    %1 = call @expected() : () -> tensor<20x30xui16>
    %2 = call @integer_pow(%0) : (tensor<20x30xui16>) -> tensor<20x30xui16>
    %3 = stablehlo.custom_call @check.eq(%2, %1) : (tensor<20x30xui16>, tensor<20x30xui16>) -> tensor<i1>
    return %3 : tensor<i1>
  }
  func.func private @inputs() -> tensor<20x30xui16> {
    %0 = stablehlo.constant dense<"0x030000000400000003000000000000000600040001000100000003000000020000000100020001000200030003000100020003000000000004000600010001000200020003000000020001000200010002000300020002000100010001000300040004000100000002000700010000000100050003000000020000000000010004000200060003000000020002000100010001000000050000000000020002000100000002000000020002000000020000000500030000000200010004000300010001000000000001000000000003000000000001000200020000000100020001000200010003000100020000000100040004000200030003000500030001000500000001000200020003000000020000000000020001000100020001000100000003000700050006000000010003000200010001000700010001000000060000000300010003000100020000000300010004000200020002000000030002000300000002000200000002000400060000000100000000000400030000000000050006000200010001000100040001000100020000000200000001000500010003000000030001000000020003000200040001000400050000000200000006000000010001000400000002000200010002000200000002000000030003000200010002000200070001000100040005000000030003000000000002000400000002000400050001000100030003000000000003000300010003000000060000000500020002000100000002000300000002000100030002000200020001000000000001000300040004000200000001000300040000000100020001000200010003000200020003000100010000000000020002000700010001000200000002000000000005000200050003000400000000000200020002000500020002000000030000000700010002000100010000000300030001000300030005000200010002000300030000000200000002000100010001000100030000000000000000000200020002000100020000000100020001000200000000000200030000000200020003000600040002000400000001000300070002000300010000000000060002000000030001000300010002000100010003000000000004000100000002000200010001000100020000000200010001000200040003000200020003000300000001000000000001000400060003000200000003000000010000000200010003000A00030003000300020001000300030001000100050001000100000006000300000002000000000004000200090002000100010002000400000002000600030002000000000003000000000002000700000002000300010005000000050002000000040004000100000002000100090000000100010005000000000004000000000001000300010000000300010001000300010000000200060001000100020004000200010003000500030001000100000002000200030001000000020000000100050004000100000001000400040000000000010003000000080000000200000004000100010001000000020003000400010001000100040003000400020006000000030004000300010003000000020000000200040000000100030001000000010000000000010002000000"> : tensor<20x30xui16>
    return %0 : tensor<20x30xui16>
  }
  func.func private @expected() -> tensor<20x30xui16> {
    %0 = stablehlo.constant dense<"0xAB28000000000000AB2800000000000000000000010001000000AB280000000000000100000001000000AB28AB2801000000AB2800000000000000000100010000000000AB28000000000100000001000000AB2800000000010001000100AB2800000000010000000000B721010000000100CD72AB2800000000000000000100000000000000AB280000000000000100010001000000CD720000000000000000010000000000000000000000000000000000CD72AB280000000001000000AB280100010000000000010000000000AB2800000000010000000000000001000000010000000100AB280100000000000100000000000000AB28AB28CD72AB280100CD720000010000000000AB2800000000000000000000010001000000010001000000AB28B721CD72000000000100AB28000001000100B72101000100000000000000AB280100AB28010000000000AB28010000000000000000000000AB280000AB28000000000000000000000000000000000100000000000000AB2800000000CD720000000001000100010000000100010000000000000000000100CD720100AB280000AB28010000000000AB280000000001000000CD7200000000000000000000010001000000000000000000010000000000000000000000AB28AB280000010000000000B721010001000000CD720000AB28AB280000000000000000000000000000CD7201000100AB28AB2800000000AB28AB280100AB28000000000000CD7200000000010000000000AB28000000000100AB280000000000000100000000000100AB2800000000000000000100AB280000000001000000010000000100AB2800000000AB28010001000000000000000000B7210100010000000000000000000000CD720000CD72AB28000000000000000000000000CD72000000000000AB280000B72101000000010001000000AB28AB280100AB28AB28CD72000001000000AB28AB2800000000000000000100010001000100AB2800000000000000000000000000000100000000000100000001000000000000000000AB28000000000000AB28000000000000000000000100AB28B7210000AB28010000000000000000000000AB280100AB280100000001000100AB2800000000000001000000000000000100010001000000000000000100010000000000AB2800000000AB28AB280000010000000000010000000000AB2800000000AB2800000100000000000100AB280000AB28AB28AB2800000100AB28AB2801000100CD720100010000000000AB2800000000000000000000000039E200000100010000000000000000000000AB28000000000000AB28000000000000B72100000000AB280100CD720000CD720000000000000000010000000000010039E2000001000100CD72000000000000000000000100AB2801000000AB2801000100AB280100000000000000010001000000000000000100AB28CD72AB2801000100000000000000AB2801000000000000000100CD72000001000000010000000000000000000100AB2800000000000000000000000001000100010000000000AB2800000100010001000000AB280000000000000000AB280000AB280100AB280000000000000000000000000100AB2801000000010000000000010000000000"> : tensor<20x30xui16>
    return %0 : tensor<20x30xui16>
  }
  func.func private @integer_pow(%arg0: tensor<20x30xui16>) -> tensor<20x30xui16> {
    %0 = stablehlo.multiply %arg0, %arg0 : tensor<20x30xui16>
    %1 = stablehlo.multiply %arg0, %0 : tensor<20x30xui16>
    %2 = stablehlo.multiply %0, %0 : tensor<20x30xui16>
    %3 = stablehlo.multiply %1, %2 : tensor<20x30xui16>
    %4 = stablehlo.multiply %2, %2 : tensor<20x30xui16>
    %5 = stablehlo.multiply %3, %4 : tensor<20x30xui16>
    %6 = stablehlo.multiply %4, %4 : tensor<20x30xui16>
    %7 = stablehlo.multiply %5, %6 : tensor<20x30xui16>
    %8 = stablehlo.multiply %6, %6 : tensor<20x30xui16>
    %9 = stablehlo.multiply %7, %8 : tensor<20x30xui16>
    %10 = stablehlo.multiply %8, %8 : tensor<20x30xui16>
    %11 = stablehlo.multiply %9, %10 : tensor<20x30xui16>
    return %11 : tensor<20x30xui16>
  }
}
