// RUN: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = call @inputs() : () -> tensor<3x4x5xf32>
    %1 = call @expected() : () -> tensor<3x20xf32>
    %2 = stablehlo.transpose %0, dims = [2, 0, 1] : (tensor<3x4x5xf32>) -> tensor<5x3x4xf32>
    %3 = stablehlo.reshape %2 : (tensor<5x3x4xf32>) -> tensor<3x20xf32>
    %4 = stablehlo.custom_call @check.eq(%3, %1) : (tensor<3x20xf32>, tensor<3x20xf32>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> tensor<3x4x5xf32> {
    %0 = stablehlo.constant dense<[[[-2.534290e+00, -4.90242672, 3.66844201, 0.558470607, -1.07250071], [-4.01757526, 0.727727413, -0.436924279, -1.72406161, 0.923638463], [-2.59089303, -1.175928, 1.43012393, -0.529038191, -0.302769542], [2.5179565, 1.10618305, -4.05861616, 3.31372643, -0.0163154211]], [[-1.73582244, -4.43258905, -4.17698574, 2.5651741, 4.98202801], [-1.56785667, -3.39345741, -0.460217178, 0.316728532, 3.99195099], [0.252998054, 2.3537426, 6.15004539, -1.51599669, 2.53803682], [0.904160261, -0.320899546, 0.63060671, 4.65020037, 3.687500e-01]], [[1.70479918, -0.234252676, -1.65156603, -3.42133212, -1.87680542], [1.17973399, -0.228812531, 2.645290e+00, -2.90000486, 1.28663778], [-2.68247652, -0.573809206, 1.5809375, 0.0179334469, 6.76867198], [4.27394581, -0.960111618, 3.245020e-01, -0.376530528, 5.50043535]]]> : tensor<3x4x5xf32>
    return %0 : tensor<3x4x5xf32>
  }
  func.func private @expected() -> tensor<3x20xf32> {
    %0 = stablehlo.constant dense<[[-2.534290e+00, -4.01757526, -2.59089303, 2.5179565, -1.73582244, -1.56785667, 0.252998054, 0.904160261, 1.70479918, 1.17973399, -2.68247652, 4.27394581, -4.90242672, 0.727727413, -1.175928, 1.10618305, -4.43258905, -3.39345741, 2.3537426, -0.320899546], [-0.234252676, -0.228812531, -0.573809206, -0.960111618, 3.66844201, -0.436924279, 1.43012393, -4.05861616, -4.17698574, -0.460217178, 6.15004539, 0.63060671, -1.65156603, 2.645290e+00, 1.5809375, 3.245020e-01, 0.558470607, -1.72406161, -0.529038191, 3.31372643], [2.5651741, 0.316728532, -1.51599669, 4.65020037, -3.42133212, -2.90000486, 0.0179334469, -0.376530528, -1.07250071, 0.923638463, -0.302769542, -0.0163154211, 4.98202801, 3.99195099, 2.53803682, 3.687500e-01, -1.87680542, 1.28663778, 6.76867198, 5.50043535]]> : tensor<3x20xf32>
    return %0 : tensor<3x20xf32>
  }
}
