// RUN: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = call @inputs() : () -> tensor<3x4x5xf32>
    %1 = call @expected() : () -> tensor<3x20xf32>
    %2 = stablehlo.transpose %0, dims = [2, 1, 0] : (tensor<3x4x5xf32>) -> tensor<5x4x3xf32>
    %3 = stablehlo.reshape %2 : (tensor<5x4x3xf32>) -> tensor<3x20xf32>
    %4 = stablehlo.custom_call @check.eq(%3, %1) : (tensor<3x20xf32>, tensor<3x20xf32>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> tensor<3x4x5xf32> {
    %0 = stablehlo.constant dense<[[[-1.94528127, -1.86619461, 0.398659945, -6.20742846, 2.58595514], [1.19335043, 2.72117496, 0.679219604, 0.942516148, -5.07751274], [0.504053652, 4.20889425, 5.53627777, -0.306252778, 3.01602602], [-0.0609960891, -1.94200611, 1.403280e+00, 2.84971094, 0.661443472]], [[1.01955295, 0.87292552, -2.26937747, -3.19690681, 4.98246145], [-1.85621834, -2.29608512, 3.14851308, 9.78693103, -0.591837645], [3.86689758, 2.20051885, -1.28906906, 0.102296181, -1.10290313], [-2.97639322, -2.27168226, 3.69597292, 4.83820534, -0.0764747709]], [[4.64517164, 0.690880179, -3.00714445, -0.221480623, -6.08863974], [-3.24438024, -0.3512142, 3.62284207, -4.70881939, -2.11719346], [-0.933274388, -3.63971925, 4.60598612, -3.35632372, 2.6701405], [4.62920332, -2.66284847, -0.255528808, 1.15068901, -1.77685702]]]> : tensor<3x4x5xf32>
    return %0 : tensor<3x4x5xf32>
  }
  func.func private @expected() -> tensor<3x20xf32> {
    %0 = stablehlo.constant dense<[[-1.94528127, 1.01955295, 4.64517164, 1.19335043, -1.85621834, -3.24438024, 0.504053652, 3.86689758, -0.933274388, -0.0609960891, -2.97639322, 4.62920332, -1.86619461, 0.87292552, 0.690880179, 2.72117496, -2.29608512, -0.3512142, 4.20889425, 2.20051885], [-3.63971925, -1.94200611, -2.27168226, -2.66284847, 0.398659945, -2.26937747, -3.00714445, 0.679219604, 3.14851308, 3.62284207, 5.53627777, -1.28906906, 4.60598612, 1.403280e+00, 3.69597292, -0.255528808, -6.20742846, -3.19690681, -0.221480623, 0.942516148], [9.78693103, -4.70881939, -0.306252778, 0.102296181, -3.35632372, 2.84971094, 4.83820534, 1.15068901, 2.58595514, 4.98246145, -6.08863974, -5.07751274, -0.591837645, -2.11719346, 3.01602602, -1.10290313, 2.6701405, 0.661443472, -0.0764747709, -1.77685702]]> : tensor<3x20xf32>
    return %0 : tensor<3x20xf32>
  }
}
