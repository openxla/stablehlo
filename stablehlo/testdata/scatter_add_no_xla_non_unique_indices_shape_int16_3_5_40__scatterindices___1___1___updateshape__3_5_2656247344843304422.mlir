// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xi16>, tensor<3x5x2xi16>)
    %2 = call @expected() : () -> tensor<3x5x40xi16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<i16>, %arg1: tensor<i16>):
      %5 = stablehlo.add %arg0, %arg1 : tensor<i16>
      stablehlo.return %5 : tensor<i16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xi16>, tensor<2x1xi32>, tensor<3x5x2xi16>) -> tensor<3x5x40xi16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xi16>, tensor<3x5x40xi16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xi16>, tensor<3x5x2xi16>) {
    %0 = stablehlo.constant dense<"0x05000200FDFF0300000004000100FEFF0100FAFFFDFFFDFF0200FFFFFDFF0400020002000400FEFFFFFFFCFF00000200040002000100FEFFFBFF07000700FFFFFCFF010002000200FCFF02000000FBFF0200FFFF02000000FFFFFEFFFEFFFBFF020000000000000000000000FEFF020000000300FBFF0100010004000600FBFFFFFFFAFF03000000FFFF000001000100010000000600FFFF0000020003000300000004000800F7FF0200020000000000010000000600FEFF0100FFFFFEFFFCFF010001000000000001000000FEFF000002000100FDFF0300FFFF00000100010006000100FFFFFCFFFCFF00000300FDFF000003000100FDFFFEFF0300FEFF05000400FFFFFEFF0500FFFF00000000FCFF05000000FFFF0200FFFF0000000007000300FDFF0200FCFF01000400FCFF0100FFFFFEFF0300FEFF0300FEFF0300000001000300FEFF0200040001000000010000000500010006000400FEFFFBFFFDFF00000000FDFF0000FFFFFCFF01000000FEFF0000FFFF000002000300FEFF0100FFFF020001000000050000000000FDFFFFFF0000FEFFFEFF0000030000000200FAFF0100FEFFFDFF010001000400FEFFFEFF0400FAFFFEFF0000FDFF000000000100FAFFFFFFFFFFFDFFFFFF00000000FFFFFCFF02000100FEFF0400FFFFFFFF000002000000FEFF040002000100000003000100FEFF01000300FDFF0600020000000000FFFF00000000040005000300FFFF00000000010000000000000000000300FEFF0000070002000000FFFF0100FFFF01000000FFFFFFFFFFFF02000500FEFF0000FFFF0400FDFF00000400FFFF0000FCFF00000000FFFFFDFFFDFF0000F9FF00000000FDFF0600FDFF0000030000000200FEFF0300FEFF0100FFFF010006000100FEFFFAFFFFFF03000200050000000300000001000200FFFF02000100020001000000FFFF0100FAFFFFFF0000FCFFFFFF0100020000000000FDFF01000000FEFFFCFFFCFF00000100FDFF00000000010000000000FEFFFCFF0000FFFF0300030001000200040002000400FFFF000000000300FFFF0000FFFF020002000100FFFFFEFF0500FDFF0000000000000000FEFF0000000002000300FEFFFFFF06000100FEFF0000FFFFFFFF03000200FCFF030002000100FFFF03000100FDFFFCFF0300010002000000000003000200FFFF000002000000FEFFFDFF00000000FFFF00000A0002000300FEFFFDFF00000000FFFF000004000100010003000000F9FFFEFFFDFF0100010000000100040000000100FEFF00000100FEFFF9FF0100010000000000FEFF0000010000000000FEFF00000200FFFF00000400FFFF0500FEFFFEFFFAFFFDFF0300000000000000050000000300FFFF0000000007000200000003000000FBFF0000FDFFFDFF0100000000000200FFFF0200FEFFFDFF05000000040002000100FFFF040004000100FDFFFFFF0200010001000000040002000000FFFF01000300FBFF0200FEFF00000400FFFFFAFFFEFF0400FCFF0000030001000100FBFF00000100FFFF020008000400FBFFFAFFFCFFFDFFFEFF0500FCFF0000FFFF000002000000FEFF010000000100FFFFFEFF000005000200FFFFFFFF0400FFFF00000100FDFFFBFFFEFF0400FDFFFCFF0500FFFF0200010000000000FCFFFAFF0200030001000000FBFFFFFF"> : tensor<3x5x40xi16>
    %1 = stablehlo.constant dense<[[[1, 0], [0, 2], [4, 0], [0, -2], [0, -2]], [[1, -1], [1, -4], [-1, 3], [0, -3], [1, 0]], [[-6, 2], [0, -5], [5, 1], [0, 2], [0, -1]]]> : tensor<3x5x2xi16>
    return %0, %1 : tensor<3x5x40xi16>, tensor<3x5x2xi16>
  }
  func.func private @expected() -> tensor<3x5x40xi16> {
    %0 = stablehlo.constant dense<"0x05000300FDFF0300000004000100FEFF0100FAFFFDFFFDFF0200FFFFFDFF0400020002000400FEFFFFFFFCFF00000200040002000100FEFFFBFF07000700FFFFFCFF010002000200FCFF02000000FBFF0200010002000000FFFFFEFFFEFFFBFF020000000000000000000000FEFF020000000300FBFF0100010004000600FBFFFFFFFAFF03000000FFFF000001000100010000000600FFFF0000020003000300000008000800F7FF0200020000000000010000000600FEFF0100FFFFFEFFFCFF010001000000000001000000FEFF000002000100FDFF0300FFFF00000100010006000100FFFFFCFFFCFF00000300FDFF000001000100FDFFFEFF0300FEFF05000400FFFFFEFF0500FFFF00000000FCFF05000000FFFF0200FFFF0000000007000300FDFF0200FCFF01000400FCFF0100FFFFFEFF0300FEFF0300FEFF0300000001000100FEFF0200040001000000010000000500010006000400FEFFFBFFFDFF00000000FDFF0000FFFFFCFF01000000FEFF0000FFFF000002000300FEFF0100FFFF020001000000050000000000FDFFFFFF0000FEFFFEFF0000030000000200FAFF0100FEFFFDFF010001000400FEFFFEFF0400FAFFFEFF0000FDFF000000000100FAFFFFFFFFFFFDFFFFFF00000000FFFFFCFF02000100FEFF0400FFFFFFFF0000FFFF0000FEFF040002000100000003000100FEFF01000300FDFF0600020000000000FFFF00000000040005000300FFFF00000000010000000000000000000300FEFF0000070002000000FFFF0100FFFF03000000FFFFFFFFFFFF02000500FEFF0000FFFF0400FDFF00000400FFFF0000FCFF00000000FFFFFDFFFDFF0000F9FF00000000FDFF0600FDFF0000030000000200FEFF0300FEFF0100FFFF01000600FEFFFEFFFAFFFFFF03000200050000000300000001000200FFFF02000100020001000000FFFF0100FAFFFFFF0000FCFFFFFF0100020000000000FDFF01000000FEFFFCFFFCFF00000100FDFF00000000020000000000FEFFFCFF0000FFFF0300030001000200040002000400FFFF000000000300FFFF0000FFFF020002000100FFFFFEFF0500FDFF0000000000000000FEFF0000000002000300FEFFFFFF0600FDFFFEFF0000FFFFFFFF03000200FCFF030002000100FFFF03000100FDFFFCFF0300010002000000000003000200FFFF000002000000FEFFFDFF00000000FFFF00000A0002000300FEFFFDFF00000000FAFF000004000100010003000000F9FFFEFFFDFF0100010000000100040000000100FEFF00000100FEFFF9FF0100010000000000FEFF0000010000000000FEFF00000200FFFF00000400FFFF0500FEFF0400FAFFFDFF0300000000000000050000000300FFFF0000000007000200000003000000FBFF0000FDFFFDFF0100000000000200FFFF0200FEFFFDFF05000000040002000100FFFF040004000100FDFF01000200010001000000040002000000FFFF01000300FBFF0200FEFF00000400FFFFFAFFFEFF0400FCFF0000030001000100FBFF00000100FFFF020008000400FBFFFAFFFCFFFDFFFEFF0500FCFF0000FEFF000002000000FEFF010000000100FFFFFEFF000005000200FFFFFFFF0400FFFF00000100FDFFFBFFFEFF0400FDFFFCFF0500FFFF0200010000000000FCFFFAFF0200030001000000FBFFFFFF"> : tensor<3x5x40xi16>
    return %0 : tensor<3x5x40xi16>
  }
}

