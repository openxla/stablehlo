// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xi8>, tensor<3x5x2xi8>)
    %2 = call @expected() : () -> tensor<3x5x40xi8>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<i8>, %arg1: tensor<i8>):
      %5 = stablehlo.add %arg0, %arg1 : tensor<i8>
      stablehlo.return %5 : tensor<i8>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xi8>, tensor<2x1xi32>, tensor<3x5x2xi8>) -> tensor<3x5x40xi8>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xi8>, tensor<3x5x40xi8>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xi8>, tensor<3x5x2xi8>) {
    %0 = stablehlo.constant dense<"0x03FD000203000002FD0403050202FDFD05FEFD0004FCFF05000300FD030000FD0100FE0505FE000400FF00FEFF00FC000205FE010300000203FF0301FDFD02020400010301010002010500030602F8000100FD0000FD020201FF000100FF03F702FC02FF020000000000000001000201FE01FFFF02FF00FF08FC030001FBFD000001050200020200FE00FF00FEFD020806FDFD06FFFC010200FF00FD04FCFD0001FE000100FD00FD00010005FF00FF05FF03FF000304FD03010001FDFFFF01050100FBF9FF00FC0100FD0100FFFFFA0002FEF8FD01FFFD0300FF04FC03FF00FE050200FFFFFC00FDFF0402040207010201FEFE040002FE0502FF00FD00FCFEFD06010200FB010000FA01FE0006FE0000030100FF0200FAFFFF00FE00FF0100FC010101FFFF01FA00FF00FCFD0601FE03010603FC01FE0200FC0004000001FF0001FF00FEFC0004FC0002FEFFFB01000200FF0106FB03FF010100FF000201000200FF0200FD0003FF0006FFFEFC00FF000501FF0207000004FF000001020001000000FC00FCFCFFFE0300FAFAFD00010101FF00F804FD00030300FDFEFC04FF0203020006FF07020401FE03FFFBFAF9FEFD0001000100FD0002010001040000FDFD000203FF0002FE00FF0100FF020200FC00FCFF0007FDFEFC000001FD000201FE0100FBFE0100FE03FFFE000100020101000006FF01FF000104FE0302FEFF010100FD03FF010400FE01FD01060100FA05FBFF02FFFFFEFE020100010004040102FFFC00FE01FE03FF0000FEFDFF0000FF030103FD02000003FCFFFD020200000700FF00FA0001FE000000FE0000FE0200FF0500FF0403FF"> : tensor<3x5x40xi8>
    %1 = stablehlo.constant dense<[[[0, 1], [0, 1], [-4, -6], [0, 0], [-4, -3]], [[2, 1], [1, -4], [0, -5], [-1, 1], [-5, 2]], [[-3, 6], [1, 2], [0, 0], [2, 2], [-1, -2]]]> : tensor<3x5x2xi8>
    return %0, %1 : tensor<3x5x40xi8>, tensor<3x5x2xi8>
  }
  func.func private @expected() -> tensor<3x5x40xi8> {
    %0 = stablehlo.constant dense<"0x03FE000203000002FD0403050202FDFD05FEFD0004FCFF05000300FD030000FD0100FE0505FE0004000000FEFF00FC000205FE010300000203FF0301FDFD02020400010301010002010500030602F80001F6FD0000FD020201FF000100FF03F702FC02FF020000000000000001000201FE01FFFF02FF00FF08FC030001FBFD000001050200020200FE00FF00FEFD020806FDFD06FFFC010200FF00FD04FCFD0001F7000100FD00FD00010005FF00FF05FF03FF000304FD03010001FDFFFF01050100FBF9FF00FC0100000100FFFFFA0002FEF8FD01FFFD0300FF04FC03FF00FE050200FFFFFC00FDFF0402040207010201FBFE040002FE0502FF00FD00FCFEFD06010200FB010000FA01FE0006FE0000030100FF0200FAFFFFFBFE00FF0100FC010101FFFF01FA00FF00FCFD0601FE03010603FC01FE0200FC0004000001FF0001FF00FEFC0004FC0002FEFFFB01000200FF0106FB03FF010100FF000201000200FF0200FD0003FF0003FFFEFC00FF000501FF0207000004FF000001020001000000FC00FCFCFFFE0300FAFAFD000101010200F804FD00030300FDFEFC04FF0203020006FF07020401FE03FFFBFAF9FEFD0001000100FD0002040001040000FDFD000203FF0002FE00FF0100FF020200FC00FCFF0007FDFEFC000001FD000201FE0100FBFE0100FE03FFFE000100020101000006FF01FF000104FE0302FEFF010100FD03FF010400FE05FD01060100FA05FBFF02FFFFFEFE020100010004040102FFFC00FE01FE03FF0000FEFDFF0000FF000103FD02000003FCFFFD020200000700FF00FA0001FE000000FE0000FE0200FF0500FF0403FF"> : tensor<3x5x40xi8>
    return %0 : tensor<3x5x40xi8>
  }
}

