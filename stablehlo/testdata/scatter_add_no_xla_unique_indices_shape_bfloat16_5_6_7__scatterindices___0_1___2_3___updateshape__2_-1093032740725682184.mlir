// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[0, 1], [2, 3]]> : tensor<2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xbf16>, tensor<2x7xbf16>)
    %2 = call @expected() : () -> tensor<5x6x7xbf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %5 = stablehlo.add %arg0, %arg1 : tensor<bf16>
      stablehlo.return %5 : tensor<bf16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1], inserted_window_dims = [0, 1], scatter_dims_to_operand_dims = [0, 1], index_vector_dim = 1>, unique_indices = true} : (tensor<5x6x7xbf16>, tensor<2x2xi32>, tensor<2x7xbf16>) -> tensor<5x6x7xbf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xbf16>, tensor<5x6x7xbf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xbf16>, tensor<2x7xbf16>) {
    %0 = stablehlo.constant dense<"0xEFBE843EC93DC7C09C3F6CC04BBE1C4012405CBEA3C098BF3ABF83C02D3FCA3F9EBE32408D3F6DC026C0D1BE583F18C052BF2F40D5BFB3C0E13F343F55C0BABE85C074BF0D3FC23F83C0613FF5BF69406440EC3FDC3FB2C0953F8AC019C0CFBF34404440A7BFCF3D14C0B7C00D404440A54094BFA9401040B23FBFC0E2BF42BEBDC0B2BD04C057C0024055C0C8BF68402AC0EFC0BAC0E63F35407FC021C0AABEDD3F9C3F2640B2C0EC3F38BFC6BF83BE2B409340B0401940C73FB93FA8BF5EC02940E4BF71BFFEBE693EFABFE33F93C08740CA3FF0BE193FBD409CC004C0F4BD423E12408A4079C005BF23BF8AC0914027C010C0B53E36C088C06A4017BF9A4044405A3FFBBF7F408B40BA3F93C09140524062406C3F6A40EA3E4D40A2409240C93FE93F633F19C07C3FB73F163F6CC09C3F974093BF6B40B2C0E43F883F2FBE99409F3F42BFA13F3D404D3FCFBFB7BF954023404CC0B440AE40043E0F4070405F3E45BF9340303F0340A2BF5ABC7CBFEABED7BF01405AC0B4BE21C00D40234029BF78BF8C40CFBF32C09640BD4028BF94C0333E5C3FD4BCB4C054C055C0284098BFB0C0"> : tensor<5x6x7xbf16>
    %1 = stablehlo.constant dense<[[2.343750e+00, -8.300780e-03, 1.476560e+00, 9.228510e-02, 4.000000e+00, 2.453130e+00, -8.750000e+00], [5.429690e-01, 2.156250e+00, 1.337890e-01, -1.945310e+00, -9.921870e-01, -4.343750e+00, 3.718750e+00]]> : tensor<2x7xbf16>
    return %0, %1 : tensor<5x6x7xbf16>, tensor<2x7xbf16>
  }
  func.func private @expected() -> tensor<5x6x7xbf16> {
    %0 = stablehlo.constant dense<"0xEFBE843EC93DC7C09C3F6CC04BBE99401140A23FA0C03440DD3F4EC12D3FCA3F9EBE32408D3F6DC026C0D1BE583F18C052BF2F40D5BFB3C0E13F343F55C0BABE85C074BF0D3FC23F83C0613FF5BF69406440EC3FDC3FB2C0953F8AC019C0CFBF34404440A7BFCF3D14C0B7C00D404440A54094BFA9401040B23FBFC0E2BF42BEBDC0B2BD04C057C0024055C0C8BF68402AC0EFC0BAC0E63F35407FC021C0AABEDD3F9C3F2640B2C0EC3F38BFC6BF83BE2B409340B0401940C73FB93FA8BF5EC02940E4BF71BFFEBE693EFABFE33F93C087400840D83F3B3F7E40BCC0CDC06640423E12408A4079C005BF23BF8AC0914027C010C0B53E36C088C06A4017BF9A4044405A3FFBBF7F408B40BA3F93C09140524062406C3F6A40EA3E4D40A2409240C93FE93F633F19C07C3FB73F163F6CC09C3F974093BF6B40B2C0E43F883F2FBE99409F3F42BFA13F3D404D3FCFBFB7BF954023404CC0B440AE40043E0F4070405F3E45BF9340303F0340A2BF5ABC7CBFEABED7BF01405AC0B4BE21C00D40234029BF78BF8C40CFBF32C09640BD4028BF94C0333E5C3FD4BCB4C054C055C0284098BFB0C0"> : tensor<5x6x7xbf16>
    return %0 : tensor<5x6x7xbf16>
  }
}

