// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[0, 1], [2, 3]]> : tensor<2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xbf16>, tensor<2x7xbf16>)
    %2 = call @expected() : () -> tensor<5x6x7xbf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %5 = stablehlo.add %arg0, %arg1 : tensor<bf16>
      stablehlo.return %5 : tensor<bf16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1], inserted_window_dims = [0, 1], scatter_dims_to_operand_dims = [0, 1], index_vector_dim = 1>, unique_indices = true} : (tensor<5x6x7xbf16>, tensor<2x2xi32>, tensor<2x7xbf16>) -> tensor<5x6x7xbf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xbf16>, tensor<5x6x7xbf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xbf16>, tensor<2x7xbf16>) {
    %0 = stablehlo.constant dense<"0xD83F8D3F83403040DC4005C01140ED3E6940BDBF0F40F93F93402DC038C0293F533E2740C6BE20C1613FA4400DC0A540CEC0F03F5840C940BD4096401340DDBFC1C026C0A440563E1F3FB13F1B40DFBF68C080C0A8BF334039C0B43F58BFD23F05BEC5C09940D140F33F794036BF623F62BF2E40993E24C0A5BFC1BD434099C0063F2540B3BF78402C40304093C0DF3FA4BF67BE2C402040B1408FC0A6BEA63EE8C082C0CBBF48C0B53F87C027BD0E3FA1C0FF3E4DC0A93FF23FE53F14C0F03E05400240C1BF18C0A6C0C5BFD73F05C07BBF24C01EC03EC0743F0140B33FBABF0FC08EC0E4BF3D40C6C085BF3F40A13F8EBF73C000C0B3C03840B8BF2DBF2640E7BF7640E33FAABFCC3FAF3F96BE5EC0D1BFC9C00D400F3F903F4AC0224031C03B403A4042C0A0BF273F89403FC02F3F7BC0284085407840A2BFA93ED8C0C33F28BF254078C076403240054012400441823F4DC029C0BC3EF9BFB3BEC5C09D409E3E3A40DD3FA03F013E213F07BF0B406C404E40833E86401340844019405CC04CBD474084C0B140F43D4D3F41C0F3BE583FC3C0D3BCBF3E9EC03C4094BF17C0973F47BF"> : tensor<5x6x7xbf16>
    %1 = stablehlo.constant dense<[[-1.156250e+00, -5.125000e+00, 3.390630e+00, 2.578130e+00, -2.703130e+00, 4.062500e+00, -1.953130e+00], [-1.070310e+00, -1.046880e+00, -2.070310e-01, -2.968750e+00, 1.933590e-01, -7.304680e-01, -3.925780e-01]]> : tensor<2x7xbf16>
    return %0, %1 : tensor<5x6x7xbf16>, tensor<2x7xbf16>
  }
  func.func private @expected() -> tensor<5x6x7xbf16> {
    %0 = stablehlo.constant dense<"0xD83F8D3F83403040DC4005C0114032BFBEBFF53F9A4042BF0A4195C038C0293F533E2740C6BE20C1613FA4400DC0A540CEC0F03F5840C940BD4096401340DDBFC1C026C0A440563E1F3FB13F1B40DFBF68C080C0A8BF334039C0B43F58BFD23F05BEC5C09940D140F33F794036BF623F62BF2E40993E24C0A5BFC1BD434099C0063F2540B3BF78402C40304093C0DF3FA4BF67BE2C402040B1408FC0A6BEA63EE8C082C0CBBF48C0B53F87C027BD0E3FA1C0FF3E4DC0A93FF23FE53F14C0F03E05400240C1BF18C0A6C0C5BFD73F05C07BBF68C061C04BC001C00D402B3FECBF0FC08EC0E4BF3D40C6C085BF3F40A13F8EBF73C000C0B3C03840B8BF2DBF2640E7BF7640E33FAABFCC3FAF3F96BE5EC0D1BFC9C00D400F3F903F4AC0224031C03B403A4042C0A0BF273F89403FC02F3F7BC0284085407840A2BFA93ED8C0C33F28BF254078C076403240054012400441823F4DC029C0BC3EF9BFB3BEC5C09D409E3E3A40DD3FA03F013E213F07BF0B406C404E40833E86401340844019405CC04CBD474084C0B140F43D4D3F41C0F3BE583FC3C0D3BCBF3E9EC03C4094BF17C0973F47BF"> : tensor<5x6x7xbf16>
    return %0 : tensor<5x6x7xbf16>
  }
}

