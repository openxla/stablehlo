// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xbf16>, tensor<5x2x2x7xbf16>)
    %2 = call @expected() : () -> tensor<5x6x7xbf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %5 = stablehlo.add %arg0, %arg1 : tensor<bf16>
      stablehlo.return %5 : tensor<bf16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xbf16>, tensor<2x2x1xi32>, tensor<5x2x2x7xbf16>) -> tensor<5x6x7xbf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xbf16>, tensor<5x6x7xbf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xbf16>, tensor<5x2x2x7xbf16>) {
    %0 = stablehlo.constant dense<"0x1CC0A040883DC43F713F2B3E75C04EBF154052C0BDBFA33F064039BD8FC0CFBF593FB1C063C0C23F1FC0EABD77C09FBF83BF03BF4140953F26BFE9BEEAC0263F08C006408CC0BD40863FB2BF6A40AB3F344033C0A8C01AC009C04CC093C01B3E29C00FC0E5BF2C408D40C640523E1D40FBBF693F06BF45C0ECBF75BF723E12C0A7BFF43F8DBF81BFCABF463FE9C0873E8C40C4407AC0223FB7BF524008BFA5BF6E40053F9FC0993FAE3F953F3A40BBC0AB409C3E953ECF3FCABF03BF17406D3F2BC026C07C40533FA7C05AC0B2C037BF3FC099C083C066402E40B0BFEBBE16C185C03040B93F44C0EDC0D4BF6E40AA406ABFC3BF2B3FBD3F9EC0F73EB84026C0283FB4BD10C0C240C5400C3F51C00DC0C1BC1AC007BF22C014C0463F3EBFF9BFB6BFEF406EC04DC03AC03440A040153F0DC0DFBFE3BFCFBE4C4025BF28406E3F974081405C404140F6BF85BE4040A1C0A4BF78C08C3F7DBF10BFE03F0E4023C0DB3F76C03A3F154142BF4840973F263E8F405ABF5E404C3FDA3F0C401ABD34C0CD3F58BFABBEF53E5ABF2DC0E93F3BC078400A40E840973ED8C0D4C087BF0840A73FAD3F"> : tensor<5x6x7xbf16>
    %1 = stablehlo.constant dense<"0x52C032C0ECBF8C40683F40C0F23FE3BD173E1AC0AB3E44BFF53D9CC091BF0140DA3EAD3F84C03DBEDC3FB54053C007C0EA3EA2C0BF3F64C0D940C2C0B040BCBECBBFC9C0C240283E9F3F9D3FC5BD62C0314093BFDCC06E4018C09BC091C083C02940DCBF1F40B8BF1DC08CBF7FC052408D3F2B40A3C0603CE13EF0BF72BF4B4001415B4088C0A040CC3BA0C0503FE3BF24C0BB3EB83DA4C0D4BE64BF32C0C5BE92C04E40BEBEF83F0240A8BF4A3F903F79C0CDC0C03E65BE11C1A8403DBEB540963FE93FB1C0B2BC8C40EC3F5FBF4E4067C024401B402F3FF9C0783F09400740DABE3D4058BF9440DC40B53E34C0973F3040F8BF7F40B73FB03E28408BBF0FBF6D4073C048C027402CC0083F93BEDB3F6AC0A74071C087C0"> : tensor<5x2x2x7xbf16>
    return %0, %1 : tensor<5x6x7xbf16>, tensor<5x2x2x7xbf16>
  }
  func.func private @expected() -> tensor<5x6x7xbf16> {
    %0 = stablehlo.constant dense<"0xB7C00E40E4BFBD40EC3F35C0F8BF6ABF1E40B6C092BF023F0E409DC0B3C0CC3EA33F86C0F6C0AA3F44BFB140E5C056C011BFB2C090401AC026BFE9BEEAC0263F08C006408CC0BD40863FB2BF6A40AB3F344033C0C43F08C1574064C0C6C0C4C05B4004C00CBF7A408A402A403E40A73F0DC194403AC0FEC0CCC0A2C0384080C0973FF03E64C006C0B2C08240E9C0873E8C40C4407AC0223FB7BF524008BFA5BF6E40053F9FC0993F1E4076400CC0BBC0B940C9BF28BF9940D0403A40F2BFBE402BC0F3C0984073BFF9C043C0AFC0BBC05AC0B6C0DCC04D40ECBFEC3F54BFEEC085C03040B93F44C0EDC0D4BF6E40AA406ABFC3BF2B3FBD3F9EC0F73EF9407AC0B93F853FC4C0B0BED140A63E45C1434055BE5040253F36BFFBC0403F6840D0BD13C02B41EAC024BFF8BE604032C0C63F80BDBC3EE3BFCFBE4C4025BF28406E3F974081405C404140F6BF85BE4040A1C0DABF6CBF803E6940CA40074018BFAFBF8F40B9C097402C41D4BEB840C03DCBBE034195C0B03E5A407CBF2E40A6BE8DBF04C08C4083C06FC05ABF2DC0E93F3BC078400A40E840973ED8C0D4C087BF0840A73FAD3F"> : tensor<5x6x7xbf16>
    return %0 : tensor<5x6x7xbf16>
  }
}

