// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<32> : tensor<1xi32>
    %1:2 = call @inputs() : () -> (tensor<1x50x3xf32>, tensor<1x3xf32>)
    %2 = call @expected() : () -> tensor<1x50x3xf32>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %5 = stablehlo.add %arg0, %arg1 : tensor<f32>
      stablehlo.return %5 : tensor<f32>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1]>, unique_indices = true} : (tensor<1x50x3xf32>, tensor<1xi32>, tensor<1x3xf32>) -> tensor<1x50x3xf32>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<1x50x3xf32>, tensor<1x50x3xf32>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<1x50x3xf32>, tensor<1x3xf32>) {
    %0 = stablehlo.constant dense<"0x30C80E3ECDDF29BFB7C6A3BF89950A3C149DC33F4029FAC02219FB409D0D8640FAB7F23FCD4E2740CD078F3F55F600C0FD95D940139188C0E07888BF20289C3E40318ABF67563440CBC2D7BF1E0A38C06DAB1FC08624B13EC781A5BF4202DA3F3B969BC008A943BFF6EB7F3F4D22AA3F3C2416C0125A4AC0B7457F3DAAF003409496BD3F41F334BFD8CDAEC05AA98B3FA7533E40A2EBBABEFAA685404179833FBA60623EB09E9EBFA10CE7BFDFD8CE3FA42A5ABF8428263E2905F8BE74F5AB3F71E73FBF6C80B53F34AA68404C66C7C004AD6440BA883840C0C10B40AF9893BE9781C2BF1E134C3F57A22B4024731AC00F55B63FC454123F626E00C044D56CC054662B404EA27840C73C45C043221140CB0D6240935748C0A2B47940F7DA96403E678FBFD565E6BE9D031D40640862406B7765C07A8F32C0155E0840FD8A0D408FC674BF82A78E3F9766973F0126963F74A287C0ECF60A402553303F42FD2ABF9D6768C06EB680BED51DC03F0714B3BF1F763FC06C518C3F671236BFCFE0C83F8C0C3EC0FDD91040CCACC6BFE75EA93F2E2C3CC0E671F4BE0A8637BD077C8CC0C198A0BF2C23E5BFFD7925BF4B683640629950C09DB2AE3F96A39AC0A0CAE93F3D079ABFC2AB74BE1F1EA4BE0E23463EEE24163F6A67C4BF1B2C87BF3330A63FD9745BC0CCEDA93F8F9A82C06FE6873F7FE7B0408E2F65BF84D5CB3F3033AA3F5B65DBBFFACD5940BF777B3F553A6FC08AB665C0427CE1C02EA63C404E6E3640C37CF53D5BD4B4C092D00141A100A2402177F3C031991FC0DFC0C4C07E79013F44BE6FBEE848EA3F2F1F81C01C867740F048B4C0424392BF"> : tensor<1x50x3xf32>
    %1 = stablehlo.constant dense<[[-2.99837303, 3.09296727, -1.98652124]]> : tensor<1x3xf32>
    return %0, %1 : tensor<1x50x3xf32>, tensor<1x3xf32>
  }
  func.func private @expected() -> tensor<1x50x3xf32> {
    %0 = stablehlo.constant dense<"0x30C80E3ECDDF29BFB7C6A3BF89950A3C149DC33F4029FAC02219FB409D0D8640FAB7F23FCD4E2740CD078F3F55F600C0FD95D940139188C0E07888BF20289C3E40318ABF67563440CBC2D7BF1E0A38C06DAB1FC08624B13EC781A5BF4202DA3F3B969BC008A943BFF6EB7F3F4D22AA3F3C2416C0125A4AC0B7457F3DAAF003409496BD3F41F334BFD8CDAEC05AA98B3FA7533E40A2EBBABEFAA685404179833FBA60623EB09E9EBFA10CE7BFDFD8CE3FA42A5ABF8428263E2905F8BE74F5AB3F71E73FBF6C80B53F34AA68404C66C7C004AD6440BA883840C0C10B40AF9893BE9781C2BF1E134C3F57A22B4024731AC00F55B63FC454123F626E00C044D56CC054662B404EA27840C73C45C043221140CB0D6240935748C0A2B47940F7DA96403E678FBFD565E6BE9D031D40640862406B7765C07A8F32C0155E0840FD8A0D408FC674BF82A78E3F9766973F0126963F74A287C0ECF60A402553303F42FD2ABF9D6768C06EB680BED51DC03F0714B3BF1F763FC06C518C3F671236BFCFE0C83FF2F8BEC09566AB40907962C0E75EA93F2E2C3CC0E671F4BE0A8637BD077C8CC0C198A0BF2C23E5BFFD7925BF4B683640629950C09DB2AE3F96A39AC0A0CAE93F3D079ABFC2AB74BE1F1EA4BE0E23463EEE24163F6A67C4BF1B2C87BF3330A63FD9745BC0CCEDA93F8F9A82C06FE6873F7FE7B0408E2F65BF84D5CB3F3033AA3F5B65DBBFFACD5940BF777B3F553A6FC08AB665C0427CE1C02EA63C404E6E3640C37CF53D5BD4B4C092D00141A100A2402177F3C031991FC0DFC0C4C07E79013F44BE6FBEE848EA3F2F1F81C01C867740F048B4C0424392BF"> : tensor<1x50x3xf32>
    return %0 : tensor<1x50x3xf32>
  }
}

