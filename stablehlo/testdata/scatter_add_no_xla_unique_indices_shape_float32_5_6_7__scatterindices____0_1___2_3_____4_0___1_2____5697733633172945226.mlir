// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<5x2x2xf32>)
    %2 = call @expected() : () -> tensor<5x6x7xf32>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %5 = stablehlo.add %arg0, %arg1 : tensor<f32>
      stablehlo.return %5 : tensor<f32>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xf32>, tensor<2x2x2xi32>, tensor<5x2x2xf32>) -> tensor<5x6x7xf32>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32>, tensor<5x2x2xf32>) {
    %0 = stablehlo.constant dense<"0x6B47D2BFAB323DC04CA69FBE9BFE6EC0555319C04613A2C066FA933FF77E3E3FFA6453C039B927C0E404C8BF7B7496BF867B6E40554FCC4098BF963F89F81E402DA2C63F91F80D40092D293FC9882CBE7B0A01BFA02EE24084189F3E78A103C0431CDDBF07D275409BBB41C08830CCC010D38EBFFD044940A1F00C40091CEF3FB18DDE40C96D5DC0BC2885BF93A09A40CDD9374046FD96BFE7112E3F3170054058189D406B320140141FF73FC2C6D4405295953E5B7FA640FB8102406CB96BC05A27D53FFBEFD1BF32886CC0B75C17C001405A3EFD68533E092C4E40819D07BF2F08493EA9E22E40086D8DC03356893FB0D326402156303F2975E53F12A5A73E62820740A5EC7E3F844B92C04FA41DBFAD39B240850BD4406A52B6BE61E1D3BF950A51409B40DC3FF1F6C4BE8E274D3FADCA86BF832C3D401ACED7BE339FC63EF829573F21252840A21160BF5600974075982B405D7829BF2870BB40FB043B40403F383FEB6D5DC01F82ACBDC5D5543FA091CD40C8209540AA21A9C0346491BCC32519C0EF8BB94098B6A3C08B6077C0FD841340A87C6ABF1A62A93FB27D03C0E49D984019AD06410D623440CB22763F6EFFC33F9C0A6DC0BF1981C00BFD803E3DB0F63F5A204240913112C0591608C0ABC33B3FBD72C93FF05DCEBED6B491C075B0B5BF4C5E3DBF31DF34402296F83E1A7C33403A05F8BF3224AEBFAC44B240D80661C0FE1FCA3EE0B26D40261755407BD32140B1A66FBF82C02040F5AC43BFC457DBC0CBE1893FC08DE9BF83B5B83E1FAEF4BFF30022C0C2443FBFF4510F40038D8FBFC7EE86406DCE23C051E7A3C0430C0D40F1DB8B3F3CB499C02FA0A14032A3693EFB62C5BF08B599BF034181C057F83BBF77D865C0B86BFFBE61CAF0BFC384E23ED006BB3FF89232C05882853F34E57AC04CDE31C0B426384009223F406C5FB4BD6EFE974048B1D7BE0B5047BF00076540CDE9A03D1FA439BEE39EB23FE86E5240F0872940734D59BFDB5748C07F569F40AC672F3F8D9954C001BE0940F67B3FC0D51F11BE3C265DC01082BABE3A8F8C3F5095B5BE227A184097F96D4080E189BE4F61D13FD9176FC06A4119C0E259B940ED798EBF6C205A409D990E3F98EA15C0DFCFA5C0A4A9013F3463634090D415405CF168406CCC06BF97003BC002E27140ABC505C0"> : tensor<5x6x7xf32>
    %1 = stablehlo.constant dense<[[[-0.0764542893, -0.671887159], [-4.09483099, 0.106897578]], [[5.06823683, -0.624843717], [-4.16450357, -1.14420855]], [[1.02076244, -3.02300715], [7.4330511, -2.93720865]], [[3.26579952, 7.43875598], [-1.07513583, -3.956040e-01]], [[-5.7650218, 3.53006029], [-4.9866786, 2.5434339]]]> : tensor<5x2x2xf32>
    return %0, %1 : tensor<5x6x7xf32>, tensor<5x2x2xf32>
  }
  func.func private @expected() -> tensor<5x6x7xf32> {
    %0 = stablehlo.constant dense<"0x6B47D2BF4C1742C04CA69FBE9BFE6EC0555319C04613A2C066FA933FF77E3E3FFA6453C0D0E120C0E404C8BF7B7496BF867B6E40554FCC4098BF963F89F81E402DA2C63FBCF0C53F092D293FC9882CBE7B0A01BFA02EE24084189F3E78A103C0431CDDBF07D275409BBB41C08830CCC09FBDA6C0FD044940A1F00C40091CEF3FB18DDE40C96D5DC0BC2885BF93A09A40CDD9374046FD96BFE7112E3F3170054058189D406B320140141FF73FE07A3B415295953E5B7FA640FB8102406CB96BC05A27D53FFBEFD1BF32886CC06E9760C001405A3EFD68533E092C4E40819D07BF2F08493EA9E22E40086D8DC0486DE53EB0D326402156303F2975E53F12A5A73E62820740A5EC7E3F844B92C04FA41DBFAD39B240850BD440C4A890C061E1D3BF950A51409B40DC3FF1F6C4BE8E274D3FADCA86BF832C3D401ACED7BE339FC63EF829573F21252840A21160BF5600974075982B40A6B0B73E2870BB40FB043B40403F383FEB6D5DC01F82ACBDC5D5543FA091CD40AC8CDC3FAA21A9C0346491BCC32519C0EF8BB94098B6A3C08B6077C0FD8413401D187CC01A62A93FB27D03C0E49D984019AD06410D623440CB22763F6EFFC33F9C0A6DC0BF1981C00BFD803ECFC315415A204240913112C0591608C0ABC33B3FBD72C93FF05DCEBED6B491C075B0B5BF4C5E3DBF31DF34402296F83E1A7C33403A05F8BF3224AEBF0D630D41D80661C0FE1FCA3EE0B26D40261755407BD32140B1A66FBF82C02040A27994BFC457DBC0CBE1893FC08DE9BF83B5B83E1FAEF4BFF30022C0C2443FBFA2D91A41038D8FBFC7EE86406DCE23C051E7A3C0430C0D40F1DB8B3F3CB499C02FA0A14032A3693EFB62C5BF8AA911C0034181C057F83BBF77D865C0B86BFFBE61CAF0BFC384E23ED006BB3FF89232C05882853F34E57AC04CDE31C0B426384009223F406C5FB4BD84F281BF48B1D7BE0B5047BF00076540CDE9A03D1FA439BEE39EB23FE86E5240C827A640734D59BFDB5748C07F569F40AC672F3F8D9954C001BE0940F67B3FC085DA58403C265DC01082BABE3A8F8C3F5095B5BE227A184097F96D4080E189BE4F61D13FD9176FC06A4119C018384E3FED798EBF6C205A409D990E3F98EA15C0DFCFA5C0A4A9013F3463634090D415405CF168406CCC06BF97003BC002E27140ABC505C0"> : tensor<5x6x7xf32>
    return %0 : tensor<5x6x7xf32>
  }
}

