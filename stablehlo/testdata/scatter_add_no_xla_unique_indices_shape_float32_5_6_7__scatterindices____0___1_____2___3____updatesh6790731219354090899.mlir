// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<5x2x2x7xf32>)
    %2 = call @expected() : () -> tensor<5x6x7xf32>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %5 = stablehlo.add %arg0, %arg1 : tensor<f32>
      stablehlo.return %5 : tensor<f32>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xf32>, tensor<2x2x1xi32>, tensor<5x2x2x7xf32>) -> tensor<5x6x7xf32>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32>, tensor<5x2x2x7xf32>) {
    %0 = stablehlo.constant dense<"0x75C72D40153DCF3F568848409E02D1BF7816ECBE6C1CD0BF1CCC983F31F1B1BFD03295C02CD45640ADFDACC0F074CBBF979D1B3FEDD9BAC07D3903BF0B83CDBF9A96313EACDC913F81177740B685073FF6A6C4BFBCF0AC4039328A3E868309BFECE9FA3F1870D83F9AC722BFB819483FE3C362C002BF4CC0CFC5D6BF757ABDBF6A168B40B8DDA43EE84E5E3F8E285B401601E63F200D94405ADDADBF1F7427C0513478402B0A853F520E29C0BA1A74405EE041406C4377C025D5AE3F09E43F40B8EC9DBF35B487C0C52B2EC1C6FF804051DB1E40296F34BF892955BED6E3833F85168EBF396B733EFA52B3BFF9DACCBFA6658D405745A1BF2B16DC3FC4AE03BF7F966DC0BF81FC3F63AFD7C0ECB05BC06EC73BBFDDAB34BF28AB3E40447FFABF51C832C0D09A5B4035DBD1BF9F765D3FD0F9953FEEACA43E3C7363C0BE251BC0FC8ABDBF83B54740EEC089C0C4E582C07BC8D6C02F6FAFBF1F9B8E4010EA704079B335C04D4BE13F2A4398BE554562BF8E7EB03C3005E03F5A31513E41C30D40316C5D3FB61654C0D54620402A11423E94409CBF34623240168BA93F370090404D6E8240B52B8A3E62611A40BB4710BFD0E648BF50B61B40DA81B63F43FE94BF1AA616C0380141BF9B3B59C0581A34405941A2BF0C0877408C5A70C05E34B83FF9C0C7C0B12CF3BF371457403B539FC0F97E4B3F84EFBF3FB4F69F3D21D958C0272956BDD9A578405D1A8C403E2F7DC054497AC0C7C008C1339993C0221B2ABFAD7C233F7FF57840A12DBDBF889AA1BFAE226FC0AF6BB3BF98537A3F3AF2A8BF485607405AD567C0FC6466C0A819F3400D8294C0DA72EEC0069D893D3A3351C0F66DB4C0D73723C03FD383C061F4CCBF1C15B1C09507D4BF7564D9BF3C1328C08FC996404AA470C0C21C893FDFC29AC02C5AED3E5D2C3140CD446B40B5368AC042B1103D0CD5964071093BC05FBCA840315C07C0C9BE5F4032DB0B40E43161400F587CBFA389E43F5916854096C89DC03F24BB3F9A93363F62ADA5403E6B8DBF03DD2DC092D700C08D2684C0C598BCC0682D0ABF54E6D0BF47858FC0D4B7C43D3180AAC001919D4058FAF23FE7B706412DE7E1BFCA033040688CFB3F3B3BDDBFF6225F3F25DAEE3F8E0A363CC366523F4CBB803F26688B40FE12AEC0BD4984C09D6191C0471CD13F"> : tensor<5x6x7xf32>
    %1 = stablehlo.constant dense<"0x636B4BC095EEB63FD1B50F40B53EE8BF2CF9BDC015B531C0600B81BF6D4500404BA335C0E5FFC63DBEEBB63FA7C196BEC3FB22C0FB2AB7C0E9A43CBF2795CC3C638D82C038C002C03E87BA3FB92E7340918A3840FC476CBF028E95409DF10D40F3B528BE032D9C40C0D9BBBF2661B2408A2989BFC6B7FDBF9C9461BFAD7B843E57A3E63ECE2047C0CAE29A3FA96F2940ADD6B6BF730E873E00A404C032C820C02F368C40CCF12DC0BA52A5C062C361BFCA0617C0BED3BDBFAF58A33F0D19DB3EC238DEBFEB1E41400C6B04405A7DACC09D281EC092DE46C046ED574033F73AC0B86F45C084138FC067C52DC049EEA4402020C0406C0B78401123EDBEFBE801C065775E40544FF0BF4966D63F8D0DF1BFF80D0CBFE0EDF4BED80C11C0DB1AB4BFDACBCBBFB8ADD83FC98D84C0C29488BFFC8006C09E8B2F40D7C164BFE79139C0B4C95C3F3DE7A1C0084E18C0FCA92A3ED7FC88401AE2973E3EC3EDBF018F44BF7B15683F20C32ABECBCE54BEE7B87F405774E0BFA98188BF668083C03ABE16BF98E924C057100BC051BE09BE4D7A8CBE6A2432C04B8FA23F109D233F7A93C73DE2689CC0A187A14009FEEC402E81164076FB12C0037D4FBE1D30EBBFAED2033FD0179E400BD9EF3F4AA611BF5A8342BEDBDF4BC015DC90C0F674083EE0B4FB40BD47D6BE58B8BB3F3E5E5B40B01BF6BFCDD5B840E144BB3F8E258A407A3C38C059C45FBE7D765FC046CFD0BF0F65A93E82B561C0CEA015C031E7BD3F2CDA5C40023BC4C0BB217C3F5F0144BD419244C0"> : tensor<5x2x2x7xf32>
    return %0, %1 : tensor<5x6x7xf32>, tensor<5x2x2x7xf32>
  }
  func.func private @expected() -> tensor<5x6x7xf32> {
    %0 = stablehlo.constant dense<"0x701FEDBED5154340141FAC40AAA05CC094BACCC0A6E18CC0E0053E3E52331D3F7604F0C02B0C5D407B857EC05A25F1BFBA28F8BF740239C133EF9FBFB650CABF5C017AC0884767BF902DAA4013888A402C6EAC3FBC678F4026319E407721D73F2ED3E53F0949D240C69E06C05D64CB40E3C362C002BF4CC0CFC5D6BF757ABDBF6A168B40B8DDA43EE84E5E3F8E285B401601E63F200D94405ADDADBF1F7427C0513478402B0A853F17A36DC0AE7DEA3F377B0940F6B366C0FB7DE83FA098E7BD807BC2BC82F1CBBF9B0645C1AD70894088BAD13EFCE34DC0E38C8540C2FFD7BF5BD8C8C094E824BF47B070C05C5745C0D23BB64028FE54BFC0A588BC3A332040E656D2BFD4B95AC0D96113C1BF47D1C06AFB28402A2268C028AB3E40447FFABF51C832C0D09A5B4035DBD1BF9F765D3FD0F9953FEEACA43E3C7363C0BE251BC0FC8ABDBF83B54740EEC089C0C4E582C02CC01CC150EFBAC0AEE1DE3FA8B10E41C78C4A408958B4401EB342BF507A3AC062D85F40205102BE748CF03FD4E3A93E72BCA23E72B472C0D09F733EB6D89BBF370634C0885C8F40075634C00DB65B403CB7FC3F15D14040D861C23FD6A35DC020179F3D2A1828C06C3474BF07527FBF1AA616C0380141BF9B3B59C0581A34405941A2BF0C0877408C5A70C05E34B83FF9C0C7C0B12CF3BF371457403B539FC0F97E4B3F84EFBF3FB27C8B40DEDC45C08774F4BF198247400C1DA940B8ED83C020CB83C01AA591C049B6CBC03A8FDDBFA1215EC0F045534034C081C09BDD5BC093BE77C0428AD6BF081FE7BFE05D4CBD8C3D3040BE9861C0B0CD07C1A4504A41F8F730404332A3C08EAE0EC00A2B5EC0FD39EFC02C4302C03FD383C061F4CCBF1C15B1C09507D4BF7564D9BF3C1328C08FC996404AA470C0C21C893FDFC29AC02C5AED3E5D2C3140CD446B40B5368AC033399F404FCBD24004735FC044A8A240069EA9C0C2F283BF81621440E9263641F7BDB3BFFE20504078C5F240824FDBC0DD9EE74057470B4078E9174119F27EC049D93BC00827B0C05E5AB8C07402B2C06E2082C0F8137EC0F61640C0EBFF62409A5D37C13815BD404DDAEC3FAE26AB402DE7E1BFCA033040688CFB3F3B3BDDBFF6225F3F25DAEE3F8E0A363CC366523F4CBB803F26688B40FE12AEC0BD4984C09D6191C0471CD13F"> : tensor<5x6x7xf32>
    return %0 : tensor<5x6x7xf32>
  }
}

