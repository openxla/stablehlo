// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>)
    %2 = call @expected() : () -> tensor<3x5x40xbf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %5 = stablehlo.maximum %arg0, %arg1 : tensor<bf16>
      stablehlo.return %5 : tensor<bf16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xbf16>, tensor<2x1xi32>, tensor<3x5x2xbf16>) -> tensor<3x5x40xbf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xbf16>, tensor<3x5x40xbf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>) {
    %0 = stablehlo.constant dense<"0x54406C4041C0AA3FB33FB2C0423F253FE73E6DC0543E2FC072C0B4BF83C07CC004408D3FD4BE514083C01540123FEFBF68BF5D3E7E4080C0414093C02A3E48C02D405EBFA53FAABED0404FC0EBBF60BFCEBFFFBE4B40CAC02B3F1C4076404640FD3F844061BF2B3F2A3FDB4033405E3F3440D9402BC002C07BC039BF75C04540D0BF86BF044076BFAC3FF53F60BE8BC07DC06840B5C09040EAC0C7C03A4064C0DEC0B63F48C00BC0D2BDF43F85C08DBFC73F3C3D09C00ABF93BF123F29404140B7BFE1C03C404BBFE6C0B63FD3BFB740FE3F413F43BF4E40B2C08EBF06C0EC40933F2FC05FC028C0B540BE3F303E54C03F3C3E3F894028C0533F24BFE03F803F47405A40F1BF85C0D7BE803F13C007C0CE3F494088C0B0C032C0FD3F7CBF224083BFB7BF6A405240DFBE88C0DA3E70C0A83E9D40F6BF7040643F2BC08DBF5340C6C0E2BF9B40BEBE8FC0973D423FB2BF49C0AB3F423FA64050BF994074C005C08F40F23E363ECCC0D2C04EBD8FC0DEC04F40873F7F406940B4BF97C07EC0D73FD240C53D0441B740F33FFB3F19C088BF66C01EC0F63F0B40C33E0CC0F3BE6B40AE40F43E593FE840194080C05CC0A14093BF103F32408440B43F83C0B5BF2EC040BFE0BECF3D0D3F884034400740B6BF77BFD4BF21BF423E1040D7BFDBBF893F03408DBFB43EE9BF53C095C0ADC0F03E6AC09440EBC095BF44C0C2BF13C0B7C001C02940B93F863FD83F25BF91C08DC008C04CC0123FBC3F1140A440C13F28C09940EFC09C3DD73ED83F2EC0123E88C0C8BECBBF0D401A4016408A4044BF343F0BBF2DC0FDBE204041C0D0BFD7C0E8BEC2BF24403FC0C83E48BDB1BF14BFA7C04AC0034078BF883FCC402DBF1FC099402BBE3B3F92BFC840623F8CBF63BE1A3F0CC0033F63BE91C0B240E93FD03D97408DBF8BBF7DC0A2C060C039BF38408D3F903F373F8840074050C0C1BF183FECBFA7405BBFCA4088C0DCBF9E4004BE5B40CC3E563CE2400A4002C0C8C0D43F7DC03B3E5740793F0AC0303F2040B2C039C040403CBD21C0E03E444054C08CC06A403840DE3FECBE2A401CC08D3F80BC9CBF57C03CC06540A0C019C056C0473F0C40F93E8F3D3CC0C73FA53F4140294020C0CCBF6ABEE23F6DC00A4065C0603FCE3F3CC059405140A93D3740E9BF0041C1C08A3EF73E9D3F9EBF1A3F70C0EE3E01409340E5BFACBF573F43BF2C3F04409440B1409C3FD63FE83E25C032C0F03F7F40C1BF94BF4A40A0BF1A40DE3E11BF2DC003C0C5BF97BF843FCCC01E401040463FCD3F9DBE87C0AF40BEBFDC3F8DC0333F1CBF59406240AAC083BE3141B8BF373F434038BFA13F0240B4BFD83DE2BD3A409D3EA7C069BEBF3F514092C0D53E5F3EDF3F763F293FC43E1740943C23C0D23F103FA5BF64C0703F95BFFBBF45C06540D4BFD4BE5B3F57BE4BC01CBF0DC08BBFE4BED33FA2C0F4BF41C0323F4FBF0840024011C091406B3FC5BE28C035C02F3FB440B0BFB23C0DBFDABF22BFAE408B40873E36BC28C0E1BE68403240373F97BDEEBFA3BF4A405B40F5BFCFC0033F8B408940CFC06E3D82C09B3EEBBF53BF7E40D1BFC4BC5DBFBDBF4E3D1FBF7BC088C02CBE76BF2CBD5EBED13EC9C096C0CFBE3240DC3F39C03CBF37C054401B3F6440AB3E253F204081404A3F37408E40F1BFBBBFA13FA440C1BF4EC05FC09ABE79C0"> : tensor<3x5x40xbf16>
    %1 = stablehlo.constant dense<[[[4.375000e+00, 7.187500e-01], [4.812500e+00, -5.250000e+00], [-1.148440e+00, 8.945310e-01], [1.679690e+00, 2.312500e+00], [-5.664060e-01, 1.125000e+00]], [[5.937500e-01, -1.398440e+00], [5.875000e+00, -3.066410e-01], [4.355470e-01, -3.937500e+00], [-3.656250e+00, -4.343750e+00], [3.295900e-02, 8.750000e+00]], [[1.621090e-01, 2.531250e+00], [-1.679690e+00, 4.687500e+00], [3.328130e+00, 4.156250e+00], [4.343750e+00, -3.281250e+00], [-6.406250e-01, 1.484380e+00]]]> : tensor<3x5x2xbf16>
    return %0, %1 : tensor<3x5x40xbf16>, tensor<3x5x2xbf16>
  }
  func.func private @expected() -> tensor<3x5x40xbf16> {
    %0 = stablehlo.constant dense<"0x54408C4041C0AA3FB33FB2C0423F253FE73E6DC0543E2FC072C0B4BF83C07CC004408D3FD4BE514083C01540123FEFBF68BF5D3E7E4080C0414093C02A3E48C02D405EBFA53FAABED0404FC0EBBF60BFCEBF9A404B40CAC02B3F1C4076404640FD3F844061BF2B3F2A3FDB4033405E3F3440D9402BC002C07BC039BF75C04540D0BF86BF044076BFAC3FF53F60BE8BC07DC06840B5C09040EAC0C7C03A4064C0DEC0B63F48C00BC0D2BDF43F85C08DBFC73F3C3D09C00ABF93BF123F29404140B7BFE1C03C404BBFE6C0B63FD3BFB740FE3F413F43BF4E40B2C08EBF06C0EC40933F2FC05FC028C0B540BE3F303E54C03F3C1440894028C0533F24BFE03F803F47405A40F1BF85C0D7BE803F13C007C0CE3F494088C0B0C032C0FD3F7CBF224083BFB7BF6A405240DFBE88C0DA3E70C0A83E9D40F6BF7040643F2BC08DBF5340C6C0903F9B40BEBE8FC0973D423FB2BF49C0AB3F423FA64050BF994074C005C08F40F23E363ECCC0D2C04EBD8FC0DEC04F40873F7F406940B4BF97C07EC0D73FD240C53D0441B740F33FFB3F19C088BF66C0183FF63F0B40C33E0CC0F3BE6B40AE40F43E593FE840194080C05CC0A14093BF103F32408440B43F83C0B5BF2EC040BFE0BECF3D0D3F884034400740B6BF77BFD4BF21BF423E1040D7BFDBBF893F0340BC40B43EE9BF53C095C0ADC0F03E6AC09440EBC095BF44C0C2BF13C0B7C001C02940B93F863FD83F25BF91C08DC008C04CC0123FBC3F1140A440C13F28C09940EFC09C3DD73ED83F2EC0123E88C0C8BEDF3E0D401A4016408A4044BF343F0BBF2DC0FDBE204041C0D0BFD7C0E8BEC2BF24403FC0C83E48BDB1BF14BFA7C04AC0034078BF883FCC402DBF1FC099402BBE3B3F92BFC840623F8CBF63BE1A3F0CC0033F63BE91C0B240E93FD03D97408DBF8BBF7DC0A2C060C039BF38408D3F903F373F8840074050C0C1BF183FECBFA7405BBFCA4088C0DCBF9E4004BE5B40CC3E563CE2400A4002C0C8C0D43F7DC03B3E0C41793F0AC0303F2040B2C039C040403CBD21C0E03E444054C08CC06A403840DE3FECBE2A401CC08D3F80BC9CBF57C03CC06540A0C019C056C0473F0C40F93E8F3D3CC0C73FA53F4140294020C0CCBF2240E23F6DC00A4065C0603FCE3F3CC059405140A93D3740E9BF0041C1C08A3EF73E9D3F9EBF1A3F70C0EE3E01409340E5BFACBF573F43BF2C3F04409440B1409C3FD63FE83E25C032C0F03F7F40C1BF96404A40A0BF1A40DE3E11BF2DC003C0C5BF97BF843FCCC01E401040463FCD3F9DBE87C0AF40BEBFDC3F8DC0333F1CBF59406240AAC083BE3141B8BF373F434038BFA13F0240B4BFD83DE2BD3A409D3E854069BEBF3F514092C0D53E5F3EDF3F763F293FC43E1740943C23C0D23F103FA5BF64C0703F95BFFBBF45C06540D4BFD4BE5B3F57BE4BC01CBF0DC08BBFE4BED33FA2C0F4BF41C0323F4FBF084002408B4091406B3FC5BE28C035C02F3FB440B0BFB23C0DBFDABF22BFAE408B40873E36BC28C0E1BE68403240373F97BDEEBFA3BF4A405B40F5BFCFC0033F8B408940CFC06E3D82C09B3EEBBF53BF7E40D1BFBE3F5DBFBDBF4E3D1FBF7BC088C02CBE76BF2CBD5EBED13EC9C096C0CFBE3240DC3F39C03CBF37C054401B3F6440AB3E253F204081404A3F37408E40F1BFBBBFA13FA440C1BF4EC05FC09ABE79C0"> : tensor<3x5x40xbf16>
    return %0 : tensor<3x5x40xbf16>
  }
}

