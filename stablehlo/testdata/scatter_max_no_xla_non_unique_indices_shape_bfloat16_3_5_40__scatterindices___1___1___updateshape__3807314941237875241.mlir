// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>)
    %2 = call @expected() : () -> tensor<3x5x40xbf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %5 = stablehlo.maximum %arg0, %arg1 : tensor<bf16>
      stablehlo.return %5 : tensor<bf16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xbf16>, tensor<2x1xi32>, tensor<3x5x2xbf16>) -> tensor<3x5x40xbf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xbf16>, tensor<3x5x40xbf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>) {
    %0 = stablehlo.constant dense<"0xA540F340264012C047BFE43F9440A6BF4D40CF3FD8BF97C0ACBF633E3FC030C0D5BF63C069C0913F87C057BF65C0DE3F984066C05440D4BF5F3F88BD26405E40D24088C0AD40CA3D53BF4F407ABF94C0E1BF42BE023F844027C0A33EBC3F094080C06EC0D9C0DB3F05401D3ED6BF113E0AC0AC3E0D3FE54016BE9D3F3640C2BFC6BE143D7EC07ABE6D40B73F68C03DBF354047407FC08AC0B2BFEC3F87BE894088BF96C0E33F45BFB5BF99BF6CBFA33FC3BD3D3F4FC058C0A4BF18C083C02D40014173BED93F6040C240473F86402BC0ECC032C0AD408BC0883F2BBF4AC015C0D840963F973E3CC03B3F37BFB2C0B1C0D9BF993FA13FD5BFE3C09B3FB3BF0CC0C73F9C400CC00C40823F304035BFAE40ADBF04BFC7C0FDBFD8C085404D4053C00B3FDF3FD8BF0A3F53BF1FC08A40C0BFAE4002BFC0C0ADC0C23FB83F1BC0C340143F7F3F77400540C0C03FC0B13FF5C0AB3FA2BE1E405140DE3FDEBF0AC1CC3F4BC07B3E394038407ABFE540CCBE1D40FFBF23BE6F3FD8BE37C029BFABBF3440F7BFA1400940D83FE73F71C05FC05CBF82405440C5BF5FC06DBFEDBF274037BF633E2DC01AC0614021402D3F18416EC02BC0853F7D3F99C082BF24C0503FB9BECD3FCBC076C0953F7E405E3E9FC000C008406F40273E94BF9E4040C05ABF994052BF4640D1BFD94044BE0DBFC9BEF93F7140E9C09F3FC33F61C0CCC028C0604061C0BBC0C6BFDBBE07C097BF94C0873EABC045BF8B4017C0F3BF263F69BC15C025409CBFD43F464066C04940D93FBBBF5EC07040163F82C0F3BEC23F95BF533E1E4036BF76401440034038C0D73F0F3F8F3F60BE43C060C0A83FABBFA1BF07BF59BFDCBF8140173FB04027405C407FC017BFD63F75402E3FB53F083FEC3FBFBE87401BBF9EBEC2BE843FD6BE97BF22409240A5C0E8BFB0BFF6BFACC0B43FDB3D1440AF3FA43F104020C04CBE07C08DBDF13F6DC07F3D85C01FC0403F65BFD4BF84406FC046C0AF3F15C077BD69C083C04B4009407540EDBF4C3FFF3FA24013BF853F874075C0C7BF1D40B3BF983FDC3FAA40B33F603E26C0AFC0B1C00840B2BF534003C006407E3F1040983E333F5F3FBBC08DBF6E40EE3FFCBEF5BBCDBFA2BF96BB5E40E23F53408E40E93F31BD8EC0A44086C0013E4CC055C0FE40BCBF34C0CE3FE43F484031406FC0B14002C04EC0F2BF8DC05DC0023F78403B3F8DC03B4037C0BF4028C0B73F223F56C045BF6C3FCF3FC34061C00DC068BEA93E19C01F406CBFDC3E53C053C05440ECBFB83F393ECE3F1DBF4140C0C0A73E8F40163F00BD99BF25BEA7C07B3F9EBF5F3FDDBE18C0EE3F46C05FBF06C009C0464022403540E040033F42400EC050C039BEC63FC8BF3240ECBFECBFDDBF19C02EC08640A43FABC04540803FB9BF43BF253FA0BF05409EBFA740AEBE91C0923F07C0FBBE9440D43F3FC032C05CC020C0933F803DF2C087BE3DC0644062404E405EC0844048BE2F4020C0CE409840E4BF0C404C4074BFABBFD4C063406540B0BF9BC0844013409DBF21C0553F9BBD4FBE3940DA40C63F8240633EC0407EBF34C059C0B23F84407F404EC071409DBF10BF77BF70C0FCBE6F3F74BF833F5640D53FF53F7DC090BFC3405E3FFB3F114005C0773F78C045BE04C048C01B4098C0AE3F9F3F0F400F4059C0C2C08BC0ADC0DDBF5ABF54BE54BF"> : tensor<3x5x40xbf16>
    %1 = stablehlo.constant dense<[[[-2.265630e-01, -7.187500e+00], [2.828130e+00, 1.070310e+00], [-1.539060e+00, -1.109380e+00], [-3.218750e+00, 2.656250e-01], [4.343750e+00, 2.390630e+00]], [[-2.382810e-01, -2.718750e+00], [2.390630e+00, -1.108400e-01], [3.578130e+00, 3.300780e-01], [-3.546880e+00, -1.025390e-01], [-3.859380e+00, 9.960930e-01]], [[-4.062500e+00, 3.312500e+00], [-1.203130e+00, 3.546880e+00], [-2.093750e+00, -1.375000e+00], [9.062500e-01, -5.906250e+00], [-4.906250e+00, 1.156250e+00]]]> : tensor<3x5x2xbf16>
    return %0, %1 : tensor<3x5x40xbf16>, tensor<3x5x2xbf16>
  }
  func.func private @expected() -> tensor<3x5x40xbf16> {
    %0 = stablehlo.constant dense<"0xA540F340264012C047BFE43F9440A6BF4D40CF3FD8BF97C0ACBF633E3FC030C0D5BF63C069C0913F87C057BF65C0DE3F984066C05440D4BF5F3F88BD26405E40D24088C0AD40CA3D53BF4F407ABF94C0E1BF3540023F844027C0A33EBC3F094080C06EC0D9C0DB3F05401D3ED6BF113E0AC0AC3E0D3FE54016BE9D3F3640C2BFC6BE143D7EC07ABE6D40B73F68C03DBF354047407FC08AC0B2BFEC3F87BE894088BF8EBFE33F45BFB5BF99BF6CBFA33FC3BD3D3F4FC058C0A4BF18C083C02D40014173BED93F6040C240473F86402BC0ECC032C0AD408BC0883F2BBF4AC015C0D840963F973E3CC03B3F37BFB2C0B1C0D9BF993FA13FD5BFE3C09B3FB3BF0CC0C73F9C400CC00C40823F304035BFAE40ADBF04BFC7C0FDBFD8C085404D4053C00B3FDF3FD8BF0A3F53BF1FC08A40C0BFAE4002BFC0C0ADC0C23FB83F1BC0C340143F8B4077400540C0C03FC0B13FF5C0AB3FA2BE1E405140DE3FDEBF0AC1CC3F4BC07B3E394038407ABFE540CCBE1D40FFBF23BE6F3FD8BE37C029BFABBF3440F7BFA1400940D83FE73F71C05FC05CBF82405440C5BF5FC06DBFEDBF274037BF633E2DC01AC0614021402D3F18416EC02BC0853F7D3F99C082BF24C0503FB9BECD3FCBC076C0953F7E405E3E9FC000C008406F40273E94BF9E4040C05ABF994052BF4640D1BFD94044BE0DBFC9BEF93F7140E9C09F3FC33F61C0CCC028C0604061C0BBC0C6BFDBBE07C097BF94C0873EABC045BF8B4017C0F3BF263F69BC15C025409CBFD43F464066C04940D93FBBBF5EC07040163F82C0F3BEC23F95BF533E1E4036BF76401440034038C0D73F0F3F8F3F60BE43C060C0A83FABBFA1BF07BF59BFDCBF8140173FB04027405C407FC017BFD63F75402E3FB53F083FEC3FBFBE8740D2BD9EBEC2BE843FD6BE97BF22409240A5C0E8BFB0BFF6BFACC0B43FDB3D1440AF3FA43F104020C04CBE07C08DBDF13F6DC07F3D85C01FC0403F65BFD4BF84406FC046C0AF3F15C077BD69C083C04B4009407540EDBF4C3FFF3FA24013BF853F874075C0C7BF1D40B3BF983FDC3FAA40B33F603E26C0AFC0B1C00840B2BF534003C006407E3F1040983E333F5F3FBBC08DBF6E40EE3FFCBEF5BBCDBFA2BF96BB5E40E23F53408E40E93F31BD8EC0A44086C0013E4CC055C0FE40BCBF34C0CE3FE43F484031406FC0B14002C04EC0F2BF8DC05DC0023F78403B3F8DC03B4037C0BF4028C0B73F223F56C045BF6C3FCF3FC34061C00DC068BEA93E19C01F406CBFDC3E53C053C05440ECBFB83F393ECE3F1DBF4140C0C0A73E8F40163F00BD99BF25BEA7C07B3F9EBF5F3FDDBE18C0EE3F46C05FBF06C009C0464022403540E040033F42400EC050C039BEC63FC8BF3240ECBFECBFDDBF19C02EC08640A43FABC04540803FB9BF43BF253FA0BF05409EBFA740AEBE91C0923F07C0FBBE9440D43F3FC032C05CC020C0933F803DF2C087BE683F644062404E405EC0844048BE2F4020C0CE409840E4BF0C404C4074BFABBFD4C063406540B0BF9BC0844013409DBF21C0553F9BBD4FBE3940DA40C63F8240633EC0407EBF34C059C0B23F84407F40943F71409DBF10BF77BF70C0FCBE6F3F74BF833F5640D53FF53F7DC090BFC3405E3FFB3F114005C0773F78C045BE04C048C01B4098C0AE3F9F3F0F400F4059C0C2C08BC0ADC0DDBF5ABF54BE54BF"> : tensor<3x5x40xbf16>
    return %0 : tensor<3x5x40xbf16>
  }
}

