// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>)
    %2 = call @expected() : () -> tensor<3x5x40xf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %5 = stablehlo.maximum %arg0, %arg1 : tensor<f16>
      stablehlo.return %5 : tensor<f16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xf16>, tensor<2x1xi32>, tensor<3x5x2xf16>) -> tensor<3x5x40xf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xf16>, tensor<3x5x40xf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>) {
    %0 = stablehlo.constant dense<"0x5040BBC4384142436D3EE3BC8043493EFBB7F0C1BDC1D240DEC45E41FABEB43E4C41B73963C05E3A1FC281C748B1D13C3D40EBBA06C7BAC1A13F5536023E48C10446C5C0A4B95DC2E1C3A1C2EDC042C1CE41E8BB8FC2A5C451C2813677C0BA3C043C75C32D30734198BCC1C0113F70AECE4365B0E8BDB6C3E34476C063C0FAC4C3C301331DB24DBD82C090441CC45D432EC54139C4C0DEC21E4498BDFBC32DC24C48B7446DBA383CF9438A41993D66C132413643D9BCFCB62C43FE3246C413B807A008C57DC5AE45503F97C08F2DE3C04646F241763920BDA23CD83D68B8DB403CBEEFB9433FAFC1B23647C2C0C048BA0AC0BA30A73E28C980ADA343E3398B3D2541ADBBFF43F842B0433FC0903B63C41742CAC5A83262BD4E37CFC0F0434FB503B95D3F0A3E6AC440A8794100389845513F39C45244B0B502BED33E414466BB33C4DBC4F6C4143E2841BE418CC1A443A8B474401EBD8EC030C4C339AFC17539C2C008386742AF405F4140403FC094B94545EAC635C62BBCB4301FC19BBB1BBFB73E1640193D9F3E0CC5E9C24144A738B03C2DBD29BF8BC40F457340DABD4BA5C8C5AA45B8366ABC524057C065429C3F19BD51C60D3ED3BDAB4378C6A7BFAEC71EC0BF440FC0673C02B881350AC45AC179BEC1C1D9AF90B7CBB8A1C11E39B7B52BBE7244E340F0C43CC0F63ED2BD38C41E3EEB3FE83785BFEFBE85A8FF453BC217C6C2BD7C45ADBC4C4507425EB89FB84937624428328DBC46C2744243433DB9F641153EC9C1B7B9393ADC4362C08CBE554105BD903814B82FC2AEB2A13F2B43463E63C0BE4072BE2740723A2829643FF2C220BB743DB440DEBD95BFE23F4D440DC256402B423A4401452D453A3F6DC16A41F2B075C2B7C2A13DDD41EBC1B2370CB74FC47ABE03C5CCA857B816408B3C3E3F3B4764BD054715B6883851B5FAC00CC4DA384ABC18BC2D379BBFC3BC2EC080BC6442DEC0C7B7F04424C234C0DF45A2ACD2C452424AB9633CCE405AAB834438394832B840CC3EC14068412F3A582E50C0EAC28140F7BD3CC345BD01BF91BF9CBEAD4509B8C8BDD744D33CE1C2A64354BDA23DD7C03BC3D83D19C6FE43DD44A7B9A6C269C2AEB5973EFAB9EF3FD23DC23F6F3FB2B9673F3D36B5458840573D4AC30839A53D96C0ABB8BDB87B4676C55334B7C574C439409FB851C498441AC16940DBBFCCBF15341941E345B4C0BEBA253839C3D6BCDE31BD3DBE3EAF3CF43AA7414CB13E4197AED93C6843BAC2AFBEC5BDB437A9BFBFC3E2BD253E494473BF093C0D426FBF55C5D2B42A4821B1D0C291BDBBBE3EC45DBCE9343FC427BC7C434A4154C0CCC175406DC003C177C25DC093440E99F7C275C3813C7F46AD3E8743C6BD0C43DE4264C180B7DCC05342473F0AC342C082C31A3CD4C7A93E314372B9473C81B407C47ABD49439541BAC49328CE4687C37344BF3C0B4524BE35C12BC42D3CE4BE01C5BA3E94C098C00BC0583C934324BCE0C3C144894411C24340BB3E0F3E7A3AFEBDAEC557C10FC4E244D5C19340023D7A3D56BF46463C35134279418E4418367E41043E3EC4223C8C31D342BE4060BCCEC229B99EC1D6BABE415A413BC1B3C2B8439A40D53874C27ABDA0BC1DB6D7403F46DE43D5C0E94495B911BCC73657C1923C53BD2DC448C4E53B5947034034C56DC3F43D8EBD473CE8C41646"> : tensor<3x5x40xf16>
    %1 = stablehlo.constant dense<[[[4.226560e+00, 3.142580e+00], [8.364250e-01, 2.746090e+00], [1.351560e+00, -1.562500e+00], [2.880860e-01, 8.183590e-01], [6.108400e-01, 1.076170e+00]], [[-3.525390e+00, 1.011720e+00], [-1.012700e+00, 2.478520e+00], [-3.931640e+00, 2.115230e+00], [-1.037110e+00, -6.433590e+00], [3.130860e+00, 7.121090e+00]], [[-3.453130e+00, -1.425780e+00], [-3.928220e-01, 1.623050e+00], [2.890630e+00, 6.203130e+00], [3.484380e+00, 4.097660e+00], [2.800780e+00, 6.953130e+00]]]> : tensor<3x5x2xf16>
    return %0, %1 : tensor<3x5x40xf16>, tensor<3x5x2xf16>
  }
  func.func private @expected() -> tensor<3x5x40xf16> {
    %0 = stablehlo.constant dense<"0x50403A44384142436D3EE3BC8043493EFBB7F0C1BDC1D240DEC45E41FABEB43E4C41B73963C05E3A1FC281C748B1D13C3D40EBBA06C7BAC1A13F5536023E48C10446C5C0A4B95DC2E1C3A1C2EDC042C1CE417E418FC2A5C451C2813677C0BA3C043C75C32D30734198BCC1C0113F70AECE4365B0E8BDB6C3E34476C063C0FAC4C3C301331DB24DBD82C090441CC45D432EC54139C4C0DEC21E4498BDFBC32DC24C48B7446DBA383CF9438A41993D66C132413643D9BCFCB62C43FE3246C413B807A008C57DC5AE45503F97C08F2DE3C04646F241763920BDA23CD83D68B8DB403CBEEFB9433FAFC1B23647C2C0C048BA0AC08C3AA73E28C980ADA343E3398B3D2541ADBBFF43F842B0433FC0903B63C41742CAC5A83262BD4E37CFC0F0434FB503B95D3F0A3E6AC440A8794100389845513F39C45244B0B502BED33E414466BB33C44E3CF6C4143E2841BE418CC1A443A8B474401EBD8EC030C4C339AFC17539C2C008386742AF405F4140403FC094B94545EAC635C62BBCB4301FC19BBB1BBFB73E1640193D9F3E0CC5E9C24144A738B03C0C3C29BF8BC40F457340DABD4BA5C8C5AA45B8366ABC524057C065429C3F19BD51C60D3ED3BDAB4378C6A7BFAEC71EC0BF440FC0673C02B881350AC45AC179BEC1C1D9AF90B7CBB8A1C11E39B7B52BBE7244E340F0C43CC0F63ED2BD38C41E3EEB3FE83785BFEFBE85A8FF453BC217C6C2BD7C45ADBC4C4507425EB89FB84937624428328DBC46C2744243433DB9F641153EC9C1B7B9393ADC4362C08CBE55413B40903814B82FC2AEB2A13F2B43463E63C0BE4072BE2740723A2829643FF2C220BB743DB440DEBD95BFE23F4D440DC256402B423A4401452D453A3F6DC16A41F2B075C2B7C2A13DDD41EBC1B2370CB726BC7ABE03C5CCA857B816408B3C3E3F3B4764BD054715B6883851B5FAC00CC4DA384ABC18BC2D379BBFC3BC2EC080BC6442DEC0C7B7F04424C234C0DF45A2ACD2C452424AB9633CCE405AAB834438391F47B840CC3EC14068412F3A582E50C0EAC28140F7BD3CC345BD01BF91BF9CBEAD4509B8C8BDD744D33CE1C2A64354BDA23DD7C03BC3D83D19C6FE43DD44A7B9A6C269C2AEB5973EFAB9EF3FD23DC23F6F3FB2B9673F3D36B5458840573D4AC30839A53D96C0ABB8BDB87B4676C55334B7C574C439409FB851C498441AC16940DBBFCCBF15341941E345B4C0BEBA253839C3D6BCDE31BD3DBE3EAF3CF43AA7417E3E3E4197AED93C6843BAC2AFBEC5BDB437A9BFBFC3E2BD253E494473BF093C0D426FBF55C5D2B42A4821B1D0C291BDBBBE3EC45DBCE9343FC427BC7C434A4154C0CCC175406DC003C177C25DC093443446F7C275C3813C7F46AD3E8743C6BD0C43DE4264C180B7DCC05342473F0AC342C082C31A3CD4C7A93E314372B9473C81B407C47ABD49439541BAC49328CE4687C37344BF3C0B4524BE35C12BC42D3C194401C5BA3E94C098C00BC0583C934324BCE0C3C144894411C24340BB3E0F3E7A3AFEBDAEC557C10FC4E244D5C19340023D7A3D56BF46463C35134279418E4418367E41043E3EC4223C8C31D342BE40F446CEC229B99EC1D6BABE415A413BC1B3C2B8439A40D53874C27ABDA0BC1DB6D7403F46DE43D5C0E94495B911BCC73657C1923C53BD2DC448C4E53B5947034034C56DC3F43D8EBD473CE8C41646"> : tensor<3x5x40xf16>
    return %0 : tensor<3x5x40xf16>
  }
}

