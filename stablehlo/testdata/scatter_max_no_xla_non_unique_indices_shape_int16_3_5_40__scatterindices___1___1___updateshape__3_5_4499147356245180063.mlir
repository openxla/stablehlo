// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xi16>, tensor<3x5x2xi16>)
    %2 = call @expected() : () -> tensor<3x5x40xi16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<i16>, %arg1: tensor<i16>):
      %5 = stablehlo.maximum %arg0, %arg1 : tensor<i16>
      stablehlo.return %5 : tensor<i16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xi16>, tensor<2x1xi32>, tensor<3x5x2xi16>) -> tensor<3x5x40xi16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xi16>, tensor<3x5x40xi16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xi16>, tensor<3x5x2xi16>) {
    %0 = stablehlo.constant dense<"0x020000000100FDFFFFFF0200FFFFFEFF00000200FCFF00000500FFFF0100FDFF000000000200FCFF0000FFFFFEFF0100FFFF0100050003000400030000000000FEFF0000FBFFFFFF0300FFFF0100FDFF010001000000FEFF0300060000000600FFFF0400FFFFFFFFFCFFFCFF0200FCFF0100010002000000FDFFFFFFFDFF00000500FFFFFEFFFFFFFDFF0000FDFF02000200000000000000F9FF000003000100FCFFFDFF0500FDFF00000100FEFFFCFFFEFF0000FBFF0400FEFFFDFF0000FEFF0000FBFF0000FEFF0300020001000000FFFF0200FCFFFEFFF9FF000000000000FAFFFEFF01000000FFFF00000000020001000600FFFF01000200FFFF0000FAFF0300FDFF040000000100000000000000FFFF000003000000FEFFFBFF040000000200FFFFFDFF02000000020000000100FFFFFDFF0300FDFF0000FEFF0000FDFF01000400FEFF0200FFFFFCFFFFFF0100FCFFFEFFFDFF00000100FEFF020004000000FFFF040000000000FFFF0000FEFFFCFF04000000030000000300020000000100FEFF03000500FFFFFEFF04000000FFFF0000FDFF0200FBFFFDFFFFFF0000FDFF0100FCFF0200FFFF0000FDFFFEFFFDFF0000FEFF0000FCFF0200000005000600FEFF0000FDFFFAFF0300FDFF03000200FCFFFCFF00000000000008000000FEFF0100FFFFFCFF0200F8FF010000000100000003000100000001000200FFFF01000000FEFFFEFF02000400FCFF030000000000FEFFFAFFFFFF0300FFFF000000000100FEFF0000010001000100000004000300FCFFFEFF0100FFFF000000000200FDFF000003000200FDFF0800FDFF0100FFFF070007000000FEFF000001000300FDFFFFFF05000100FDFF0000FDFFFDFF03000000000000000600000004000400FFFF0000FEFFFCFFFEFF03000200FEFF01000300FEFF02000300020004000000000001000300000002000200000001000000FBFFFDFFFFFF0200FFFFFEFF0000FEFFFFFF000003000000FEFFFEFFFEFF06000300FEFFFCFF030000000400030001000700FFFF00000000FCFF01000000FFFFFFFF02000400000000000600FDFFFAFF05000300FAFF0000FDFF0200FBFFFCFFFDFF0100010001000400050001000100FDFF0000FFFF0100FFFFFDFF000004000300000001000000020002000000FFFFFFFFFDFF0000FCFFFFFF040004000000020003000000FFFF01000000FDFF02000000FFFFFAFFFAFF0100040000000800FCFFFFFF0000FEFFFFFF0000020001000400030005000000FCFF000002000000FFFFFDFFFEFFFFFF0000010003000300FFFFFEFF01000000020003000300FFFFFFFF0200FAFFFFFF0300FCFFFCFF00000300FFFF03000100FCFF00000200FEFF01000000FEFFFDFF040005000000FEFFFEFF0100000001000300FCFFFEFFFEFF01000100FEFF000000000000FDFF04000000FFFF00000000FEFF0400FFFF01000300FDFF000000000800FFFF00000000F8FF0000FBFF0100FFFFFEFF040000000000FFFFFFFFFEFF0000FDFF00000000FEFF00000000FFFFFFFFFFFF0000FEFF040001000300FFFFFBFF000003000000FEFF03000000F8FFFFFF0000FDFF0000FEFFFEFF00000000FDFFFEFFFEFF000006000200FDFF0000020002000000FEFFFDFF060004000500FFFF000001000000FEFF03000100010004000300"> : tensor<3x5x40xi16>
    %1 = stablehlo.constant dense<[[[3, -1], [-1, -1], [0, 1], [-2, -2], [-4, -3]], [[0, 0], [-2, 1], [0, 5], [5, 1], [0, -1]], [[-7, 2], [-3, -1], [3, 2], [-4, 1], [0, -1]]]> : tensor<3x5x2xi16>
    return %0, %1 : tensor<3x5x40xi16>, tensor<3x5x2xi16>
  }
  func.func private @expected() -> tensor<3x5x40xi16> {
    %0 = stablehlo.constant dense<"0x020003000100FDFFFFFF0200FFFFFEFF00000200FCFF00000500FFFF0100FDFF000000000200FCFF0000FFFFFEFF0100FFFF0100050003000400030000000000FEFF0000FBFFFFFF0300FFFF0100FDFF010001000000FEFF0300060000000600FFFF0400FFFFFFFFFCFFFCFF0200FCFF0100010002000000FDFFFFFFFDFF00000500FFFFFEFFFFFFFDFF0000FDFF02000200000000000000F9FF000003000100FCFF01000500FDFF00000100FEFFFCFFFEFF0000FBFF0400FEFFFDFF0000FEFF0000FBFF0000FEFF0300020001000000FFFF0200FCFFFEFFF9FF000000000000FAFFFEFF01000000FFFF00000000020001000600FFFF01000200FFFF0000FAFF0300FDFF040000000100000000000000FFFF000003000000FEFFFBFF040000000200FFFFFDFF02000000020000000100FFFFFDFF0300FDFF0000FEFF0000FDFF01000400FEFF0200FFFFFCFFFFFF0100FCFFFEFFFDFF00000100FEFF020004000000FFFF040000000000FFFF0000FEFFFCFF04000000030000000300020000000100FEFF03000500FFFFFEFF04000000FFFF0000FDFF0200FBFFFDFFFFFF0000FDFF0100FCFF0200FFFF0000FDFFFEFFFDFF0000FEFF0000FCFF0200000005000600FEFF0000FDFFFAFF0300FDFF03000200FCFFFCFF00000000000008000000FEFF0100FFFFFCFF0200F8FF010000000100000003000100000001000200FFFF01000000FEFFFEFF02000400FCFF030000000000FEFFFAFFFFFF0300FFFF000000000100FEFF0000010001000100000004000500FCFFFEFF0100FFFF000000000200FDFF000003000200FDFF0800FDFF0100FFFF070007000000FEFF000001000300FDFFFFFF05000100FDFF0000FDFFFDFF0300000000000000060000000400040005000000FEFFFCFFFEFF03000200FEFF01000300FEFF02000300020004000000000001000300000002000200000001000000FBFFFDFFFFFF0200FFFFFEFF0000FEFFFFFF000003000000FEFFFEFFFEFF06000300FEFFFCFF030000000400030001000700FFFF00000000FCFF01000000FFFFFFFF02000400000000000600FDFFFAFF05000300FAFF0000FDFF0200FBFFFCFFFDFF0100010001000400050001000200FDFF0000FFFF0100FFFFFDFF000004000300000001000000020002000000FFFFFFFFFDFF0000FCFFFFFF040004000000020003000000FFFF01000000FDFF02000000FFFFFAFFFAFF0100040000000800FCFFFFFF0000FEFFFFFF0000020001000400030005000000FCFF000002000000FFFFFDFFFEFFFFFF0000010003000300FFFFFEFF01000000020003000300FFFFFFFF0200FAFFFFFF0300FCFFFCFF03000300FFFF03000100FCFF00000200FEFF01000000FEFFFDFF040005000000FEFFFEFF0100000001000300FCFFFEFFFEFF01000100FEFF000000000000FDFF04000000FFFF00000000FEFF0400FFFF01000300FDFF000000000800FFFF00000000F8FF0000FBFF0100FFFFFEFF040000000000FFFFFFFFFEFF0000FDFF00000000FEFF00000000FFFFFFFFFFFF0000FEFF040001000300FFFFFBFF000003000000FEFF03000000F8FFFFFF0000FDFF0000FEFFFEFF00000000FDFFFEFFFEFF000006000200FDFF0000020002000000FEFFFDFF060004000500FFFF000001000000FEFF03000100010004000300"> : tensor<3x5x40xi16>
    return %0 : tensor<3x5x40xi16>
  }
}

