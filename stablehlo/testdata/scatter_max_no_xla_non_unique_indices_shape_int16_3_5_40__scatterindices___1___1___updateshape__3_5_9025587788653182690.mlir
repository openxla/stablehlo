// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xi16>, tensor<3x5x2xi16>)
    %2 = call @expected() : () -> tensor<3x5x40xi16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<i16>, %arg1: tensor<i16>):
      %5 = stablehlo.maximum %arg0, %arg1 : tensor<i16>
      stablehlo.return %5 : tensor<i16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xi16>, tensor<2x1xi32>, tensor<3x5x2xi16>) -> tensor<3x5x40xi16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xi16>, tensor<3x5x40xi16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xi16>, tensor<3x5x2xi16>) {
    %0 = stablehlo.constant dense<"0x02000400FBFFFAFF0000050001000800070000000200FFFF010003000600FEFF0300FDFF00000000000002000000FFFF010003000100FFFFFFFF00000000FEFFFEFF0000FEFF03000100FDFF0000000001000000030001000100F9FF0200000005000000FEFF00000000FEFF0200000001000200FCFF0000040000000100FCFF0200FDFF000000000000FCFFFDFFFFFF040001000000FEFF010001000000FDFFFDFFFEFF0300000003000000000000000300050000000500FEFF0000FEFFFFFFFCFFFEFF0200020001000000FDFF000003000300FBFF00000000000001000300FCFF0300FEFFFBFF00000300FEFF0000FBFFFCFF0200FCFF0200FFFF0100FFFF0000FFFF0200FFFF0100FDFF000000000000FCFF0300FAFF0000FFFF0100FCFFFFFFFBFF0200FFFF00000000FDFFFFFF00000100FCFF0200010000000100FEFF00000000FFFFFEFFFDFFFDFF00000300FFFFFEFFFEFF0000020000000500030002000000040001000100FEFF0000FDFF000002000500FFFFFDFFFDFFFEFFFCFF0000FEFF0000FBFF0600000002000200FDFF0000000001000000FCFF0600FDFF03000600000001000000FAFF00000100FCFF0400FDFFFDFF0000FEFF010003000200FBFF02000300FFFF0000FDFFFEFF0300000000000100FBFF00000300FFFFFEFFFFFF020000000000FAFF0400FFFFFBFF00000600FDFFFCFF0000000002000000FFFFFDFF02000100FEFFFEFFF7FFFEFF00000000FEFF0100FEFFFBFFFAFF00000300000001000000FFFF0100FFFF0500FFFF0200010001000200FFFF00000300FDFF00000100FCFF00000200FFFFFDFF00000300040001000100000002000200FCFF0100FEFF0300FBFFFEFFFEFF00000200FFFF0200FBFF0100FFFF0000FDFF00000300FCFF0000000000000000FCFF0300000000000300FFFF010000000200FDFF0000FEFF01000200FEFFFFFF020006000100FAFF0200FAFFFFFF070005000500FDFF0400000003000400FFFF0000040006000000FAFFFCFFFCFF00000300FDFFFCFF0200FDFF0000000000000100FFFF05000100FFFFFFFF0000FFFF0100FAFFFFFF03000400FEFF0100FDFFFCFF010002000200F9FFFDFFFDFFFCFF0100FDFF0000FEFFFFFFFDFFFFFFFEFFFFFF010002000700FEFF03000000FFFFFCFF03000000FFFF0500FCFFFEFF0000FEFF0600FFFF0000FFFFFAFFFFFFFDFFFDFF000000000400FDFF0000FAFF0000FFFF01000500FDFF020003000200FDFF0000FDFFFBFFFFFF0000FFFFFEFF04000500010006000400000001000200FBFFFDFF000001000100FDFF000003000500FFFFFFFF01000000FFFF04000500FEFFFFFFFEFF0000000008000100FFFFFEFFFFFF02000300FEFF04000000FFFF000000000500FFFFFFFF0200FEFF01000200FDFF0200FFFF0100000000000400FFFFFEFF01000000FDFF0000FCFFFDFF0000FEFFFDFF0000FDFF0800FBFFFFFF0200000002000000FCFF01000200FDFFFDFFFEFF0000030000000100FCFF010005000000040001000000FFFF03000000FEFF000001000400FFFF0100FFFFFEFF0000FDFFFBFF00000000FEFF0400FFFF050003000000F6FFFEFF01000000FFFFFDFFFEFF0000FFFFFFFF010000000100FFFF06000100FEFF0200FDFFFFFFFEFF00000000050002000000FFFFFEFFFDFF0300"> : tensor<3x5x40xi16>
    %1 = stablehlo.constant dense<[[[0, -1], [2, 0], [1, 1], [0, 1], [1, 0]], [[-3, 1], [1, 3], [-2, 6], [4, -2], [6, 1]], [[-1, 4], [2, 0], [-2, 2], [4, 0], [-3, 4]]]> : tensor<3x5x2xi16>
    return %0, %1 : tensor<3x5x40xi16>, tensor<3x5x2xi16>
  }
  func.func private @expected() -> tensor<3x5x40xi16> {
    %0 = stablehlo.constant dense<"0x02000400FBFFFAFF0000050001000800070000000200FFFF010003000600FEFF0300FDFF00000000000002000000FFFF010003000100FFFFFFFF00000000FEFFFEFF0000FEFF03000100FDFF0000000001000200030001000100F9FF0200000005000000FEFF00000000FEFF0200000001000200FCFF0000040000000100FCFF0200FDFF000000000000FCFFFDFFFFFF040001000000FEFF010001000000FDFFFDFF01000300000003000000000000000300050000000500FEFF0000FEFFFFFFFCFFFEFF0200020001000000FDFF000003000300FBFF00000000000001000300FCFF0300FEFFFBFF00000300FEFF0000FBFF01000200FCFF0200FFFF0100FFFF0000FFFF0200FFFF0100FDFF000000000000FCFF0300FAFF0000FFFF0100FCFFFFFFFBFF0200FFFF00000000FDFFFFFF00000100FCFF0200010000000100FEFF00000100FFFFFEFFFDFFFDFF00000300FFFFFEFFFEFF0000020000000500030002000000040001000100FEFF0000FDFF000002000500FFFFFDFFFDFFFEFFFCFF0000FEFF0000FBFF0600000002000200FDFF0100000001000000FCFF0600FDFF03000600000001000000FAFF00000100FCFF0400FDFFFDFF0000FEFF010003000200FBFF02000300FFFF0000FDFFFEFF0300000000000100FBFF00000300FFFFFEFF0300020000000000FAFF0400FFFFFBFF00000600FDFFFCFF0000000002000000FFFFFDFF02000100FEFFFEFFF7FFFEFF00000000FEFF0100FEFFFBFFFAFF00000300000001000000FFFF0100FFFF050006000200010001000200FFFF00000300FDFF00000100FCFF00000200FFFFFDFF00000300040001000100000002000200FCFF0100FEFF0300FBFFFEFFFEFF00000200FFFF0200FBFF0100FFFF0000FDFF04000300FCFF0000000000000000FCFF0300000000000300FFFF010000000200FDFF0000FEFF01000200FEFFFFFF020006000100FAFF0200FAFFFFFF070005000500FDFF0400000003000400FFFF0000060006000000FAFFFCFFFCFF00000300FDFFFCFF0200FDFF0000000000000100FFFF05000100FFFFFFFF0000FFFF0100FAFFFFFF03000400FEFF0100FDFFFCFF010002000200F9FFFDFFFDFFFCFF010004000000FEFFFFFFFDFFFFFFFEFFFFFF010002000700FEFF03000000FFFFFCFF03000000FFFF0500FCFFFEFF0000FEFF0600FFFF0000FFFFFAFFFFFFFDFFFDFF000000000400FDFF0000FAFF0000FFFF02000500FDFF020003000200FDFF0000FDFFFBFFFFFF0000FFFFFEFF04000500010006000400000001000200FBFFFDFF000001000100FDFF000003000500FFFFFFFF01000000FFFF04000500FEFFFFFF02000000000008000100FFFFFEFFFFFF02000300FEFF04000000FFFF000000000500FFFFFFFF0200FEFF01000200FDFF0200FFFF0100000000000400FFFFFEFF01000000FDFF0000FCFFFDFF0000FEFF04000000FDFF0800FBFFFFFF0200000002000000FCFF01000200FDFFFDFFFEFF0000030000000100FCFF010005000000040001000000FFFF03000000FEFF000001000400FFFF0100FFFFFEFF0000FDFF040000000000FEFF0400FFFF050003000000F6FFFEFF01000000FFFFFDFFFEFF0000FFFFFFFF010000000100FFFF06000100FEFF0200FDFFFFFFFEFF00000000050002000000FFFFFEFFFDFF0300"> : tensor<3x5x40xi16>
    return %0 : tensor<3x5x40xi16>
  }
}

