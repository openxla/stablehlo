// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xi8>, tensor<3x5x2xi8>)
    %2 = call @expected() : () -> tensor<3x5x40xi8>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<i8>, %arg1: tensor<i8>):
      %5 = stablehlo.maximum %arg0, %arg1 : tensor<i8>
      stablehlo.return %5 : tensor<i8>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xi8>, tensor<2x1xi32>, tensor<3x5x2xi8>) -> tensor<3x5x40xi8>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xi8>, tensor<3x5x40xi8>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xi8>, tensor<3x5x2xi8>) {
    %0 = stablehlo.constant dense<"0xFBFE00000003010000FDFD070200FF0002010203FFFEFD0008FDFDFE0100010000FC0400FEFF00000201020200FB01FF020302FE00FBFFFF0004FF0103FB000003FDFE020000FE000200FE01FDFE04000300020000000201000500FBFF0202030202FEFDFC01FDFDFDFB0101FF0405000003FCFE03FF01FCFDFEFEFF0000FFFD00020301000300FD00FF000601000100000006000000FC000106FE0400FFFDFFFF010202FC0000FC00000104FF020200FE06000004FA00FF0308FFFE020000FB02FE0000FD01000205FDFE0103000301FEFEFF04FE0202FDFF00FE02FF02000000000002F9010000FF00FDFD000403FF0004FF00FEFC01000000030104F9FE0002000400FC030200010003010000FE0100FE000200FEFF0201FC00000703FEFD00FD01FF0205FDFF04FE02FC0001FA0500000000FB0002FBFBFF0002000000040100FF03FC01FFFF00FF0000FB00030400FE00F9F900000000040002020201FF01FF010302FFFF00FE04000407030000FF03FAFF0002FE01FE03000202FFFE02FE00000301FE01FFFE00FFFF01030000FBFA0003FE02FBFE0109FF00040300FF0604FC00FCFE0000050300000004FFFE0107FCFFFE040400FE03010202FD0000020000FF00FD05FF0003FF0304FFFB0201020101FD00070002FEFC00FE00FC020201FFFE02FEFF01020405040002FDFF0100FD0100030203000305FCFF00FE02030100000003FC040000FE00000200010000FF020002FFFF01FC00FF00020400000000FF05030002FC0000000003010002FD020102FF0103040500FAFEFF0000FDF907000003FE0001FD000200F90203FB0001FFFFFE0402"> : tensor<3x5x40xi8>
    %1 = stablehlo.constant dense<[[[1, 0], [-4, -4], [-3, 0], [2, 0], [3, -2]], [[1, 0], [-2, 1], [1, 1], [2, 4], [-3, 0]], [[3, 1], [0, -3], [1, 3], [1, 4], [1, 1]]]> : tensor<3x5x2xi8>
    return %0, %1 : tensor<3x5x40xi8>, tensor<3x5x2xi8>
  }
  func.func private @expected() -> tensor<3x5x40xi8> {
    %0 = stablehlo.constant dense<"0xFB0100000003010000FDFD070200FF0002010203FFFEFD0008FDFDFE0100010000FC0400FEFF00000201020200FB01FF020302FE00FBFFFF0004FF0103FB000003FDFE020000FE000200FE01FDFE04000300020000000201000500FBFF0202030202FEFDFC01FDFDFDFB0101FF0405000003FCFE03FF01FCFD02FEFF0000FFFD00020301000300FD00FF000601000100000006000000FC000106FE0400FFFDFFFF030202FC0000FC00000104FF020200FE06000004FA00FF0308FFFE020000FB02FE0000FD0100020501FE0103000301FEFEFF04FE0202FDFF00FE02FF02000000000002F9010000FF00FDFD000403FF0004FF00FEFC01000000030104F9FE0002000400FC030200010003010000FE0100FE000200FEFF02010100000703FEFD00FD01FF0205FDFF04FE02FC0001FA0500000000FB0002FBFBFF0002000000040104FF03FC01FFFF00FF0000FB00030400FE00F9F900000000040002020201FF01FF010302FFFF00FE04000407030000FF03FAFF0002FE01FE03000202FFFE02FE00000301FE01FFFE00FFFF01030000FB030003FE02FBFE0109FF00040300FF0604FC00FCFE0000050300000004FFFE0107FCFFFE040400FE03010202FD0000020000FF00FD05FF0003FF0304FFFB0201020101FD00070002FEFC00FE00FC020203FFFE02FEFF01020405040002FDFF0100FD0100030203000305FCFF00FE02030100000003FC040004FE00000200010000FF020002FFFF01FC00FF00020400000000FF05030002FC000000000301000201020102FF0103040500FAFEFF0000FDF907000003FE0001FD000200F90203FB0001FFFFFE0402"> : tensor<3x5x40xi8>
    return %0 : tensor<3x5x40xi8>
  }
}

