// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf16>, tensor<5x2x2x7xf16>)
    %2 = call @expected() : () -> tensor<5x6x7xf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %5 = stablehlo.maximum %arg0, %arg1 : tensor<f16>
      stablehlo.return %5 : tensor<f16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xf16>, tensor<2x2x1xi32>, tensor<5x2x2x7xf16>) -> tensor<5x6x7xf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf16>, tensor<5x6x7xf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf16>, tensor<5x2x2x7xf16>) {
    %0 = stablehlo.constant dense<"0xF4C434B874355C283EBF0AC29F454EBC5443DBC2F64704BB553C54386C391CBE30C569C2F53582375A3E79C0EBC3BC2F24C00EC3760CB9C3F7C3743DA9C16438233A5430093F6EB632BC053DE93513421542034337C489BB19B7A43758C41F2C6638BF3C44458E44AAC2AFC19BC31F4445C0163C5F452A41DAAD39421543D843B84049C73EB9CA39C742D4BAA23DC5BD36B1BF3B403FC0C03044E3C16F2F0C3A2142AC45529886C3DDC0374663BFF742B74013B9F0C249C136C2FABCCC39B1431EB7CB2A9AC2BABEC23C41C5243D74B5AD4247408BC42CB217BC3540EDBA0E37022CBE3CFAAB5030C13C1F3039B9493B7441363839B727C807C183356BC03CBA7841F533D9337BBBA3BB57B9593D2740E94474C0884213B56942E54385BEEF3DB9C396C093C080C097C2B346E1C16C4079384843CEB752C4D6BF88C028401D3BD63AC2BAA9BB44C6C63B16C367C07B42DDC1E64543BEF245163C854563C099B834BBCDBC473E2FB1F23EAD4494BFD2BF61BCD9AD353FA5BDA4415444053EFBC103BCCA3FC7442C3A2C36203D98BE1941434470342B421BBC9EAE60BD0EB2AB416843F2B7"> : tensor<5x6x7xf16>
    %1 = stablehlo.constant dense<"0x82BE78456FB115C598B07FBA184605C49CBC43C0E5BDC2431F3F473DA6413E45D63CE5426EBE1EC3B645D03C3CBB0C446DB835C5444462C4363DF5348E421F44C941E9363CC3DDC178BA26A83AB878C250BD6DC252C01B3FB043ADC387BFD4456B36B0AD85424BC16ABB4CC77A40A9BC574552BCA9C09E34474435460EC7E5C08439783F89BF11BE463FCC3EB63BF3BB3241CB3D6DBF3EC4D2B966413EB46E3989C4F8C0DD3E584302C07DB7064552C3A4C275BC303C483E4840DE3914C4A53C6244ADC4B2412DC06FBF463DF2B82D46BB300542C2BDC14037C248C567BDE7BD51AA33C489C3CAC01546DB3666C6233EDAC4C2B8A1C41B41A2BC1545CA413143A6C08742584495C4BDC4AC41B0360F3F1DBF93449BC4873F"> : tensor<5x2x2x7xf16>
    return %0, %1 : tensor<5x6x7xf16>, tensor<5x2x2x7xf16>
  }
  func.func private @expected() -> tensor<5x6x7xf16> {
    %0 = stablehlo.constant dense<"0x82BE784574355C2898B07FBA18464EBC544343C0F647C2431F3F473DA6413E45D63CE542F5358237B645D03C3CBB0C446DB80EC34444B9C3F7C3743DA9C16438233A5430093F6EB632BC053DE935134215420343363DF5348E421F44C941E9366638BF3C44458E443AB8AFC150BD1F4445C01B3F5F452A41DAADD4451543D84385424BC13EB9CA39C742D4BAA23DC5BD36B1BF3B403FC0C03044E3C16F2F0C3A2142AC45529886C35745374663BFF74247443546F0C2E5C08439783FCC39B143463FCC3EB63BF3BB3241CB3D243D74B5AD4266413EB46E3917BC3540DD3E5843022CBE3CFAAB5030C13C1F3039B9493B7441363839B727C807C1833502C07DB70645F533D9337BBB303C483E48402740E944A53C624413B56942E54385BEEF3DF2B82D46BB300542C2BDB346E1C16C4079384843CEB752C4D6BF88C028401D3BD63AC2BAA9BB44C6C63B16C367C07B4251AAE64543BEF2451546854563C0233E34BBC2B8473E1B41F23E1545CA41314361BC87425844A5BDA4415444053E0F3F03BC9344C744873F2C36203D98BE1941434470342B421BBC9EAE60BD0EB2AB416843F2B7"> : tensor<5x6x7xf16>
    return %0 : tensor<5x6x7xf16>
  }
}

