// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf16>, tensor<5x2x2x7xf16>)
    %2 = call @expected() : () -> tensor<5x6x7xf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %5 = stablehlo.maximum %arg0, %arg1 : tensor<f16>
      stablehlo.return %5 : tensor<f16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xf16>, tensor<2x2x1xi32>, tensor<5x2x2x7xf16>) -> tensor<5x6x7xf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf16>, tensor<5x6x7xf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf16>, tensor<5x2x2x7xf16>) {
    %0 = stablehlo.constant dense<"0x043D53B196C3F4C41942384492412B438CBF20473BBE18C63B399540413078426E434EC2FE419D45F944F43EFD420EC1353F86C21E273F42DDBEC3BA95C4FB42063F203B3EBD224851440FAC80411F3D6EC654B734322FB5D9BA50C4AF3CDBC45B3BB83EA24699C1D236A045C244C34126BDC7442B47CDBEA54666BB0CB135463B42E640E23DB0410941B5ADCD4684C122446BBB013E70339E388545AF42F1BEAA424442F835BCC0B141BF3A7F3F77C48FC0C140FF44E738A63F6BC4F2C36B3E553CC6BC34383F4205C2993FCE3BDE3CA242F9C1DB302144CEC182456FC186C0F2C46F479C41734079B8643D7DB8034115422AB67F40814084C2F8BCC7442FB8C33D78C09F3DEC409ABD4BC403BD51BFB8C16A32C7438342B8C0EFC186C495BD2AC3B24122BF9CAE03247D4108C2D2C2FABC493DCD323DC017BBC53D33B944434DBF8043B125354435C3A0C612BA3EB8F139D5BBACBD0FBABB42B7BC50C108C01F3BD73D4C387E3433407DC088C47B3F843540BCDE421BC1E7C3A0C01940E4421DC225407233ECB2F8BE3F4320385E3859390A45B935E641564305B61BBB6BC469301F44"> : tensor<5x6x7xf16>
    %1 = stablehlo.constant dense<"0x9C2923BC1134F640C739CD3C6F41E4C6DDC030BCF73C3DC032BE6944E4412743C83EDDBE7FC1E4BB21C267C16246123078BD3BBE2A3E6D3DC7C199C1DB3B92C05246B8C18EC1654115C2B1C4DB44E8C3203DAF3D02C15C444BB173354C42FDBFE7C0EC3C7FBCE237E5303039383945BBD147073A4C356346833823C18CC27247EABCC8310840993AB1358141F9BE01BE1941193B0DB0A2BA2E4250C1273D5631FBC33BC138C35CC6DD44D8BE0FC45DC349B9444170C76EC1F1BD26BDF9BAE8C33FB811C8743F4636CE41CB41ED3C0A4479BD30C4243C7C4060467D39B3C8943D74431344713D5A40FAC36AC2FD3A44C4EA3DD240B8419B3C0BB92DC24FC2523EECC543417BB211BC4435C9C4A5B7DB43743FB83920398C3B"> : tensor<5x2x2x7xf16>
    return %0, %1 : tensor<5x6x7xf16>, tensor<5x2x2x7xf16>
  }
  func.func private @expected() -> tensor<5x6x7xf16> {
    %0 = stablehlo.constant dense<"0x043D53B11134F6401942384492412B438CBF2047F73C3DC03B396944E44127436E43DDBEFE419D45F944F43E62461230353F3BBE2A3E3F42DDBEC3BA95C4FB42063F203B3EBD224851440FAC80411F3D6EC654B734322FB5DB3B92C05246B8C15B3B6541A24699C1DB44A045C244C34126BDC7442B477335A54666BB0CB135463B42E640E23DB0410941B5ADCD4684C122446BBB013E70339E388545AF42F1BEAA424442F835BCC0D147BF3A7F3F63468338C140FF447247A63FC83108406B3E553C814134383F421941993FCE3BDE3CA24250C1273D2144CEC182456FC186C0F2C46F479C41734079B8643D7DB8034115422AB67F40814084C2F8BCDD442FB8C33D78C09F3D44419ABD6EC103BD26BDF9BA6A32C7438342743F4636CE41CB41ED3C0A4479BD9CAE243C7D4160467D39FABC943DCD323DC017BBC53D33B944434DBF8043B125354435C3A0C612BA3EB874431344713D5A40BB42B7BCFD3A08C0EA3DD240B8419B3C33407DC04FC27B3F84354341DE4211BC4435A0C01940DB43743F254020398C3BF8BE3F4320385E3859390A45B935E641564305B61BBB6BC469301F44"> : tensor<5x6x7xf16>
    return %0 : tensor<5x6x7xf16>
  }
}

