// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[0, 1], [2, 3]]> : tensor<2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<2x7xf32>)
    %2 = call @expected() : () -> tensor<5x6x7xf32>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %5 = stablehlo.maximum %arg0, %arg1 : tensor<f32>
      stablehlo.return %5 : tensor<f32>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1], inserted_window_dims = [0, 1], scatter_dims_to_operand_dims = [0, 1], index_vector_dim = 1>, unique_indices = true} : (tensor<5x6x7xf32>, tensor<2x2xi32>, tensor<2x7xf32>) -> tensor<5x6x7xf32>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32>, tensor<2x7xf32>) {
    %0 = stablehlo.constant dense<"0x1F4193BEDF7A3540A68F17C0B054853F70EB3E406E7908408953E13F8340B640B6FD3EC0633BC4C08285F43DF9F6A040819A77C02BED0D40426BDDBE4FED903FF92906C0D32CDB3E14BF99BFD96CBCBFB1882240956C4EC0D34FA8C0C455FFBB8447A040CD5940BFD758194003C8B7BE08A88C403A9EE3BF57F439BE263421BE8A4443C0627184404F54A9BF4504573F016D4A4025591BC08362ECBF003B723E50F841C077FE99C00C10A13F036297402FC993407783B6BF9A46A03F44A22CC01ABCF63FF8B9BA3F932C853E9F65C73DEB94E03E76F2F43F3B93F7BF38A0FFBF1D3D45C0BC8108408A233B401FEB17C07A0A7240FE958EC0B04B08C09A579F40F33F884018D7E5BEAFE67A3E71A1983EE0C580C01DD6D73E663A4FBE0D767C40D6043CC000DFBE3FFE44663FE0F574C02AD629BE8800483FF0BD09C063F1FEBF424434BF846F04C0B7900BC07528394020776240278DB3C081A9AB40BA51E43FB89F3A3D24BDC8BFD8631E40E778C040423ABB3F4ADB383F09638E3F2993674008E7334019C227407DAB3DBF66BB4FC016ABFDC02A10A4C08F48323FBF8C99C0211C9540B9FDE8BF2E5A59402FBA20C067E2B6BFEF3E2540010DE33F2C1E3340614BAA3F200E07C040B767C0D5B702C074D72840EC3E963F52B46DC0F4067F40D7DFE2BEA2FFB63E1E7F86402D149140CC324DC054B9B63FE687DBBFBF30BF3F598E07C012252CC0857578BF9CB6064005ECB6BFA9DBC5C03F33B340737ADFC088548AC02763D6407EC8FC3F5B0697BE0698BB40EC0DB13FA2AF4840E25B793F100BEDBE76702540EF7F2CC07EB57640759E4E3F1EA9973F2D551BBE246CA3BD4E0ADABFADFEC33FEEC70F3F7D06C54086D800C02BEAAD3FCFD15CBE5331BB3FE69D97C0D38525BFE1405C408B989F3F29DB49C06AF097BFD1CA303F2258974068A728C08F9FABBD38CB8FBE15395540CADE1E4009F66040A60CAF3FCF9A4BC076E2653F7FCC0EC095FE9CC0F4B6BCC0DE1B11C0B4EA3940E0A00AC03F0EF53FABFF7BC065AF54C047B39C3FD9A75EC0E94F463F0B320CC0D0B252C00B9A28BF6255A8C0FD3045C0078C4D40834D81BF12090CBEC9A406BBB459EF4074879D409405CDBF1F307DBF74B547BF9CD7FD3FFCE91240660E9F40547F80C06F9FF8BF4FD89540E2E5563F"> : tensor<5x6x7xf32>
    %1 = stablehlo.constant dense<[[2.00697422, 3.69431901, 3.482095, 2.65966558, -3.7980237, -1.38288474, 1.61778688], [-0.574834883, -2.26537085, 2.62109542, -0.506625772, 0.772261738, -3.850734, 0.683779955]]> : tensor<2x7xf32>
    return %0, %1 : tensor<5x6x7xf32>, tensor<2x7xf32>
  }
  func.func private @expected() -> tensor<5x6x7xf32> {
    %0 = stablehlo.constant dense<"0x1F4193BEDF7A3540A68F17C0B054853F70EB3E406E7908408953E13F8340B640B96F6C40A5DA5E40F6372A40F9F6A0405E02B1BF2BED0D40426BDDBE4FED903FF92906C0D32CDB3E14BF99BFD96CBCBFB1882240956C4EC0D34FA8C0C455FFBB8447A040CD5940BFD758194003C8B7BE08A88C403A9EE3BF57F439BE263421BE8A4443C0627184404F54A9BF4504573F016D4A4025591BC08362ECBF003B723E50F841C077FE99C00C10A13F036297402FC993407783B6BF9A46A03F44A22CC01ABCF63FF8B9BA3F932C853E9F65C73DEB94E03E76F2F43F3B93F7BF38A0FFBF1D3D45C0BC8108408A233B401FEB17C07A0A7240FE958EC0B04B08C09A579F40F33F884018D7E5BEAFE67A3E71A1983EE0C580C01DD6D73E663A4FBE0D767C40D6043CC000DFBE3FFE44663FE0F574C02AD629BE8800483FF0BD09C063F1FEBF424434BF846F04C0B7900BC07528394020776240278DB3C081A9AB40BA51E43FB89F3A3D24BDC8BFD8631E40E778C040423ABB3F4ADB383F09638E3F2993674008E7334019C227407DAB3DBF66BB4FC016ABFDC02A10A4C08F48323FBF8C99C0211C9540612813BF2E5A594007C027403AB201BFEF3E2540010DE33F2C1E3340614BAA3F200E07C040B767C0D5B702C074D72840EC3E963F52B46DC0F4067F40D7DFE2BEA2FFB63E1E7F86402D149140CC324DC054B9B63FE687DBBFBF30BF3F598E07C012252CC0857578BF9CB6064005ECB6BFA9DBC5C03F33B340737ADFC088548AC02763D6407EC8FC3F5B0697BE0698BB40EC0DB13FA2AF4840E25B793F100BEDBE76702540EF7F2CC07EB57640759E4E3F1EA9973F2D551BBE246CA3BD4E0ADABFADFEC33FEEC70F3F7D06C54086D800C02BEAAD3FCFD15CBE5331BB3FE69D97C0D38525BFE1405C408B989F3F29DB49C06AF097BFD1CA303F2258974068A728C08F9FABBD38CB8FBE15395540CADE1E4009F66040A60CAF3FCF9A4BC076E2653F7FCC0EC095FE9CC0F4B6BCC0DE1B11C0B4EA3940E0A00AC03F0EF53FABFF7BC065AF54C047B39C3FD9A75EC0E94F463F0B320CC0D0B252C00B9A28BF6255A8C0FD3045C0078C4D40834D81BF12090CBEC9A406BBB459EF4074879D409405CDBF1F307DBF74B547BF9CD7FD3FFCE91240660E9F40547F80C06F9FF8BF4FD89540E2E5563F"> : tensor<5x6x7xf32>
    return %0 : tensor<5x6x7xf32>
  }
}

