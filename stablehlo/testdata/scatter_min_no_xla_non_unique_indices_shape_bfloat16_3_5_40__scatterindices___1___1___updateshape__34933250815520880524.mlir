// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>)
    %2 = call @expected() : () -> tensor<3x5x40xbf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %5 = stablehlo.minimum %arg0, %arg1 : tensor<bf16>
      stablehlo.return %5 : tensor<bf16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xbf16>, tensor<2x1xi32>, tensor<3x5x2xbf16>) -> tensor<3x5x40xbf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xbf16>, tensor<3x5x40xbf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>) {
    %0 = stablehlo.constant dense<"0x1AC0D540233E67C088408BC04AC021C061BFDE3F63402DBF93BFCBBF1E3FE9BF17401B3FF1C0B6BFC7BEC43F813EEBBDF6BF24C0AD3F1240C5BF16BF7E3E6B40963EDCBFC8BF6140D7C084C01EC0603FD73F3840D13F1B40F03FA8C062C051BE643FEFC0C9BF6CBF69C08EC030C048BF6B3F5CC0363EF34089406D4081BEC0C002BFD44039403A40903F0FC0FDC070C035BF5740513D724069BF9240083FE0BFA4C0843FB3C079C02CBF423F263E0FC03FC060408B40754011C0EF40E4BF263F59401C400B3F0DC163406540C73F763F334088400AC019C0834084408D3EB340F83E2F3FAABF2A400ABF2BC07BC0D6BFAC403CC0823F353FBE4026C09C3F19C0F53FB73DA5BF1940924037BF7ABFADBF9440ABBF9FC0D9BF773FC03E8EBD204092C031C0BD3F94403F40B8BFABC0A33D28C082C032BD1F400C4086405E400D40EFBF02C034C09FBF4DC0DDC086C03F3F614051408BBF81C04BC04EBF2640623FA8BF40403EC07340973E9D40FBBFE3BFDABF463B86C0FB3F503FE23FFA3FFFBE3740B540D63F073EB9BD4C3F9F3F094017402BC0ACBF53404D40B1BE80BF71402040E43EB0C0284005400C401CC05ABF8140364094BF02C0AEBF37BF22409040914023C03FBF854010C097C097BF63C0D8BE1040C8401DC03F3FB83C563EB93E93BF4BC0274075C0E5C019C1EABF82402FC0FEBF1140C5BFD83FFCBFB8BE6440A9BFF0BF8B3FA5BFA6BEFF3F13C0A5C03C408440A44003C18CC0DCBD9B3EC33BA03F2CC040BFC4BF0DBF124082C0D0BF72BD89BFE7C09F3FD23E6AC09740D13EA9C010BED73E52BFA03F33BFDB3F8A40F03FD23F7AC07940BDC0A9BE93C056C07ABF2B40B8C023C0433F60C09D403F40B43FD740174058BF9840FEBF533F39C0663FF7BF18C19E409E4004BCCFBF133E0EC057BEA53E8DBF153FB73F98400DC0A5406BBFAEC03840234023C0594013C05940EF408140DC3F8BBF5240213E8BC0A23FD2BFD53F4DC06DC09DC0A9C006BF903E9DC035C029C044C0A7BFE63F4AC025C03EC08AC04FBD0040BFBE95BE6F407FC0D23EF4C00A3FBDBF133E5FC0393F8840254011C098C005BFE73F2D3F823E44C042C0CE3F243FB8C042C01E3F74405BC0B1409FC05F402BBC99C0273FC13EF73F14C0B43E0ABF18C18EBF19C0B7BF0CBF0E40AD40D23F51406DBF5F40DBC0B83FB8408ABE8340EE40EC4075BE8B3FE63F26C0AD404EC0C0BF20C0AF4012BF49BF8340DCBFBC3EA8BFAF408F40044032BFD3406ABFE4C01F40223F303F01BF86BFDCBE4EC057C0173F38C015C0ACC0A2C0633E8AC0AF3E3A40863FC13FD1BFA5BF47C0A34082BE84C072BF68404A40C640C44009C0BCBF43BF71406CC08D3F4D408640A540434009BF8DC01840A7C03E3F8140CBBF894070C0FDBF6A40B8BF3BC037C0EA3F19C06140AF3F9AC04640D3BFE93F004093C08D3F40BFE63E48BF1FBFB4C03CBF16408AC091C039C06A403C3E4BBF56C069C08CC0583F12C03040E93F5AC06DBF0D401B40863FFC402FBDDBC0ABBF10BF58BE66BE8DC0FCC0A63FCCBC1C3E89C093405740DEBF9D3FABBF8A404EC0B5C065C029C02C40A4C0A53F04C0AFBF7640E9BF753F9A3FD83C15C0D93FD5BF4AC0943D993F6EBF2D3E4D3F72BF3140283FD33FAF3FC5BFE4BEE4BD5AC008BFE03F7EC01FC0E740EBBE6D40"> : tensor<3x5x40xbf16>
    %1 = stablehlo.constant dense<[[[2.343750e-01, -6.367190e-01], [-8.007810e-01, -1.015630e+00], [-7.718750e+00, -3.828130e+00], [-4.843750e+00, 1.195310e+00], [1.171880e+00, 3.328130e+00]], [[-1.232910e-02, 1.945310e+00], [-2.203130e+00, -1.492190e+00], [-5.195310e-01, -6.468750e+00], [-9.101560e-01, 1.890630e+00], [-1.437500e+00, -7.929680e-01]], [[1.765630e+00, 1.445310e+00], [4.406250e+00, -1.218750e+00], [1.984380e+00, -1.085940e+00], [2.578130e-01, -1.664060e+00], [-2.796880e+00, 9.101560e-01]]]> : tensor<3x5x2xbf16>
    return %0, %1 : tensor<3x5x40xbf16>, tensor<3x5x2xbf16>
  }
  func.func private @expected() -> tensor<3x5x40xbf16> {
    %0 = stablehlo.constant dense<"0x1AC023BF233E67C088408BC04AC021C061BFDE3F63402DBF93BFCBBF1E3FE9BF17401B3FF1C0B6BFC7BEC43F813EEBBDF6BF24C0AD3F1240C5BF16BF7E3E6B40963EDCBFC8BF6140D7C084C01EC0603FD73F82BFD13F1B40F03FA8C062C051BE643FEFC0C9BF6CBF69C08EC030C048BF6B3F5CC0363EF34089406D4081BEC0C002BFD44039403A40903F0FC0FDC070C035BF5740513D724069BF9240083FE0BFA4C0F7C0B3C079C02CBF423F263E0FC03FC060408B40754011C0EF40E4BF263F59401C400B3F0DC163406540C73F763F334088400AC019C0834084408D3EB340F83E2F3FAABF2A400ABF2BC07BC0D6BFAC409BC0823F353FBE4026C09C3F19C0F53FB73DA5BF1940924037BF7ABFADBF9440ABBF9FC0D9BF773FC03E8EBD204092C031C0BD3F94403F40B8BFABC0A33D28C082C032BD1F400C4086405E400D40EFBF02C034C09FBF4DC0DDC086C03F3F614051408BBF81C04BC04EBF2640623FA8BF40403EC07340973E9D40FBBFE3BFDABF463B86C0FB3F503FE23FFA3FFFBE3740B540D63F073EB9BD4C3F9F3F094017402BC0ACBF53404D40B1BE80BF71402040E43EB0C0284005400C401CC05ABF8140364094BF02C0AEBF37BF22409040914023C03FBF854010C097C097BF63C0D8BE1040C8401DC03F3FB83C563EB93E93BF4BC0274075C0E5C019C1EABF82402FC0FEBF1140C5BFD83FFCBFB8BE6440A9BFF0BF8B3FA5BFA6BEFF3F13C0A5C03C408440A44003C18CC0DCBD9B3EC33BA03F2CC040BFC4BF0DBF124082C0D0BF72BDCFC0E7C09F3FD23E6AC09740D13EA9C010BED73E52BFA03F33BFDB3F8A40F03FD23F7AC07940BDC0A9BE93C056C07ABF2B40B8C023C0433F60C09D403F40B43FD740174058BF9840FEBF533F39C0663FF7BF18C19E409E4004BCCFBF133E0EC057BEA53E8DBF153FB73F98400DC0A5406BBFAEC03840234023C0594013C05940EF408140DC3F8BBF5240213E8BC0A23FD2BFD53F4DC06DC09DC0A9C006BF903E9DC035C029C044C0A7BFE63F4AC025C03EC08AC04FBD0040BFBE95BE6F407FC0D23EF4C00A3FBDBF133E5FC0393F8840254011C098C005BFE73F2D3F823E44C042C0CE3F243FB8C042C01E3F74405BC0B93F9FC05F402BBC99C0273FC13EF73F14C0B43E0ABF18C18EBF19C0B7BF0CBF0E40AD40D23F51406DBF5F40DBC0B83FB8408ABE8340EE40EC4075BE8B3FE63F26C0AD404EC0C0BF20C0AF4012BF49BF9CBFDCBFBC3EA8BFAF408F40044032BFD3406ABFE4C01F40223F303F01BF86BFDCBE4EC057C0173F38C015C0ACC0A2C0633E8AC0AF3E3A40863FC13FD1BFA5BF47C0A34082BE84C072BF68404A40C6408BBF09C0BCBF43BF71406CC08D3F4D408640A540434009BF8DC01840A7C03E3F8140CBBF894070C0FDBF6A40B8BF3BC037C0EA3F19C06140AF3F9AC04640D3BFE93F004093C08D3F40BFE63E48BF1FBFB4C03CBF16408AC091C039C06A403C3E4BBF56C069C08CC0583F12C03040E93F5AC06DBF0D401B40863FFC402FBDDBC0ABBF10BF58BE66BE8DC0FCC0A63FCCBC1C3E89C093405740DEBF9D3FABBF8A404EC0B5C065C029C02C40A4C0A53F04C0AFBF7640E9BF753F9A3FD83C15C0D93FD5BF4AC0943D993F6EBF2D3E4D3F72BF3140283FD33FAF3FC5BFE4BEE4BD5AC008BFE03F7EC01FC0E740EBBE6D40"> : tensor<3x5x40xbf16>
    return %0 : tensor<3x5x40xbf16>
  }
}

