// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>)
    %2 = call @expected() : () -> tensor<3x5x40xf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %5 = stablehlo.minimum %arg0, %arg1 : tensor<f16>
      stablehlo.return %5 : tensor<f16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xf16>, tensor<2x1xi32>, tensor<3x5x2xf16>) -> tensor<3x5x40xf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xf16>, tensor<3x5x40xf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>) {
    %0 = stablehlo.constant dense<"0x09C3B9424E3B294604C302B9C524D53A9B431D48FFB4CB440639B83E2A4343405841854515C4C5BC24B9E1C6E9B69F41B547534404C2EE2EC54355BECDB841BCED3AB6C292C4C14281B62941A83EB3BFC8C1353E0CC2AB40D1BFD2412FBF11BF5AC2B644C24398C1EE44813C62C1B54080C13B3E943AA2B3F54039C342BC233E2B44E1400544A9C6F74550C4E6449CC5C0B4EABDD9B65E3489BE1444D9B6A23D25443D30ADC57BC30640F042F6C376BEC0BEDFC0E34359BDA82F3D41703E2436BAC05EC365C7243E1CC126422D3AAFC1DE38F53DD2C39BC3EA3B59BEDE42E3C210C219BC8B46503EF3BF47C671C01AC5E2B68439BAC0984045C38C3EFD3C58C475C0AF3165C079C1B73C9CB9053F503807C62E433D3B704292C3C4BFE3C29EBF993C16297CB6692C9E4277BBF5C3E3C2D0397C422C4334C41FBFE9B81743D8BE8441D53D7C47C140E8B012A548BD6FBD9CB87DB7D83E3EB5F3BDE4BCE73D26C8473E223AC1C3A8BEEB4181C6C04029C2E5B8DD3291457245773B4C413FB950C48048A143AB440243623D49C04B44262EC0B9A8C07DBF0440D53DECBE0B377B3634C590B9013704BE054561BE6C419D442A3F7D411340B8C0B6C45FB9E4C10DBF1442BCC0673EC8BAA8B47727A3400C3B883EA241E6421FA8A7C51AC085BCCDB6BCC6CC405E40CCC07DBC1DC177C1B83CA444763C3B462AC37C3DBC408F4413C345B925412BC281A5EC44B9387BC2863D2B401139B93A40485AC2C73A8DC498AEAE411F44683C45C07742743C7ABEA0C154426FC2863C07BB37421C33003CBB2A33C3D8C45D3F9F40FFBC2AC57BC2A4C78CB67DC435447844F0C544BE8F35DC42E43DAEC3F93DEFC289C0F1C27F4081C0ECC074BD8F40DFBCB03C563CD628063E2B4158C46642B24324C09036AA4159C14EBC1BC00A40C4C43AC3C4C253C17EBC53B5D23E82BC65B474384C4533439EC21A33AABFE0406A3D48C5FABC983F95C3ABAB08C5EC40A9B4734629444C36EBBE7AB6C14436BCE3C089342244A0405038F1C2ADC028BEE44000BE0AB808BC2042993476C2DA428A3D33C48535BB3F45BEE6C317B1C4BDDFBCD331044194BD29C54C461A411A3951BED7B92D43E6BA15442D44C1C52F422C3FA13810BBCDC1F5B351C2E9C22DC525405B3568B49C42694029B976C487C0874694BE95ACABC56D49CEB87BB97DC032378F42F333A0BF33425A44F2C049BBCD4415380631CDBCC42D81BDE3A909A93744E1BE28C1DD429C4240B7B243BEC41B41F14264C4B8C23BBFC2C4963B5D3C4C3F01419EBD7BC0313D9D45A8441DC097C88D4327C25C3A8B3C4C44393DEBBA91B85D3C96C0463C08402F33F942F9C0283E0A45E23BC8BEC541DE427A3CF2B573434C4116C0EB42C331B2402B3E82450F36753986C140C6A0C356427A3E87C258BA4948EAC2E840473C73BA022A6E462A3710BF602935C434415BBDB3474E47FFB0CB4743BF1FB935444436DC3CF13CD2439F3E76BE5C4029C0EB4019BDFBC17E40E33EAD3C3BC44A2E78B2133FCE3EC7C5A6B8F93E24BADC43A5C3563DEEB913BFABC185C0C642D030823D45458442D7BF6CBF9C3F8B3D41B0A3BE0F4075BAD2C040B1223C0641C2378F3E6C4705464535034335403AB51FC57243AF41B2C2D8BC324555BB4FC073BCDBBA073A24364A40D5C661C03AB26F3D"> : tensor<3x5x40xf16>
    %1 = stablehlo.constant dense<[[[1.551760e+00, -6.074210e-01], [-3.072270e+00, 3.630860e+00], [4.553220e-01, -1.410160e+00], [8.349610e-01, 4.054690e+00], [-6.011710e+00, 5.316410e+00]], [[-1.083010e+00, -9.746090e-01], [-4.542970e+00, 5.522460e-01], [4.894530e+00, -1.100590e+00], [-4.105470e+00, 3.832030e+00], [-3.437500e+00, 1.708010e+00]], [[7.238280e+00, 3.185550e+00], [3.149410e-01, -3.220210e-01], [1.016600e+00, 2.568360e+00], [4.375000e+00, 1.100590e+00], [3.714840e+00, -1.825200e+00]]]> : tensor<3x5x2xf16>
    return %0, %1 : tensor<3x5x40xf16>, tensor<3x5x2xf16>
  }
  func.func private @expected() -> tensor<3x5x40xf16> {
    %0 = stablehlo.constant dense<"0x09C3DCB84E3B294604C302B9C524D53A9B431D48FFB4CB440639B83E2A4343405841854515C4C5BC24B9E1C6E9B69F41B547534404C2EE2EC54355BECDB841BCED3AB6C292C4C14281B62941A83EB3BFC8C125C20CC2AB40D1BFD2412FBF11BF5AC2B644C24398C1EE44813C62C1B54080C13B3E943AA2B3F54039C342BC233E2B44E1400544A9C6F74550C4E6449CC5C0B4EABDD9B65E3489BE1444D9B6A23D2544A4BDADC57BC30640F042F6C376BEC0BEDFC0E34359BDA82F3D41703E2436BAC05EC365C7243E1CC126422D3AAFC1DE38F53DD2C39BC3EA3B59BEDE42E3C210C219BC8B46503EF3BF47C671C01AC5E2B68439BAC0984045C38C3EFD3C58C475C0AF3165C079C1B73C9CB9053F503807C62E433D3B704292C3C4BFE3C29EBF993C16297CB6692C9E4277BBF5C3E3C2D0397C422C4334C41FBFE9B81743D8BE844103C67C47C140E8B012A548BD6FBD9CB87DB7D83E3EB5F3BDE4BCE73D26C8473E223AC1C3A8BEEB4181C6C04029C2E5B8DD3291457245773B4C413FB950C48048A143AB440243623D49C04B44262EC0B9A8C07DBF0440D53DECBE0B377B3634C590B9013704BE054561BE6C419D442A3F7D411340B8C0B6C45FB9E4C10DBF1442BCC0673EC8BAA8B47727A3400C3B883EA241E6421FA8A7C51AC085BCCDB6BCC68BC45E40CCC07DBC1DC177C1B83CA444763C3B462AC37C3DBC408F4413C345B925412BC281A5EC44B9387BC2863D2B401139B93A40485AC2C73A8DC498AEAE411F44683C45C07742743C7ABEA0C154426FC2863C07BB37421C33003CBB2A33C3D8C45D3F9F40FFBC2AC57BC2A4C78CB67DC435447844F0C544BE8F35DC42E43DAEC3F93DEFC289C0F1C27F4081C0ECC074BD8F40DFBCB03C563CD628063E2B4158C46642B24324C09036AA4159C14EBC1BC00A40C4C43AC3C4C253C17EBC53B5D23E82BC65B474384C4533439EC21A33AABFE0406A3D48C5FABC983F95C3ABAB08C5EC40A9B4734629444C36EBBE7AB6E0C236BCE3C089342244A0405038F1C2ADC028BEE44000BE0AB808BC2042993476C2DA428A3D33C48535BB3F45BEE6C317B1C4BDDFBCD331044194BD29C54C461A411A3951BED7B92D43E6BA15442D44C1C52F422C3FA13810BBCDC1F5B351C2E9C22DC525405B3568B49C42694029B976C487C0874694BE95ACABC56D49CEB87BB97DC032378F42F333A0BF33425A44F2C049BBCD4415380631CDBCC42D81BD27B509A93744E1BE28C1DD429C4240B7B243BEC41B41F14264C4B8C23BBFC2C4963B5D3C4C3F01419EBD7BC0313D9D45A8441DC097C88D4327C25C3A8B3C4C44393DEBBA91B85D3C96C0463C08402F33113CF9C0283E0A45E23BC8BEC541DE427A3CF2B573434C4116C0EB42C331B2402B3E82450F36753986C140C6A0C356427A3E87C258BA4948EAC2E840473C73BA022A6E462A3710BF602935C434415BBD673C4E47FFB0CB4743BF1FB935444436DC3CF13CD2439F3E76BE5C4029C0EB4019BDFBC17E40E33EAD3C3BC44A2E78B2133FCE3EC7C5A6B8F93E24BADC43A5C3563DEEB913BFABC185C0C642D030823D4DBF8442D7BF6CBF9C3F8B3D41B0A3BE0F4075BAD2C040B1223C0641C2378F3E6C4705464535034335403AB51FC57243AF41B2C2D8BC324555BB4FC073BCDBBA073A24364A40D5C661C03AB26F3D"> : tensor<3x5x40xf16>
    return %0 : tensor<3x5x40xf16>
  }
}

