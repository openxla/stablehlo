// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>)
    %2 = call @expected() : () -> tensor<3x5x40xf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %5 = stablehlo.minimum %arg0, %arg1 : tensor<f16>
      stablehlo.return %5 : tensor<f16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xf16>, tensor<2x1xi32>, tensor<3x5x2xf16>) -> tensor<3x5x40xf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xf16>, tensor<3x5x40xf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>) {
    %0 = stablehlo.constant dense<"0x7DBCA1C7CFC0D640C6C082A2ED44F7B902C271C15239003DD944B2BE1CC212BDC2B9904329307DC15A420F4109C2AE3EE2C38BC133B63C3DACB3D74459C350C276405BC41DC08E43A2C36BC5B0BAB6BEF8384A42DEC20AB8A2353BC6C244F4B6AD3D4E44E3B9D6B9F142923E3DBA54C3CE3FE931C83DE2BCE9C141B7C6C1152C4A2E5040F03F1738A83D7AB995B9593FBFC2FFC0D84416B46A48E63B5632EF41ADC612C665BE8B3DB2B24C4000C08E393E38FE3E6BB210BF4DB1B03052C4A4B87F43DEB897BA6C4096B8D246C5C5ED392740C1B8BA4316B9C235DC3B57417BC1C43357C224BC20B2D5C4463F783CF33E24C20240DDC00C4569C0E02A7041CBC1FAC1D9BC54C5E5AB0E4668446F402CC107AD2BBE799FF53C3BC59A431FC1293984448F3C81ADCA45B03828C6ED4420467ABFF3BC273EE4C4A03CF2BF15C05FC4B6BB4FC13344523B2730AB3C43C31F431A3C9EBD3AB44E378EC5EBBEFE3BCFBA70BB62438631B53D8EBC87BD84C2FBBA42B89BC0E542F2BC86BDA8B159C1DC400EBDBD4635BB46BA89C4FABF8C405244BEC5A2BD1C45614352C3C140344491BF68BF9436733EFE39A4435FC44D409945A23F883AB4C1E439ABC43843193A0E40FCBD8ABF89C089BD4441E4B06C3D6839EAC3BA42A4C08BC00EB8ED3456BA7D4050417CBBE8BC5140FE44134568C6C8C506410CBA64C0EEB7F44793C436457440C0C229BA8141534033456BC53940F846EA3CEE3E1AC013C01EBECC3E6141374228C5D642D737E9C4B7B8F3C02536903FA3BDA7C3443FC5451344E93AFBAF02C2AFBC86BBEA3D39304FB1C2B61E44193D87BF1542FEC1AB441CBD7046C0BC6C43534043C2783EA1404AC1F4C413C1D7C111397A3F973E8A4400C3374580B0BD41C5C3DC3C114200C4453A72C13E3D03C160C3E944044120C5FFBB8640FABF7B40F3B89D3DF2413EB663469D3CB53A48B125C30E3D78405BB5933A4F3DCA4117BC96C1F0395645B339803F0940E23EBE426BC09347983BFBBD72B048C00AB868BF3EBEA145EE44E74023C3A1B6A43B31B825BD56C3B9B41E40423FDCBD52463F3EDB421DC2B743A0387CC5D8C788C4D0393744AAC452438B41F4414CC05AADDBC3C337B64286423BC0363F7FB530432139AAB997C2A4BF50B505409EB877C380B5ABC2623BCC3B1438BD31BB44C0298B39DF3C2142E6C073B4EEC3B340A9C15EC009C0D0C184C176C3C83F5EBE7544BD3F004401C0E8C1C9C0FE3422C1CB405ABEDCB9C241F34329C349446AB86E433294323C463E4CAD10BC5EC38D40CAB6CB4256C5F9C254436B37D7C082B880BD3344D3C2A5B8F7AFBC3E72424CC4D0BE9842A6BCFD44B6A9D5C40EB7DEC1A0C01FAF53C3983D14C410BE743DFE42A2358C410D419BC17E35F3C45743BEBD31429E3909C0FD3292BECBB17FC59A3C09448E3DAA45BC2C80C23633393A40C131B81F385CC4103C3BC30644D1B6383E313CAE3BD4C1C53EBD3B063E5B33FB3B064586B7A93E803DF74059448DB87B41604182BA57AE74BD0141B6C00E3C5BC4C5C4613C58C0CD3F3338C4C0613B32C4924145C024C142B613C208BE4F325748AB41244573C243C44DC2DCBEE940FCBDA3C069462F39282D9744C0C14EC18340574520C4AB3AE4BE8FA2EF3E44C57A3EDD4573390A4231407AC7E442A53C0B3DC3B840B3"> : tensor<3x5x40xf16>
    %1 = stablehlo.constant dense<[[[-2.410160e+00, -4.398440e+00], [6.746090e+00, 5.073240e-01], [-1.170900e+00, -2.308590e+00], [-2.076170e+00, 5.214840e+00], [-4.066410e+00, -6.040040e-01]], [[7.138670e-01, -4.152340e+00], [1.538090e+00, 2.085940e+00], [-4.392090e-01, -1.861330e+00], [-8.461910e-01, -2.265630e+00], [1.329100e+00, -1.914060e+00]], [[-2.820310e+00, -1.572270e+00], [-6.123050e-01, 2.597660e-01], [-1.259770e+00, -1.971680e+00], [-4.500000e+00, -5.269530e+00], [-1.827150e+00, 3.498050e+00]]]> : tensor<3x5x2xf16>
    return %0, %1 : tensor<3x5x40xf16>, tensor<3x5x2xf16>
  }
  func.func private @expected() -> tensor<3x5x40xf16> {
    %0 = stablehlo.constant dense<"0x7DBCA1C7CFC0D640C6C082A2ED44F7B902C271C15239003DD944B2BE1CC212BDC2B9904329307DC15A420F4109C2AE3EE2C38BC133B63C3DACB3D74459C350C276405BC41DC08E43A2C36BC5B0BAB6BEF8380F38DEC20AB8A2353BC6C244F4B6AD3D4E44E3B9D6B9F142923E3DBA54C3CE3FE931C83DE2BCE9C141B7C6C1152C4A2E5040F03F1738A83D7AB995B9593FBFC2FFC0D84416B46A48E63B5632EF41ADC612C665BE8B3DB2B24C4000C08E393E38FE3E6BB210BF4DB1B03052C4A4B87F43DEB897BA6C4096B8D246C5C5ED392740C1B8BA4316B9C235DC3B57417BC1C43357C224BC20B2D5C4463F783CF33E24C227C0DDC00C4569C0E02A7041CBC1FAC1D9BC54C5E5AB0E4668446F402CC107AD2BBE799FF53C3BC59A431FC1293984448F3C81ADCA45B03828C6ED4420467ABFF3BC273EE4C4A03CF2BF15C05FC4B6BB11C43344523B2730AB3C43C31F431A3C9EBD3AB44E378EC5EBBEFE3BCFBA70BB62438631B53D8EBC87BD84C2FBBA42B89BC0E542F2BC86BDA8B159C1DC400EBDBD4635BB46BA89C4FABF8C405244BEC527C41C45614352C3C140344491BF68BF9436733EFE39A4435FC44D409945A23F883AB4C1E439ABC43843193A0E40FCBD8ABF89C089BD4441E4B06C3D6839EAC3BA42A4C08BC00EB8ED3456BA7D4050417CBBE8BC5140FE44134568C6C8C506410CBA64C0EEB7F44793C436457440C0C229BA8141534033456BC53940F846EA3CEE3E1AC013C01EBECC3E6141374228C5D642D737E9C4B7B8F3C02536903FA3BDA7C3443FC5451344E93AFBAF02C2AFBC86BBEA3D39304FB1C2B61E44193D87BF1542FEC1AB441CBD7046C0BC6C43534043C2783EA1404AC1F4C413C1D7C111397A3F973E8A4400C3374580B0BD41C5C388C0114200C4453A72C13E3D03C160C3E944044120C5FFBB8640FABF7B40F3B89D3DF2413EB663469D3CB53A48B125C30E3D78405BB5933A4F3DCA4117BC96C1F0395645B339803F0940E23EBE426BC0A8BF983BFBBD72B048C00AB868BF3EBEA145EE44E74023C3A1B6A43B31B825BD56C3B9B41E40423FDCBD52463F3EDB421DC2B743A0387CC5D8C788C4D0393744AAC452438B41F4414CC05AADDBC3C337A4C186423BC0363F7FB530432139AAB997C2A4BF50B505409EB877C380B5ABC2623BCC3B1438BD31BB44C0298B39DF3C2142E6C073B4EEC3B340A9C15EC009C0D0C184C176C3C83F5EBE7544BD3F004401C0E8C1C9C0FE3422C1CB405ABEDCB9C241F34329C349446AB86E433294323C463E4CAD10BC5EC38D40CAB6CB4256C5F9C254436B37D7C082B880BD3344D3C2A5B8F7AFBC3E72424CC4D0BE9842A6BCE3BFB6A9D5C40EB7DEC1A0C01FAF53C3983D14C410BE743DFE42A2358C410D419BC17E35F3C45743BEBD31429E3909C0FD3292BECBB17FC59A3C09448E3DAA45BC2C80C23633393A40C131B81F385CC445C53BC30644D1B6383E313CAE3BD4C1C53EBD3B063E5B33FB3B064586B7A93E803DF74059448DB87B41604182BA57AE74BD0141B6C00E3C5BC4C5C4613C58C0CD3F3338C4C0613B32C4924145C024C14FBF13C208BE4F325748AB41244573C243C44DC2DCBEE940FCBDA3C069462F39282D9744C0C14EC18340574520C4AB3AE4BE8FA2EF3E44C57A3EDD4573390A4231407AC7E442A53C0B3DC3B840B3"> : tensor<3x5x40xf16>
    return %0 : tensor<3x5x40xf16>
  }
}

