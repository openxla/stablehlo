// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[0, 1], [2, 3]]> : tensor<2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xbf16>, tensor<2x7xbf16>)
    %2 = call @expected() : () -> tensor<5x6x7xbf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %5 = stablehlo.minimum %arg0, %arg1 : tensor<bf16>
      stablehlo.return %5 : tensor<bf16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1], inserted_window_dims = [0, 1], scatter_dims_to_operand_dims = [0, 1], index_vector_dim = 1>, unique_indices = true} : (tensor<5x6x7xbf16>, tensor<2x2xi32>, tensor<2x7xbf16>) -> tensor<5x6x7xbf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xbf16>, tensor<5x6x7xbf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xbf16>, tensor<2x7xbf16>) {
    %0 = stablehlo.constant dense<"0x03C03D401D40704033C0F9BE8B4010C0253FC6BF89C0B3BF8FC0813F563F344039C038C0CCBF2FBD634017C0AA40A4C05A3F7C40CEC08E3FE7C006401AC04840153F8DC068C035408DC0334020C0713E77C098400D40BCBF02C03ABEB0408BBFAF3F75BE5C4038C081C015C01040C5BF7440CAC0BF3FFF3F41C0AEBFB0BF28C0AFC0C63E8940F1C08C3F6940C53F183F09407C3FFF3E8640A83EC8BF2F4059403CBF08BF1B40E7BF2D40B740B03FAF3F93C04CC0DCBFD5BC45C0ABC04E40C2BE9C40FD3F11409FC0F5BDD3BFBF403C401C40A93FAFC007C0D7BF224049BEE93F20BF10409540644045BFB63FED3ED7C09C3F98409DBF6140D5BE2F3FBCC08F3F2F40714048BF1AC09B3E2ABF7F40EF3FE5BFB03FF43FBC3E0D40DA40604015C070C0CCC0483FF1BF353E2640E3BFE3BFB4BE054037C09FBF9E3E304077BE18BEA3BFA13F853E3BBF18C0BABE723F86C022C094BE1D40D2BF0A3F7C3F2840973F69C08E402740C1BEB240F44016C123406040A2404B407CC04B40D5C014C0B8403E3FADBF93BEA2404FC0F7BFB2C0263E8E40D33E94C040BDBA3FE93EB03FD6BFB73EBB3E"> : tensor<5x6x7xbf16>
    %1 = stablehlo.constant dense<[[-3.375000e+00, -3.000000e+00, 4.000000e+00, -3.390630e+00, 2.312500e+00, 1.195310e+00, 4.345700e-02], [-3.281250e+00, -1.140630e+00, -1.242190e+00, 9.882810e-01, -2.609380e+00, -3.093750e+00, -4.804690e-01]]> : tensor<2x7xbf16>
    return %0, %1 : tensor<5x6x7xbf16>, tensor<2x7xbf16>
  }
  func.func private @expected() -> tensor<5x6x7xbf16> {
    %0 = stablehlo.constant dense<"0x03C03D401D40704033C0F9BE8B4058C040C0C6BF89C0B3BF8FC0323D563F344039C038C0CCBF2FBD634017C0AA40A4C05A3F7C40CEC08E3FE7C006401AC04840153F8DC068C035408DC0334020C0713E77C098400D40BCBF02C03ABEB0408BBFAF3F75BE5C4038C081C015C01040C5BF7440CAC0BF3FFF3F41C0AEBFB0BF28C0AFC0C63E8940F1C08C3F6940C53F183F09407C3FFF3E8640A83EC8BF2F4059403CBF08BF1B40E7BF2D40B740B03FAF3F93C04CC0DCBFD5BC45C0ABC04E40C2BE9C40FD3F11409FC0F5BDD3BFBF403C401C4052C0AFC007C0D7BF27C046C0F6BE20BF10409540644045BFB63FED3ED7C09C3F98409DBF6140D5BE2F3FBCC08F3F2F40714048BF1AC09B3E2ABF7F40EF3FE5BFB03FF43FBC3E0D40DA40604015C070C0CCC0483FF1BF353E2640E3BFE3BFB4BE054037C09FBF9E3E304077BE18BEA3BFA13F853E3BBF18C0BABE723F86C022C094BE1D40D2BF0A3F7C3F2840973F69C08E402740C1BEB240F44016C123406040A2404B407CC04B40D5C014C0B8403E3FADBF93BEA2404FC0F7BFB2C0263E8E40D33E94C040BDBA3FE93EB03FD6BFB73EBB3E"> : tensor<5x6x7xbf16>
    return %0 : tensor<5x6x7xbf16>
  }
}

