// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xbf16>, tensor<5x2x2xbf16>)
    %2 = call @expected() : () -> tensor<5x6x7xbf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %5 = stablehlo.minimum %arg0, %arg1 : tensor<bf16>
      stablehlo.return %5 : tensor<bf16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xbf16>, tensor<2x2x2xi32>, tensor<5x2x2xbf16>) -> tensor<5x6x7xbf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xbf16>, tensor<5x6x7xbf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xbf16>, tensor<5x2x2xbf16>) {
    %0 = stablehlo.constant dense<"0x28C0A6C09140E0BE4FC09340C63FBBBF4CBF16400C40B3404B40713F43C082C0383FEF3FB33F0B4006BF6BBF0CC0DC3FCF3F0D40893ECEBF47BE7A4043C0943F85404D407340043E20C07C4070C0F43E14C0173FE4C07BBFA1BE884017C1C1C0DABCBF3EB03DC7BE214064C062BF3A3FE83FFB3F4EBFBE3F12407C3F42BF3CBF18C0863F38C07540CBBF433F41C07C3FF53F3040B6BC19409E3E38BF4A408B3F6E408ABF92C0D73F1DC02DBF5C3FD53FA340D4BF7A3F52C03040893F403F03404940083F643F4FBE54C04CBF48405D40113E7B4048C0B340A2BF10BD6B3F10C0BC3FA140B2BE9940193EB53F703F0BBF1CC042BF51404C4057BF91C03DBD0240EEBFA540044074409EBF8FBE3ABFFC3E963F0B40B33E8E3FD4BEF33FCC3F97406F3FC53F99BF0E40C53F2140BBBD973F883EB240CA3EFFBF0F3FDEBF3740A03FD33F573FA33D4840363F24401A40F23F3CC053BF12403F40F43FCCBF1140E640BCC0963F0FBE8D3D52C0CE3FBF3FFF3E433FD53E85BFD8C004C0A4BF0940B83FCA40843FD7BF64C0FEBF8640EFBFA6C0A1BF8B3F613F51C00140D13FB5BF1340663F82C0"> : tensor<5x6x7xbf16>
    %1 = stablehlo.constant dense<[[[2.609380e+00, -6.718750e-01], [-2.578130e-01, 9.492180e-01]], [[-1.609380e+00, -7.514950e-04], [-2.140630e+00, -1.828130e+00]], [[8.593750e-02, 2.796880e+00], [-4.121090e-01, -1.140630e+00]], [[-1.125000e+00, -1.279300e-01], [4.875000e+00, -4.121090e-01]], [[-2.937500e+00, -1.296880e+00], [1.257810e+00, -5.062500e+00]]]> : tensor<5x2x2xbf16>
    return %0, %1 : tensor<5x6x7xbf16>, tensor<5x2x2xbf16>
  }
  func.func private @expected() -> tensor<5x6x7xbf16> {
    %0 = stablehlo.constant dense<"0x28C0A6C09140E0BE4FC09340C63FBBBF4CBF733F0C40B3404B40713F43C082C0383F2CBFB33F0B4006BF6BBF0CC0DC3FCF3F0D40893ECEBF84BE7A4043C0943F85404D407340043E20C07C4070C0F43E14C0173FE4C0CEBFA1BE884017C1C1C0DABCBF3EB03DEABF214064C062BF3A3FE83FFB3F4EBF45BA12407C3F42BF3CBF18C0863F38C07540CBBF433F41C07C3FF53F3040B6BC19409E3E38BF4A408B3F6E408ABF92C0D73F1DC02DBF5C3FD53FA340D4BF7A3F52C0304092BF403F03404940083F643F4FBE54C04CBF48405D40113E7B4048C0B340A2BF10BD6B3F10C0D3BEA140B2BE9940193EB53F703F0BBF1CC042BF51404C4057BF91C03DBD90BFEEBFA540044074409EBF8FBE3ABFD3BE963F0B40B33E8E3FD4BEF33FCC3F03BE6F3FC53F99BF0E40C53F2140BBBD973F883EB240CA3EFFBF0F3FDEBF3740A03FD33F573FA33D4840363F24401A40F23F3CC03CC012403F40F43FCCBF1140E640BCC0A2C00FBE8D3D52C0CE3FBF3FFF3E433FA6BF85BFD8C004C0A4BF0940B83FCA40843FD7BF64C0FEBF8640EFBFA6C0A1BF8B3F613F51C00140D13FB5BF1340663F82C0"> : tensor<5x6x7xbf16>
    return %0 : tensor<5x6x7xbf16>
  }
}

