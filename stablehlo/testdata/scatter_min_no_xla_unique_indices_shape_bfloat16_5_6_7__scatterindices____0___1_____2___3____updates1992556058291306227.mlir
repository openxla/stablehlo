// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xbf16>, tensor<5x2x2x7xbf16>)
    %2 = call @expected() : () -> tensor<5x6x7xbf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %5 = stablehlo.minimum %arg0, %arg1 : tensor<bf16>
      stablehlo.return %5 : tensor<bf16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xbf16>, tensor<2x2x1xi32>, tensor<5x2x2x7xbf16>) -> tensor<5x6x7xbf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xbf16>, tensor<5x6x7xbf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xbf16>, tensor<5x2x2x7xbf16>) {
    %0 = stablehlo.constant dense<"0x03400040CBBF863F74C0B64082BF533CA640DABFC03EFEBFCB4033402C4090BD0140CDBF943F4040A9C045C03E3F3C3F58BF0FC0A73E1E406BC018401E3F074012C03DC04F4038BFDD40913FBAC04A3F3D4000BF714059BF60BF50C0F2BE69402E3E30C04E4090C088C05EC08BC08F3F2140143F65C093BF57C0E33E9FBF0BBF9CBF04C105C0C0BE05C09CBFEDBFDC3FD6BE6BC071C0ABBF9F40F53F323F83C047C024403A3F79C009C03FC05140D7BF27BE78BF194018C0ACBF35405CBEC7BF3E401ABFD23F0D3F34405ABFCABF0B409340713FB0C00740A24029C0A53F933F0BBFAAC01C4009404BC0DBBF1FC063C0AB3F88406ABF81C05F3E9C4088C0983F0240B0404840F8BFB240CC3C3F3FEBBFAB404540513F82409B3F94C02C3F9640883E383FC0BF2CBF164013C0603FAE40D03F00BF70C067BF27C0883E01C0574028C042C0F33FFF3F0E3F353FF5BF154097C020C0C440243CA240B5BF963CCF40C4BF71400C4018404E40DDBF643F66C04CC03A40094008C0163F50BF923FD63F54BF8DC05A40F93FBCC024404A40A7BF09C180406D403A40E5BFAABEAA4098C048C02640"> : tensor<5x6x7xbf16>
    %1 = stablehlo.constant dense<"0x31C049C031BE964055409A4078BFB9C0A7BF8EC0AEBE6B40CF408EBF6B40FF4049C09FBE6340303FA53FE63F8D3F834024BE7DBDA0400FBF3A3FA93F32BE4CC0E5BE9CBF33BF35C023407D4009BF06BF92C03440D8C0ABC053C04CBB67C009406EC05A3E5C3FB3BFB53DB240F23F4D3F9BBF43C09ABF604088BF82406B3F0B4073BF32BFB83E75BF50C0D7BFDB3F4A3F5F4029BF4B3F1F4003C07CC01540FEBF87409C3EA54002C16A3FF93E8A40DD40A740B540D93F20C0C4BF54C00540633F723F1740B9C0554012C087BEB340DCC04F40D5406E400340BFBFAFBF1E413EBF5E3E9D4098400341B03EE53E163F1B3F9BBF7040DDBF9EBF6BBF574092C04ABF6040B03E394089C03CC0674032404F40D03F44BF55C083BE"> : tensor<5x2x2x7xbf16>
    return %0, %1 : tensor<5x6x7xbf16>, tensor<5x2x2x7xbf16>
  }
  func.func private @expected() -> tensor<5x6x7xbf16> {
    %0 = stablehlo.constant dense<"0x31C049C0CBBF863F74C09A4082BFB9C0A7BF8EC0AEBEFEBFCB408EBF2C4090BD49C0CDBF943F303FA9C045C03E3F3C3F58BF0FC0A73E0FBF6BC018401E3F074012C03DC04F4038BFDD40913FBAC04A3F3D4000BF3A3F59BF60BF50C0F2BE9CBF33BF35C0234090C088C05EC092C08F3FD8C0ABC065C093BF67C0E33E6EC00BBF9CBF04C105C0C0BE05C09CBFEDBFDC3FD6BE6BC071C0ABBF9F40F53F323F83C047C024403A3F79C009C043C09ABFD7BF88BF78BF6B3F18C0ACBF32BF5CBEC7BF50C0D7BFD23F0D3F34405ABFCABF0B4003C07CC0B0C0FEBF874029C0A53F02C10BBFAAC01C4009404BC0DBBF1FC063C0AB3F88406ABF81C05F3E9C4088C0F93E0240B0404840F8BFD93F20C0C4BF54C00540633F513F1740B9C094C012C087BE883EDCC0C0BF2CBF164013C0BFBFAFBFD03F3EBF70C067BF27C0883E01C0574028C042C0F33FFF3F0E3F353FF5BF154097C020C09840243CB03EB5BF963C1B3FC4BF7040DDBF9EBF6BBFDDBF92C066C04CC0B03E094089C03CC050BF923FD63F54BF8DC055C083BEBCC024404A40A7BF09C180406D403A40E5BFAABEAA4098C048C02640"> : tensor<5x6x7xbf16>
    return %0 : tensor<5x6x7xbf16>
  }
}

