// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf16>, tensor<5x2x2xf16>)
    %2 = call @expected() : () -> tensor<5x6x7xf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %5 = stablehlo.minimum %arg0, %arg1 : tensor<f16>
      stablehlo.return %5 : tensor<f16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xf16>, tensor<2x2x2xi32>, tensor<5x2x2xf16>) -> tensor<5x6x7xf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf16>, tensor<5x6x7xf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf16>, tensor<5x2x2xf16>) {
    %0 = stablehlo.constant dense<"0xF43962C89EAF1BC036C2243C8544A941D6433E41083F42BFF4B335C434BBDFB8E2449440C54169452F400C421141D9BC6FC281C37343AF348E4488400644EB3F233464BC81C4D43E7CB216BAB0400B46F7C4883295B88843953A4B41AAC38EBEAAC01C320AC8C83D2F2E3ABE7DA4AC41983DB332623D023F2EBFE7BB70C2C5BF4EAFB53FF7383AC12945574400C44A44C9441C38D7BC49C2034119C411BD16351F380ABD8DAFB2C46A3DF23CBBBA134055B51633B6B8DAAFF243BBC4F4B645408842454666BD18385BC3FF406D41BE46DCC310C5D9C373B13EBBC0C1C5380ABD04B5B33925C783C1C4422541C7BF573FD4411F4460C4D23DB83503BDD337E7C06C380537B839CBC15540FCB9CAC43D41B344B04475C3A9388A30343FF12E5CC4F338E5C29AB6B244A4C0E4BD9340E617CEC107BF20444A426EB85CC1B23A5B393C396EC0FD4307B9443F9844BF3E29C1D838BE369A382143704024C11443544403BE2C3F2D40F8C623C4783B36441DBB44BD634133C0A9441D41F638D3BF333C56C65ABEF93C01C07EC16CC1693F302F6EB491C0F642AB4089C1D0BCD8C0A63CBD40C046"> : tensor<5x6x7xf16>
    %1 = stablehlo.constant dense<[[[-6.078130e+00, -4.765630e-01], [8.320310e+00, 1.892580e+00]], [[6.500000e+00, 5.556640e-01], [1.048280e-02, 4.400630e-02]], [[2.152340e+00, -1.807620e+00], [-2.925780e+00, -2.650390e+00]], [[2.904300e+00, 2.955080e+00], [3.460940e+00, 2.757810e+00]], [[-7.792960e-01, -6.484380e-01], [-2.753910e+00, 1.228520e+00]]]> : tensor<5x2x2xf16>
    return %0, %1 : tensor<5x6x7xf16>, tensor<5x2x2xf16>
  }
  func.func private @expected() -> tensor<5x6x7xf16> {
    %0 = stablehlo.constant dense<"0xF43962C89EAF1BC036C2243C8544A941D643923F083F42BFF4B335C434BBDFB8E244A0B7C54169452F400C421141D9BC6FC281C37343AF348E4488400644EB3F233464BC81C4D43E7CB216BAB0400B46F7C4883295B88843953A4B41AAC38EBEAAC01C320AC8A2292F2E3ABE7DA4AC41983DB332623D72382EBFE7BB70C2C5BF4EAFB53FF7383AC12945574400C44A44C9441C38D7BC49C2034119C411BD16351F380ABD8DAFB2C46A3DF23CBBBA134055B51633B6B8DAAFF243BBC4F4B645408842454666BD18385BC33BBF6D41BE46DCC310C5D9C373B13EBBC0C1C5380ABDDAC1B33925C783C1C4422541C7BF573FD4411F4460C4D23DB83503BDD337E7C06C380537B839CBC15540FCB9CAC43D41B344B04475C3A9388A30343FF12E5CC4F338E5C29AB6B244A4C0E4BD9340E617CEC107BFEC424A426EB85CC1B23A5B393C396EC0FD4307B9443F9844BF3E29C1D8383CBA9A382143704024C11443544403BEEA3C2D40F8C623C4783B36441DBB44BD30B933C0A9441D41F638D3BF333C56C65ABEF93C01C082C16CC1693F302F6EB491C0F642AB4089C1D0BCD8C0A63CBD40C046"> : tensor<5x6x7xf16>
    return %0 : tensor<5x6x7xf16>
  }
}

