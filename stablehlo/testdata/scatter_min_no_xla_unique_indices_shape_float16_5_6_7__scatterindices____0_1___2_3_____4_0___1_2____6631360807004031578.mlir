// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf16>, tensor<5x2x2xf16>)
    %2 = call @expected() : () -> tensor<5x6x7xf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %5 = stablehlo.minimum %arg0, %arg1 : tensor<f16>
      stablehlo.return %5 : tensor<f16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xf16>, tensor<2x2x2xi32>, tensor<5x2x2xf16>) -> tensor<5x6x7xf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf16>, tensor<5x6x7xf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf16>, tensor<5x2x2xf16>) {
    %0 = stablehlo.constant dense<"0xCCBFAC41C642593D1E267937BABF3BB988C5DCB94A3A15C4CC32DE45683E664011C894412A3C2A3C67BA18C33CBD5C43A245C3BADCC64944AA3C5DC1AA361D3BD943374044470CC048BFEEB50B46AABFE5C0254107B9094268C29741A84370404CC3211A0B378CBC5BC09142CD407A3CCC3BEDA15B42933C98402A4466C4034505C427C58C38E34525C1ADC159AA0242A7433AC3F5C0133EAAC439C0FEBF903F7E44CA41CABB0040973F6FC4E6C206AA2DBBFD476742AB44793B77BEF23A12BBA5BCCDC2733D7DC251C4E4C1D2BDA64312C2F140CBB628C2A7C048B19140AF4437BD83C36D3F553AF54007B4ADC05AC2D940ED3A3B38CF41BB36CC47EF442347BF3B26C05441EB2BDCC3423FA2B886B834415DC13D3DE23CE2345C460136C1BA923F0FBDCCA4603B08BCC6B3664824C40E41E2C0D63D6A4682B875BB71BECEBC04AFC8C3483CFD3D1E3A86C6EBC4D03F15C3D94233C2DE43CA31DDBBC8C05EC769BB7044573EA8434F40544225C4BAABF8C390B5BE38663DA83BE3C0D5BD38422546FBB9B6C100C8303F29C4FEB4A4C3FEBF743D3239AE32064164C6E13BAEC1D942C540"> : tensor<5x6x7xf16>
    %1 = stablehlo.constant dense<[[[5.578130e+00, 3.832030e+00], [-5.433590e+00, -4.902340e+00]], [[-1.123050e+00, -1.446290e+00], [2.984380e+00, -7.114250e-01]], [[-3.152340e+00, 1.376950e+00], [-3.632810e+00, -1.293950e+00]], [[-1.769530e+00, 1.009380e+01], [-9.404290e-01, -2.845700e+00]], [[2.587890e-01, -1.733400e-02], [1.516600e+00, -2.052000e-01]]]> : tensor<5x2x2xf16>
    return %0, %1 : tensor<5x6x7xf16>, tensor<5x2x2xf16>
  }
  func.func private @expected() -> tensor<5x6x7xf16> {
    %0 = stablehlo.constant dense<"0xCCBFAC41C642593D1E267937BABF3BB988C5E7C44A3A15C4CC32DE45683E664011C894412A3C2A3C67BA18C33CBD5C43A245C3BADCC649446FC55DC1AA361D3BD943374044470CC048BFEEB50B46AABFE5C0254107B97EBC68C29741A84370404CC3211A0B378CBC5BC09142CD407A3CCC3BEDA15B42C9BD98402A4466C4034505C427C58C38E34525C1ADC159AA0242A7433AC3F5C0133EAAC439C0FEBF903F7E44CA41CABB0040973F6FC4E6C206AA2DBBFD476742AB44793B77BEF23A12BBA5BCCDC2733D7DC251C4E4C1D2BDA64312C2F140CBB628C2A7C048B19140AF4444C383C36D3F553AF54007B4ADC05AC2D940ED3A3B38CF41BB36CC47EF4414BFBF3B26C05441EB2BDCC3423FA2B8B1C134415DC13D3DE23CE2345C460136C1BA923F0FBDCCA4603B08BCC6B3664824C40E41E2C086BB6A4682B875BB71BECEBC04AFC8C3483CFD3D1E3A86C6EBC4D03F15C3243433C2DE43CA31DDBBC8C05EC769BB91B2573EA8434F40544225C4BAABF8C390B5BE38663DA83BE3C0D5BD38422546FBB9B6C100C8113E29C4FEB4A4C3FEBF743D3239AE32064164C6E13BAEC1D942C540"> : tensor<5x6x7xf16>
    return %0 : tensor<5x6x7xf16>
  }
}

