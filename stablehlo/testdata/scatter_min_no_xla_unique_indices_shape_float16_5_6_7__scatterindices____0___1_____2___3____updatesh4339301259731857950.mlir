// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf16>, tensor<5x2x2x7xf16>)
    %2 = call @expected() : () -> tensor<5x6x7xf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %5 = stablehlo.minimum %arg0, %arg1 : tensor<f16>
      stablehlo.return %5 : tensor<f16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xf16>, tensor<2x2x1xi32>, tensor<5x2x2x7xf16>) -> tensor<5x6x7xf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf16>, tensor<5x6x7xf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf16>, tensor<5x2x2x7xf16>) {
    %0 = stablehlo.constant dense<"0xBF38C53F5CC317BC0C3BBC41B939EC2818B54BBE80BE1C3CA13D98C33E407AC3B0BE69332D412BC119418D3C9DC2EB411B3EAC40502E51C3B8BA05BCE7C51E45E4B9DDB4B4C367B96EC0043EACC3AAC1643F31451B2CD9C037BD0DBBABC58F3B1B440A3F4447E240EAC833C3AA3DFCC4AD46C3BEA54621B5BB43F2BD923FA3418EC521C570BFC83937C4954085C4CC3DB2BA2FC3C03A783F9041B135B23D5A443C442DC1D831113E37424C3A57BDDFB87DB52BC0A4C165C1163ACB438AC1C23EB5C6E1C563BE1CBFF9B30DC10EC555453A45C0B7EAC4DC39B0C223B9F9B989AB46C097462F4615BC2FC004C31BC6874210C39F452746C6BC44BD5B3EFD43A34478B80F45A33D15BD9A45EC42DD4282BFA0BDE5C1BF41B1B62E4017C4DE4298C4A94091C49A3875C22E22A3383142A5C20644DB31ADC2393AA63420C01738AD3E5C36BF3835A2CBC0E5401F44B9BA5CAA77B050B63F41E7C2EBC5FB453EB5E5C2463F70B8AA43723F5DC6A6C4BABD6C4585BD883D0139473D46BD4A3C0FC10CB4793D54C0F8BA964061C6F5412CBD70C15F3DED3576C4373B7335B844A7B1F94317C8F8C0"> : tensor<5x6x7xf16>
    %1 = stablehlo.constant dense<"0x244112C2C6BF4DC58942143EE2B4F43A78423C38D4BDC03980C7A13CF2B6323CB4C1EB44D9C5332CB6C590BDB6B8C3BFB1B8B8C6C23D2FBDF3BFCA3D97C349407FB960453A450B3919C1162C374203BB74C29E388CC61641923F40BCC6B932C328C4033CA942D53B064109407F35503D7EC0A7BC61474C41B84389385ABBF4BAAABD6F401C418C41E8407ABAF0B851C6B6BCBC406A418DB926BE70BD69C571C15ABD733E25C4FBB2EA40D0C3C3BA5EBDE1403AB5CDC760B269C49FBB382FCCC0D54515B81BBB12C15844A7392ABD11392D44BEC499411FB59F44EA3F1A4572BF6243C8C3504233B8EE38A6407244D8416D3DBC3F5830714199B25042C3BD534290BE043F8AC2F639F8BABE42433F6940263D8FC0A5430BBE"> : tensor<5x2x2x7xf16>
    return %0, %1 : tensor<5x6x7xf16>, tensor<5x2x2x7xf16>
  }
  func.func private @expected() -> tensor<5x6x7xf16> {
    %0 = stablehlo.constant dense<"0xBF3812C25CC34DC50C3B143EE2B4EC2818B54BBE80BEC03980C798C3F2B67AC3B4C16933D9C52BC1B6C590BD9DC2C3BFB1B8B8C6502E51C3B8BA05BCE7C51E45E4B9DDB4B4C367B96EC0043EACC3AAC1643F3145F3BFD9C097C30DBBABC58F3B1B440B3919C1162CEAC833C374C2FCC48CC6C3BE923F40BCC6B932C328C4033C8EC521C570BFC83937C4503D85C4CC3DB2BA2FC3C03A783F9041B135B23D5A443C442DC1D831113E7EC0A7BC57BDDFB87DB52BC0A4C165C1AABD6F408AC1C23EB5C6E1C563BE51C6B6BC0DC10EC58DB926BE70BD69C571C1B0C223B925C4FBB246C097462F4615BC2FC004C31BC6874210C39F452746C6BC44BD5B3EEA40D0C3C3BA5EBDA33D15BDCDC760B269C482BFA0BDE5C1BF4115B81BBB17C4DE4298C42ABD91C49A38BEC42E221FB53142A5C2064472BFADC2393AA63420C01738AD3E5C36BF3835A2CBC0E5401F44B9BA5CAA77B0C8C33F41E7C2EBC5A6403EB5E5C26D3D70B85830723F5DC6A6C4C3BD534290BE883D8AC2F63946BD4A3C0FC10CB4263D8FC0F8BA0BBE61C6F5412CBD70C15F3DED3576C4373B7335B844A7B1F94317C8F8C0"> : tensor<5x6x7xf16>
    return %0 : tensor<5x6x7xf16>
  }
}

