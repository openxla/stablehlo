// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[0, 4]> : tensor<2xi32>
    %1:2 = call @inputs() : () -> (tensor<4x2x3x5xf32>, tensor<4x3xf32>)
    %2 = call @expected() : () -> tensor<4x2x3x5xf32>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %5 = stablehlo.minimum %arg0, %arg1 : tensor<f32>
      stablehlo.return %5 : tensor<f32>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [1, 3], scatter_dims_to_operand_dims = [1, 3]>, unique_indices = true} : (tensor<4x2x3x5xf32>, tensor<2xi32>, tensor<4x3xf32>) -> tensor<4x2x3x5xf32>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<4x2x3x5xf32>, tensor<4x2x3x5xf32>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<4x2x3x5xf32>, tensor<4x3xf32>) {
    %0 = stablehlo.constant dense<"0x4EE8AF4083176FC05CB7D7BF5C9790BF4148654095E26F4026687D40A6AEE440E2BE6EC036A2043F984A7D408D4BC23EE95C773E294E22C0D773413F4E52D4400ED600C0487010C0FF6A7FBE81799C3F181D84C0D6A8AE40EF7E84C00AD11E3FB5253E40A654933E1D8F7940D5973FC07CE537407900CBBFD9B239C009C9C13EB1F108C0298A5340F0A815C01CAE2641BE429040FFA324BF4A796840A42D86C01B2E4D409B6B8F3F777CCC3EC30CC0BFFE3503407B7579C022AFAFC04BD22B40531DDC3F086AA2BF160283BFC6D947C0AD53C7BF787BC33D6EADDDBF607003402B2882C08EDE75BFBB691540EF89174098255CC09D69A63F22FFABC06E30C0BD69D01D3F73831EBEBA73373FDFA0B7C011D5353F9FCFA4402883F3BF74263B407F5E2CBF18463EBDD7C3404065D35A407DE628C0398A96BE838FC5BE89A87CC05E1C00401F83F13F337E164012170E3F84100CC00F6785BFB36E2BBF913E8D401EF2B0BE9D049B4045388CBF562EA2407F5A3DC07FBDB5C08CC5B03F3AD41F3FD38E95405E9A634026B91EC0A70BEFC087D52E3E9D9610409AE6B1BFFC7503BFF207363FA3574AC0CD3DE43F754AC93F91D64D3FA1A6B03E6DD94BC0F26EF04047B22240F9FBAAC0DE2D0A40DEB83040E08C27BE8B8E043F38B390C0700D0C3F"> : tensor<4x2x3x5xf32>
    %1 = stablehlo.constant dense<[[0.990824878, 3.77698541, -2.31757641], [-4.50635529, -1.10479712, 0.206992641], [4.47893143, -3.14345479, 3.37684083], [-1.05093396, -1.32568705, -5.92639636]]> : tensor<4x3xf32>
    return %0, %1 : tensor<4x2x3x5xf32>, tensor<4x3xf32>
  }
  func.func private @expected() -> tensor<4x2x3x5xf32> {
    %0 = stablehlo.constant dense<"0x4EE8AF4083176FC05CB7D7BF5C9790BFB3A67D3F95E26F4026687D40A6AEE440E2BE6EC036A2043F984A7D408D4BC23EE95C773E294E22C02C5314C04E52D4400ED600C0487010C0FF6A7FBE81799C3F181D84C0D6A8AE40EF7E84C00AD11E3FB5253E40A654933E1D8F7940D5973FC07CE537407900CBBFD9B239C009C9C13EB1F108C0298A5340103490C01CAE2641BE429040FFA324BF4A796840A42D86C01B2E4D409B6B8F3F777CCC3EC30CC0BFE1F5533E7B7579C022AFAFC04BD22B40531DDC3F086AA2BF160283BFC6D947C0AD53C7BF787BC33D6EADDDBF607003402B2882C08EDE75BFBB691540EF89174098255CC09D69A63F22FFABC06E30C0BD69D01D3F73831EBEBA73373FDFA0B7C011D5353F5D2E49C02883F3BF74263B407F5E2CBF18463EBDD7C3404065D35A407DE628C0398A96BE838FC5BE89A87CC05E1C00401F83F13F337E164012170E3F84100CC00F6785BFB36E2BBF913E8D401EF2B0BE9D049B4045388CBF562EA2407F5A3DC07FBDB5C0018586BF3AD41F3FD38E95405E9A634026B91EC0A70BEFC087D52E3E9D9610409AE6B1BFFC7503BF0AA5BDC0A3574AC0CD3DE43F754AC93F91D64D3FA1A6B03E6DD94BC0F26EF04047B22240F9FBAAC0DE2D0A40DEB83040E08C27BE8B8E043F38B390C0700D0C3F"> : tensor<4x2x3x5xf32>
    return %0 : tensor<4x2x3x5xf32>
  }
}

