// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>)
    %2 = call @expected() : () -> tensor<3x5x40xbf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %5 = stablehlo.multiply %arg0, %arg1 : tensor<bf16>
      stablehlo.return %5 : tensor<bf16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xbf16>, tensor<2x1xi32>, tensor<3x5x2xbf16>) -> tensor<3x5x40xbf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xbf16>, tensor<3x5x40xbf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>) {
    %0 = stablehlo.constant dense<"0x923F0B3F17405E40E53E64C0C23F4ABF91C0464003C19B3E144018C11C40203EEEBE35C00DC03BC0453FF54017C1CD40F6BFF03D3AC0634014C0B4BF5DC02CBF7BBF0841EAC04B405D4024C0114017BFD7BF1EBED6C03BC088403640B2BF0FC00AC04BC01041FCBF36C08D40AA3F2CC061401341B6C082C0513F834013BF6E3E2FC0F1BEBEBE51BFC53F03403140413F59C03F400740C4BFBB3FAB3E4BC050C0A440093FA33F7D3F5E40B4408E3F194030C01DC081BFC9BFABBD5CBF18C03FC0CCBF363F7440A040FB3E473F0F41B8C09EBF63BF453E1640094189C03BC0554005BFA8C0A33F88401F40E13EA4BF1640A23F70BFCAC0CD3EBD3F02C039C09E4061BE0C40914074C0923F25C060BF84C025C0F8BFBFC0903F45BE2A40794097BF4240EABFBA40E140FF3F05C0A4C0BBBEFF3EF43F61BF5A40A7BF344082C04ABF97BF7E3FE1BFE3BF87BE1DC001406DC04C4006C0464087BF143E2240883CAFBF0840C2BFB540C7BFC5C0FA3F08C0A2C0B83F19BE673F49C02BC03DBFC3BF8FC042C07740224043BF0540D7C014401440D3BF37C080C0864087C076C096BF813E5340D83FB43FC4401940B0407D403CC0C9BE6ABF253FA7BFBFBFC03F953DA5BF9E3F7FBFCD3CB1C0803F0D409E40BA3EE9BFE93F353EAF40013F13BFDC3DED3F82401DBE1FC07DBF98BF994095BCF5BE9F3D8CBF0BC16F40764057402EC0C3BF1BBF95BF193F1DC0BCC00B4073C08C4098404AC01B4000C0AC40A0404B40B23F263FC0BFEDBFF13F02C0883F2ABF8BC0A3BFA2BF254052C025C06E3F07C0293F8B3F193C8C3EBB3E8DC087402E40CCBF15BF4DC05E4002BFE1BF0140BBBFD43F85402C4093408FC098C05AC0D4405D3E99BFB5BF7C40CC40594000BE4240CDBFF3BF5840C23EB8C02AC07EC03A3FD2BFFA40B73FA03F1D40A3C092BFB8C08C3D1DC03DC074C042BE4DC05BC026C00B3FB23FD6BF53C082C006C0ACBF82407D40DC3E7DBFBABF0DC0CABF384089C0094064C040C0ABBF30C0F2BFDA3E5EC0EEBE994087C09740763E65BD13C017C092C0C53FE63F713E78C0BD3F5B3F61BF45C038C0D9BF0E4027401D40D3BE13C00F408EC095BE68BEB13FEEC08E3F0F40AC40933FACBFE43E024016C026409340A34082BE1ABF063EE0BE1A4035BF7B3EAABE383F893F05C0363F07C015C00DC0E7BE29405D40BBC08BC034BF363F1B406E408B40D13F613F1E3F903F504074407A409ABFBFC081BF56404440C4BEB540CB3FE4BFB8409DBF2FBF4DBFE9BD10C024C0C93ECB3FB63FEE3F2E4008BD86BF633E4EC05DBF96BFA8C057405FC0BD4042C0F4C0A9C0CB3F1CC0AEC0434012405D403C3FCDBF12C04A40283F6A409C40214024BF8540333E1940BDBFCE3F29C01EC00BBE443F9140E9BF66C02BC0D83E3940424065C017BF2FC0A33FE53F7640ED409440274088C098407FBC354033BF31C001BFF3BF3B40D63F21405940663F654079BE08C089C0B7BF4B406BBE3EBFD1BF5FC07B3EA5C01A4027BFB1C0D1BE2140A140DB3F8A40A54059C099C09EC04BC042C08A3F5AC040BF2E40B6BF2540ADBF2C3F21403C40C13F3BC034401FBF9240A4BE2D3F84C0D33FA23E1140AFBE51C095BF22BF6940003FA0C0A13EF83FACBFA83F463F1940A7BF163F393F52404C40F33F85BEA53F67BFB6C0553F8640FFBD"> : tensor<3x5x40xbf16>
    %1 = stablehlo.constant dense<[[[-1.882810e+00, 1.226560e+00], [-5.593750e+00, -2.265630e+00], [-3.027340e-01, -1.742190e+00], [5.875000e+00, -3.656250e+00], [-7.500000e+00, -3.906250e+00]], [[-1.328130e+00, -4.656250e+00], [-1.453130e+00, 4.468750e+00], [2.984380e+00, -1.054690e+00], [-7.695310e-01, -3.562500e+00], [2.703130e+00, -2.062500e+00]], [[2.167970e-01, -1.171880e+00], [-3.417970e-01, 1.648440e+00], [6.367190e-01, -5.718750e+00], [1.039060e+00, 5.375000e+00], [1.132810e+00, 2.828130e+00]]]> : tensor<3x5x2xbf16>
    return %0, %1 : tensor<3x5x40xbf16>, tensor<3x5x2xbf16>
  }
  func.func private @expected() -> tensor<3x5x40xbf16> {
    %0 = stablehlo.constant dense<"0x923FA1BF17405E40E53E64C0C23F4ABF91C0464003C19B3E144018C11C40203EEEBE35C00DC03BC0453FF54017C1CD40F6BFF03D3AC0634014C0B4BF5DC02CBF7BBF0841EAC04B405D4024C0114017BFD7BFFABFD6C03BC088403640B2BF0FC00AC04BC01041FCBF36C08D40AA3F2CC061401341B6C082C0513F834013BF6E3E2FC0F1BEBEBE51BFC53F03403140413F59C03F400740C4BFBB3FAB3E4BC050C0A440913EA33F7D3F5E40B4408E3F194030C01DC081BFC9BFABBD5CBF18C03FC0CCBF363F7440A040FB3E473F0F41B8C09EBF63BF453E1640094189C03BC0554005BFA8C0A33F88401F40E13EA4BF1640A23FA141CAC0CD3EBD3F02C039C09E4061BE0C40914074C0923F25C060BF84C025C0F8BFBFC0903F45BE2A40794097BF4240EABFBA40E140FF3F05C0A4C0BBBEFF3EF43F61BF5A40A7BF344082C04ABF97BFE841E1BFE3BF87BE1DC001406DC04C4006C0464087BF143E2240883CAFBF0840C2BFB540C7BFC5C0FA3F08C0A2C0B83F19BE673F49C02BC03DBFC3BF8FC042C07740224043BF0540D7C014401440D3BF8DC180C0864087C076C096BF813E5340D83FB43FC4401940B0407D403CC0C9BE6ABF253FA7BFBFBFC03F953DA5BF9E3F7FBFCD3CB1C0803F0D409E40BA3EE9BFE93F353EAF40013F13BFDC3DED3F82407F3F1FC07DBF98BF994095BCF5BE9F3D8CBF0BC16F40764057402EC0C3BF1BBF95BF193F1DC0BCC00B4073C08C4098404AC01B4000C0AC40A0404B40B23F263FC0BFEDBFF13F02C0883F2ABF8BC0A3BF7F40254052C025C06E3F07C0293F8B3F193C8C3EBB3E8DC087402E40CCBF15BF4DC05E4002BFE1BF0140BBBFD43F85402C4093408FC098C05AC0D4405D3E99BFB5BF7C40CC40594000BE4240CDBFF3BF1441C23EB8C02AC07EC03A3FD2BFFA40B73FA03F1D40A3C092BFB8C08C3D1DC03DC074C042BE4DC05BC026C00B3FB23FD6BF53C082C006C0ACBF82407D40DC3E7DBFBABF0DC0CABF384089C0094064C08641ABBF30C0F2BFDA3E5EC0EEBE994087C09740763E65BD13C017C092C0C53FE63F713E78C0BD3F5B3F61BF45C038C0D9BF0E4027401D40D3BE13C00F408EC095BE68BEB13FEEC08E3F0F40AC40933FAF3EE43E024016C026409340A34082BE1ABF063EE0BE1A4035BF7B3EAABE383F893F05C0363F07C015C00DC0E7BE29405D40BBC08BC034BF363F1B406E408B40D13F613F1E3F903F504074407A409ABF584081BF56404440C4BEB540CB3FE4BFB8409DBF2FBF4DBFE9BD10C024C0C93ECB3FB63FEE3F2E4008BD86BF633E4EC05DBF96BFA8C057405FC0BD4042C0F4C0A9C0CB3F1CC0AEC0434012405D403C3FBB4012C04A40283F6A409C40214024BF8540333E1940BDBFCE3F29C01EC00BBE443F9140E9BF66C02BC0D83E3940424065C017BF2FC0A33FE53F7640ED409440274088C098407FBC354033BF31C001BF29C13B40D63F21405940663F654079BE08C089C0B7BF4B406BBE3EBFD1BF5FC07B3EA5C01A4027BFB1C0D1BE2140A140DB3F8A40A54059C099C09EC04BC042C08A3F5AC040BF2E40B6BF2540ADBF2C3F01413C40C13F3BC034401FBF9240A4BE2D3F84C0D33FA23E1140AFBE51C095BF22BF6940003FA0C0A13EF83FACBFA83F463F1940A7BF163F393F52404C40F33F85BEA53F67BFB6C0553F8640FFBD"> : tensor<3x5x40xbf16>
    return %0 : tensor<3x5x40xbf16>
  }
}

