// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<1> : tensor<2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>)
    %2 = call @expected() : () -> tensor<3x5x40xf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %5 = stablehlo.multiply %arg0, %arg1 : tensor<f16>
      stablehlo.return %5 : tensor<f16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>} : (tensor<3x5x40xf16>, tensor<2x1xi32>, tensor<3x5x2xf16>) -> tensor<3x5x40xf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<3x5x40xf16>, tensor<3x5x40xf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>) {
    %0 = stablehlo.constant dense<"0x30444B41D13A1EC133404228B5BF6542DFB978BCCD458F459A480E2C40B9573D67463D2477B7F8436DBF78C04F45EBC0DC323DBDED3F28B095C6843C4FB8F8B6533717422F431142E7BF2B2539BD3CBE0A42E6BD9CBF45414DBC523B52B530C28CBA1AC43FC3683E28C0593D113EE4352CBB1744BD42D8406AC3AAC2D5C7483C413EDFB86D433842663B344770B85B0FE3C053BB103EC13DBF3B1FBF1BC4E7C239420640FA42673D14BFA42E0FC42C3B2D3C1DC0C143693C183DCAC14F3AF543C4439BB5F6C19545693E04C63A3F4E40D8428BBFD93E3F46163D8EC08ABCF7C07C45DF3B4DB003C08E3E2A428AC168C01142C5C1B03A7E411D4596B8863B0AC4C443363574B4253E9740914292421DC413C4163FB4411740E43A9DBAC83931C24AC0C1C0AAC06FBC53450737EA3A9BB021456EB18FC31AC35DBD3FBFC5C4EF32BA43B6360D313CB78AB05ABEB0C24DBCF6C2D03F533160C40BB2DF275FB5FD3D5F3FAB4587B9A741D5368F427FBECD3A7D459BC11AAA8DBCADC851C21638B8BCAF355E40F040C5B976C8713F313EA4C3753CA0B9593C35BED0BF1F39D6399FC34FBCBDC4D03ACE4287405C4691C0B3C564BFADC2DCC21535903C423FF1C2DFB409469FB4AF29473FBE47EB420AC16D4142B75A3D78B679405BBC2CBCA043E6407C3216BB74C3D339D941DCC0EA462F39113AD644C1BE75C2513CE6C2D3C127400C31A1C1EC35F143EBC1C8C10BC1E23F063E133E813DCAC0623E1EC1A74020C19D3DCF308142BAC480C06ABDB33D054284C2103C3FC08CC5963F1F412CB87AB5D838A040A23B94B86FBD69B8863E38C43044B7436C47F9C0213C773F5EC217C173BBE342532D3B390CC7BCC0234272C1EAB9D4C01FC18F423E44FFB6082AFBBDB73F5B392C3397430AC258B35A40633E8BBACABF2440393B15422C45F63FB7438032FF422C41B6A9EC3D18B6A9C17E41B23482C08836B94166452B40C1358B400529D9BD1BC10148FB41123FD539B6C040C11FC2F3AAC2BDC5C6632A5F44C0433F2F50417ABAE6C5384270428D40A838B3456D41783F72C0FCB9093F33B0E6AE363AECBD1732D7408DC14BBCA63D323EC83812C54C40DD3F43A0E4BEE542A5B5E24123B784BCF53D8EBE71C62DC24DC123C1A6C1FCC50540C2BD5EC20243394644385444B0427EC422C441C1E2C4E93F7E42BEBF29C20B2698B72BC107BEFB4292B9533D26BE28BF18BEAE44A543863D0245473CB2C06A3BACB7233137C2E643553835C0113D13400E3CFDBB7D3D1A3AC1C22CBD83BE794207BF633E61C427A8A34105BFF743CFBCE43F7A38894352C477C22B4284C574AA65C23D402042543ADA4444C016B487C32AC3DD3BD7C0D2C4A8C2E8BB0DC7323EE937C445F0C45C351AC5C2C809C570B559C4C04306B07EBD2D42F03ACF3DBAC23FBF313BEBC0EDBA59438E3C2148EBBEFAC5CC3D12B422BE4C44EF4362457DBA40334A46B946DAC6C73B73B8A1B5FB3D2B25B2BD4EC089C20A3C1541F84378C497B012465C41A73CD34525BEBEBD26C4FB3D43BD243AF440363F6F4283C1F53E323CDEBD79C0D23922B913BEBDC220B5EDBB9CC0B1413AC077C2F03CC6413E34CF42F03A47B8B4BCE945DD32E740B740D93DA6C4044439C39DBD74C1BA42CC35B1BF8BB48A3ACFBD0B346FC41743EA2CDFB9D1BDCC438A43"> : tensor<3x5x40xf16>
    %1 = stablehlo.constant dense<[[[-1.460940e+00, -1.257320e-01], [9.179680e-01, -1.856690e-01], [2.452390e-01, -4.546880e+00], [2.044920e+00, -2.384770e+00], [-2.802730e+00, 6.225590e-01]], [[-1.867190e+00, 4.820310e+00], [-3.228520e+00, 2.064450e+00], [-1.952150e+00, 1.548830e+00], [-2.056640e+00, 4.136720e+00], [7.514640e-01, 3.775390e+00]], [[3.455080e+00, 2.746090e+00], [-3.198240e-02, 1.029300e+00], [-4.675780e+00, 1.611330e+00], [-1.035160e+00, 3.232420e+00], [1.133790e+00, -1.213990e-01]]]> : tensor<3x5x2xf16>
    return %0, %1 : tensor<3x5x40xf16>, tensor<3x5x2xf16>
  }
  func.func private @expected() -> tensor<3x5x40xf16> {
    %0 = stablehlo.constant dense<"0x3044C837D13A1EC133404228B5BF6542DFB978BCCD458F459A480E2C40B9573D67463D2477B7F8436DBF78C04F45EBC0DC323DBDED3F28B095C6843C4FB8F8B6533717422F431142E7BF2B2539BD3CBE0A4205349CBF45414DBC523B52B530C28CBA1AC43FC3683E28C0593D113EE4352CBB1744BD42D8406AC3AAC2D5C7483C413EDFB86D433842663B344770B85B0FE3C053BB103EC13DBF3B1FBF1BC4E7C239427DC0FA42673D14BFA42E0FC42C3B2D3C1DC0C143693C183DCAC14F3AF543C4439BB5F6C19545693E04C63A3F4E40D8428BBFD93E3F46163D8EC08ABCF7C07C45DF3B4DB003C08E3E2A428AC168C01142084BB03A7E411D4596B8863B0AC4C443363574B4253E9740914292421DC413C4163FB4411740E43A9DBAC83931C24AC0C1C0AAC06FBC53450737EA3A9BB021456EB18FC31AC35DBD3FBFC5C4EF32BA43DBB90D313CB78AB05ABEB0C24DBCF6C2D03F533160C40BB2DF275FB5FD3D5F3FAB4587B9A741D5368F427FBECD3A7D459BC11AAA8DBCADC851C21638B8BCAF355E40F040C5B976C8713F313EA4C3753C5446593C35BED0BF1F39D6399FC34FBCBDC4D03ACE4287405C4691C0B3C564BFADC2DCC21535903C423FF1C2DFB409469FB4AF29473FBE47EB420AC16D4142B75A3D78B679405BBC2CBCA043E6407C32E74574C3D339D941DCC0EA462F39113AD644C1BE75C2513CE6C2D3C127400C31A1C1EC35F143EBC1C8C10BC1E23F063E133E813DCAC0623E1EC1A74020C19D3DCF308142BAC480C06ABDB33D054284C224C23FC08CC5963F1F412CB87AB5D838A040A23B94B86FBD69B8863E38C43044B7436C47F9C0213C773F5EC217C173BBE342532D3B390CC7BCC0234272C1EAB9D4C01FC18F423E44FFB6082AFBBDB73FB2C52C3397430AC258B35A40633E8BBACABF2440393B15422C45F63FB7438032FF422C41B6A9EC3D18B6A9C17E41B23482C08836B94166452B40C1358B400529D9BD1BC10148FB41123FD539B6C040C158C8F3AAC2BDC5C6632A5F44C0433F2F50417ABAE6C5384270428D40A838B3456D41783F72C0FCB9093F33B0E6AE363AECBD1732D7408DC14BBCA63D323EC83812C54C40DD3F43A0E4BEE542A5B5E2413BC484BCF53D8EBE71C62DC24DC123C1A6C1FCC50540C2BD5EC20243394644385444B0427EC422C441C1E2C4E93F7E42BEBF29C20B2698B72BC107BEFB4292B9533D26BE28BF18BEAE44A543863D024582A8B2C06A3BACB7233137C2E643553835C0113D13400E3CFDBB7D3D1A3AC1C22CBD83BE794207BF633E61C427A8A34105BFF743CFBCE43F7A38894352C477C22B4284C574AA65C23D402042543ADA44044C16B487C32AC3DD3BD7C0D2C4A8C2E8BB0DC7323EE937C445F0C45C351AC5C2C809C570B559C4C04306B07EBD2D42F03ACF3DBAC23FBF313BEBC0EDBA59438E3C2148EBBEFAC5CC3D12B422BE4C44A3CA62457DBA40334A46B946DAC6C73B73B8A1B5FB3D2B25B2BD4EC089C20A3C1541F84378C497B012465C41A73CD34525BEBEBD26C4FB3D43BD243AF440363F6F4283C1F53E323CDEBD79C0D23922B9B032BDC220B5EDBB9CC0B1413AC077C2F03CC6413E34CF42F03A47B8B4BCE945DD32E740B740D93DA6C4044439C39DBD74C1BA42CC35B1BF8BB48A3ACFBD0B346FC41743EA2CDFB9D1BDCC438A43"> : tensor<3x5x40xf16>
    return %0 : tensor<3x5x40xf16>
  }
}

