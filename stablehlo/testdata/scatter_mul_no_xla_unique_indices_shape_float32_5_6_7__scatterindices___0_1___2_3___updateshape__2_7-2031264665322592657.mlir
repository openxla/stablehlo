// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[0, 1], [2, 3]]> : tensor<2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<2x7xf32>)
    %2 = call @expected() : () -> tensor<5x6x7xf32>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %5 = stablehlo.multiply %arg0, %arg1 : tensor<f32>
      stablehlo.return %5 : tensor<f32>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1], inserted_window_dims = [0, 1], scatter_dims_to_operand_dims = [0, 1], index_vector_dim = 1>, unique_indices = true} : (tensor<5x6x7xf32>, tensor<2x2xi32>, tensor<2x7xf32>) -> tensor<5x6x7xf32>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32>, tensor<2x7xf32>) {
    %0 = stablehlo.constant dense<"0xB741D0BFDD36DBBE826D1A405F92853F6B9AC8C02FE7D93FA945F3BFAA8B213D5BB5123E36A5383FB3500E4050AB56BE878C47C01948CCBF7F1B04407157A7BFB23869C09E8423401FBB7CBFBBDC76C04BBC2C407BB0D8C059968FC01CA4BD3F6785683FB6D8A5BFDBAA323ED90AADBF5B33E5C0777F5A40483B3EC0176604C09345B640156C4EC052F9E040B3976CBFE0FE733F10F7B63FD7A469C0E635AABE096E0DBF3FDBA340CB2165C0C4508A4027ADC9BFE1F54C3F4ED1AC3EC3EF34C08B8F6340ABC09BBF2907954027B5F6BF309FAEBEBE5D8F3FF73A7BBC176337400E5702C0E271E83FE580F63EBD179EC0547565BFB5FBE03F57B248BF7E4D84C0AB86424062080AC08940C5BF3EBDCD3F7FAB5A3F58F2BABEC7D5F3BE50DDB540B46B8FC05CDE9B3F9B948F3FDD338B40E925323F529CBD3FB6052340834F47C01337D23F3E995FBF0DC16DC0EE05AEBF389202408091353D5367F8BF2A7BA63F727EF03FDFD6334099DBC03F9D2009C08BEF3CBFA0A35740A3C2644010B608BE62B8A4BFCD80DB3FDE2961400713CE3E66DFCF3F736233C0F92A90408B02E2BCEA024940ECBBA53F58960FC013F60ABD0A3D8940FA60C73F5DFDCA3EB2D56FC0D6E8E43F0EEF9B402A9F0B4051228BC03DB1194011E1323F8FFFA6BFCD0D4640BA576A3F0E7B7CBEDD7737400B8D4AC0B98DA73E748757C0602AA43F2F570CC005B38640515998BD65E5814061371340CC2840C0CB5C0FC085678340D66066C09C7968BF40DB1CC08B8917401A41AD3EE38B19C0B1C63CC06E199940A98C0DC03202DE3FF9979D3E397DCBC08C5A3340EFD86940641864C0FC7443C0B4530EC0AABFAEBF46CB9BC0AE68BE405DBD763E807729BF4E397540C695204056F8D33F648B5C3F68D0DC3EEC85E43F5D0572BF4450A63F0F7205C0E55EB83EBB7F0CC0D1349D401E08B1BF152F57C08BE584C0B462C0BF21FAB53FA63E63C04ED93AC09580C93F387A464023DF3DC07CE80740C99687BF9394DA40BD08C1BFCCE63140D4F39C3F0AB407C0C8EF41C0426553407301FEBFE1CDB43F5A58C340FCCCF1BF5B30D03FB0B53BBE0CFFBDC0BF210EC0585FE93EF70DB940DEC346C0CAD31BC01086D03EED803440C82CD43F9529A43F711E1040DB29AE3FBF4884BFC82B7440ED729A3EBAA098BF"> : tensor<5x6x7xf32>
    %1 = stablehlo.constant dense<[[0.914233744, -1.67476952, -3.78466344, -2.8522985, -3.44033694, 1.58223522, 2.92607903], [1.41089821, -4.39718723, 1.25692129, -1.48140574, 1.26099622, -5.63212061, 0.235085547]]> : tensor<2x7xf32>
    return %0, %1 : tensor<5x6x7xf32>, tensor<2x7xf32>
  }
  func.func private @expected() -> tensor<5x6x7xf32> {
    %0 = stablehlo.constant dense<"0xB741D0BFDD36DBBE826D1A405F92853F6B9AC8C02FE7D93FA945F3BFBEB0133DEAB375BE83B42EC077F6CAC033A2383FDEDD9DC0A16F95C07F1B04407157A7BFB23869C09E8423401FBB7CBFBBDC76C04BBC2C407BB0D8C059968FC01CA4BD3F6785683FB6D8A5BFDBAA323ED90AADBF5B33E5C0777F5A40483B3EC0176604C09345B640156C4EC052F9E040B3976CBFE0FE733F10F7B63FD7A469C0E635AABE096E0DBF3FDBA340CB2165C0C4508A4027ADC9BFE1F54C3F4ED1AC3EC3EF34C08B8F6340ABC09BBF2907954027B5F6BF309FAEBEBE5D8F3FF73A7BBC176337400E5702C0E271E83FE580F63EBD179EC0547565BFB5FBE03F57B248BF7E4D84C0AB86424062080AC08940C5BF3EBDCD3F7FAB5A3F58F2BABEC7D5F3BE50DDB540B46B8FC05CDE9B3F9B948F3FDD338B40E925323F529CBD3FB6052340834F47C01337D23F3E995FBF0DC16DC0EE05AEBF389202408091353D5367F8BF2A7BA63F727EF03FDFD6334099DBC03F9D2009C08BEF3CBFA0A35740A3C2644010B608BE62B8A4BFCD80DB3FDE2961400713CE3E66DFCF3F736233C0F92A90408B02E2BCEA0249407BD5E93F54D81D41D0A92EBD494ECBC07B6AFB3F66E80EC0D88661BFD6E8E43F0EEF9B402A9F0B4051228BC03DB1194011E1323F8FFFA6BFCD0D4640BA576A3F0E7B7CBEDD7737400B8D4AC0B98DA73E748757C0602AA43F2F570CC005B38640515998BD65E5814061371340CC2840C0CB5C0FC085678340D66066C09C7968BF40DB1CC08B8917401A41AD3EE38B19C0B1C63CC06E199940A98C0DC03202DE3FF9979D3E397DCBC08C5A3340EFD86940641864C0FC7443C0B4530EC0AABFAEBF46CB9BC0AE68BE405DBD763E807729BF4E397540C695204056F8D33F648B5C3F68D0DC3EEC85E43F5D0572BF4450A63F0F7205C0E55EB83EBB7F0CC0D1349D401E08B1BF152F57C08BE584C0B462C0BF21FAB53FA63E63C04ED93AC09580C93F387A464023DF3DC07CE80740C99687BF9394DA40BD08C1BFCCE63140D4F39C3F0AB407C0C8EF41C0426553407301FEBFE1CDB43F5A58C340FCCCF1BF5B30D03FB0B53BBE0CFFBDC0BF210EC0585FE93EF70DB940DEC346C0CAD31BC01086D03EED803440C82CD43F9529A43F711E1040DB29AE3FBF4884BFC82B7440ED729A3EBAA098BF"> : tensor<5x6x7xf32>
    return %0 : tensor<5x6x7xf32>
  }
}

