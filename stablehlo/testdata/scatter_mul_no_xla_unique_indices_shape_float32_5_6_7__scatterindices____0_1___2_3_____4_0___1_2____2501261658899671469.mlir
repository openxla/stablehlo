// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<5x2x2xf32>)
    %2 = call @expected() : () -> tensor<5x6x7xf32>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %5 = stablehlo.multiply %arg0, %arg1 : tensor<f32>
      stablehlo.return %5 : tensor<f32>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xf32>, tensor<2x2x2xi32>, tensor<5x2x2xf32>) -> tensor<5x6x7xf32>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32>, tensor<5x2x2xf32>) {
    %0 = stablehlo.constant dense<"0x8664953F29FB23BFFF98583FDB9B02C0A4762CC0FA59B1BF100D893FDF9A80C02B47BB3FDFF4AB3F961F9EBFE652A740BFC49DBF89BF4FBF52A4A840940CEA3E73BD563F5EC89B40913D1ABC57CB933F0C2CE13DEFC80240B74552BFF9382540BAABED404B621EBF8DFA99C0CAAF1AC07121F23F0BCEF6BE10710BC0A2A206407914204061B5BE3F9B931AC055E5F13FF30E80C029018EC056F439C02FD03AC062F778401AB2F63F0BF1D740D7B7A93FEA8E2DC040CE1A3F1CB63CBF023B37BFF4CD824034A12AC078BDF83F9307F43F3A8ED7BF11F0AF3F782C473F911F23400B2B09BD0CA05C3FAD6C43C078CE86BE2934783E05E417409BC74BBDC8493C4007D0E840ADE93BC0DB0A0E40C72043406918F4C0B92E29BEE00789BF9343433FD09B7A407E847540A1F117C1CD923740975D873FDFB91EBF6A498A3F0282BA3F6278063E13F82D3F3DE4564097EB1AC0CA531E4015AA8EC03BAE29BF2D102B40C11F3B40BA54523F852CD4BF59E36CBF53DF45C096BC8AC07F079E40B8F17FBFC0628C3FA89316C0D1E48740E81C94402BBBBCC06F1E7DBC1C1804C0AB03A73E230FBCBFE6F46A3F4757423F01B290C0494EDB3F550E7E40CDD6EC400EE286BF80393F4053088940E14E8840C9E15B405494CDBD00DA1C3E107B8D40427A0BC0F70F863F9FA1B33F0B1D34C0CE191E40C8914BC07BB90C40C8D60A3F465827405EED93C093585EC0FD9D96BFF44BE2C0C34502C1C14616407C881440A2CA9F408C0C263FD7A5A44091E6CBC08689CB40B2BB23C049D811C0123B43C02DCACEBF3AF284BF0EA93FC00E264EC0D659A6BF0C951F40F4918CC0FBB31C40950D433F78B7B23F66693640BD119640DB850FC0A976D53F956EA4C09915EABFDCF57ABE5B65DABFB0944A4091A6EDBFCDE85FBF89768F4085DDA140A065363F56EEB0BF249659C0718484BFABEDD73F16345ABFF48C723EB8E74640CD5A29C0F219DDBFE2AB80408D0FE7BCA3EE86C085229F400E39813FAC659F3F3CE2723F34EF3C4096108C3FDB8C94C0716A4E4006ADCFBF6ABA104046A48ABE8A6FA5402F50763F5B33A2BFC3CAA840FFAD80C08BC451C054C195404CA20840466348406C7CBF40C520B63F752B11BF489306BEB58FF1BFD7F1C4BEC47D0B40D81E2EC0A4490E3FCE6413BFCFD82B3F"> : tensor<5x6x7xf32>
    %1 = stablehlo.constant dense<[[[-2.42871165, 0.565597475], [-3.65512323, -2.73404431]], [[2.79064369, -0.55844295], [-0.909625351, -6.94445753]], [[3.98960209, 0.662799239], [2.70835924, -1.84253848]], [[3.80975986, 2.9083674], [3.35223413, 2.53887939]], [[-4.51619387, -2.602680e+00], [-3.64296031, 4.47810459]]]> : tensor<5x2x2xf32>
    return %0, %1 : tensor<5x6x7xf32>, tensor<5x2x2xf32>
  }
  func.func private @expected() -> tensor<5x6x7xf32> {
    %0 = stablehlo.constant dense<"0x8664953FA321C73FFF98583FDB9B02C0A4762CC0FA59B1BF100D893FDF9A80C02B47BB3F82116BC0961F9EBFE652A740BFC49DBF89BF4FBF52A4A840940CEA3E73BD563F78383040913D1ABC57CB933F0C2CE13DEFC80240B74552BFF9382540BAABED404B621EBF8DFA99C0CAAF1AC01B41DDC00BCEF6BE10710BC0A2A206407914204061B5BE3F9B931AC055E5F13FF30E80C029018EC056F439C02FD03AC062F778401AB2F63F0BF1D740B8CF6C40EA8E2DC040CE1A3F1CB63CBF023B37BFF4CD824034A12AC078BDF83FE6D453C13A8ED7BF11F0AF3F782C473F911F23400B2B09BD0CA05C3FAD6C43C04290163E2934783E05E417409BC74BBDC8493C4007D0E840ADE93BC0DB0A0E40C72043406918F4C0B92E29BE164B793F9343433FD09B7A407E847540A1F117C1CD923740975D873FDFB91EBF6A498A3F0282BA3F6278063E13F82D3F3DE4564097EB1AC0CA531E40254B8EC13BAE29BF2D102B40C11F3B40BA54523F852CD4BF59E36CBF53DF45C0ADA0FF407F079E40B8F17FBFC0628C3FA89316C0D1E48740E81C94402BBBBCC05AC427BC1C1804C0AB03A73E230FBCBFE6F46A3F4757423F01B290C0494EDB3F550E7E40CDD6EC400EE286BFEB79014153088940E14E8840C9E15B405494CDBD00DA1C3E107B8D40427A0BC0F70F863F9FA1B33F0B1D34C0CE191E40C8914BC07BB90C40C8D60A3FCA621F415EED93C093585EC0FD9D96BFF44BE2C0C34502C1C14616407C88144081D84A418C0C263FD7A5A44091E6CBC08689CB40B2BB23C049D811C0123B43C0EB5A96C03AF284BF0EA93FC00E264EC0D659A6BF0C951F40F4918CC0FBB31C40950D433F78B7B23F66693640A0887B41DB850FC0A976D53F956EA4C09915EABFDCF57ABE5B65DABFB0944A4091A6EDBFCDE85FBF89768F4085DDA140A065363F56EEB0BF249659C0579E9540ABEDD73F16345ABFF48C723EB8E74640CD5A29C0F219DDBFE2AB8040DB5601BEA3EE86C085229F400E39813FAC659F3F3CE2723F34EF3C4096108C3F78504141716A4E4006ADCFBF6ABA104046A48ABE8A6FA5402F50763F5B33A2BFC3CAA840FFAD80C08BC451C0576388C14CA20840466348406C7CBF40C520B63F752B11BF489306BEB58FF1BFD7F1C4BEC47D0B40D81E2EC0A4490E3FCE6413BFCFD82B3F"> : tensor<5x6x7xf32>
    return %0 : tensor<5x6x7xf32>
  }
}

