// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf16>, tensor<5x2x2x7xf16>)
    %2 = call @expected() : () -> tensor<5x6x7xf16>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      stablehlo.return %arg1 : tensor<f16>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xf16>, tensor<2x2x1xi32>, tensor<5x2x2x7xf16>) -> tensor<5x6x7xf16>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf16>, tensor<5x6x7xf16>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf16>, tensor<5x2x2x7xf16>) {
    %0 = stablehlo.constant dense<"0xAE2C5FC05DBE50BF4CC4DF412F3C78442E3C0F42DE35A0C3BE3B5DB992C19CC569BF1C40B945E3BA3C38DAB90EBD7F3C24BB8544AAC38E47EF3FC63C56B6E6C595C03534FEC4CDC3F140793B0A422B3F064597456A41C1C4533F75BE5FC4D646F042342BF9417FBDF9BF3C42383FE73EE9C4322EEEB651C272C31BC4D339DCBCCFBD62B5EAB7C33D103D661FF6C196C1533DAEC1D54510C44D3F6F3362C696BBDC38D4BD33C1E94706C08D428BAF2D3C263028400EC3AD42CE3DA1C16F4408BD873C8138133D01C39B463F384AC634C2C138784649BD3C3673387243354092BF063B7441E61826421FC1253EEEC244BCC63A28C1BDB3DF39A83CDFC5E53DDBC083B554BFB54699C17C39693F6944644823C4A3B861AD683E6DC20D3E6224CE42A7439B3FB445B93B43AFD94308425BBB563F6D408F38CBC43A3D58423FC5E2BD78C77D46BA3605C1123DD43D88B3C8336D3C9D43E74075B81732543D14387E3B35C0FC4013C2F1415A41CE4442414C4504C5EA40E9C0DC3A4940983A6C3F4C4173C09CB91EBDEBC50C3F89C0A5B9CABD6DC2A9B5C3C07EB3ABC29FBF214035C288C044C4"> : tensor<5x6x7xf16>
    %1 = stablehlo.constant dense<"0x5F41F140A7425C461F4349438B2E6439274106BFE941C6BB74C1173AD8BA34BB13BEF14242BCFCC07536E04497B9333E2ABC66404B411DBAAD44333BDDC4E8BBBDB80C3E2944E234CBAC1F272EBE2FC068C481C1963668C23C3C1BC04D433BB8BAC0463C17C47ABCD14370C489B6D0C5E334763D4D39F0C619443CBF7C3EA146CBBF4738C5411F430F442DBF163EB13FA7B19D41344143BC2C431AC8FCC1184127BF6A327A3D03C1FD42E432CAC1453A3A444BC473C4A7B95CBB09BEB83E97344BC4353D1639B4C1764125C1C941A3C21CC4F3BE13C005BC83C1FC43BA36313BC8426747A73C47C09DB9A1C27744F5BEFCB99CC0F8B6CCC01FBDB8B79D451C3FFAB1AB3E0023B1453DBD324075C384BA75C5FA3D9E3C613F"> : tensor<5x2x2x7xf16>
    return %0, %1 : tensor<5x6x7xf16>, tensor<5x2x2x7xf16>
  }
  func.func private @expected() -> tensor<5x6x7xf16> {
    %0 = stablehlo.constant dense<"0x5F41F140A7425C461F4349438B2E6439274106BFE941C6BB74C1173AD8BA34BB13BEF14242BCFCC07536E04497B9333E2ABC66404B411DBAEF3FC63C56B6E6C595C03534FEC4CDC3F140793B0A422B3F06459745AD44333BDDC4E8BBBDB80C3E2944E234CBAC1F272EBE2FC068C481C1963668C23C3C1BC04D433BB8BAC0463C17C47ABCD14370C489B6D0C5F6C196C1533DAEC1D54510C44D3F6F3362C696BBDC38D4BD33C1E947E334763D4D39F0C619443CBF7C3EA146CBBF4738C5411F430F442DBF163EB13FA7B19D41344143BC2C431AC8FCC1184127BF6A327A3D03C1063B7441E61826421FC1253EEEC244BCC63A28C1BDB3DF39A83CDFC5FD42E432CAC1453A3A444BC473C4A7B95CBB09BEB83E97344BC4353D1639B4C1764125C1C941A3C21CC4F3BE13C005BC83C1FC43BA36313B8F38CBC43A3D58423FC5E2BD78C77D46BA3605C1123DD43D88B3C833C8426747A73C47C09DB9A1C27744F5BEFCB99CC0F8B6CCC01FBDB8B79D451C3FFAB1AB3E0023B1453DBD324075C384BA75C5FA3D9E3C613F0C3F89C0A5B9CABD6DC2A9B5C3C07EB3ABC29FBF214035C288C044C4"> : tensor<5x6x7xf16>
    return %0 : tensor<5x6x7xf16>
  }
}

