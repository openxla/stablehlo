// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0 = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi32>
    %1:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<5x2x2xf32>)
    %2 = call @expected() : () -> tensor<5x6x7xf32>
    %3 = "stablehlo.scatter"(%1#0, %0, %1#1) ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      stablehlo.return %arg1 : tensor<f32>
    }) {scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true} : (tensor<5x6x7xf32>, tensor<2x2x2xi32>, tensor<5x2x2xf32>) -> tensor<5x6x7xf32>
    %4 = stablehlo.custom_call @check.eq(%3, %2) : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> tensor<i1>
    return %4 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32>, tensor<5x2x2xf32>) {
    %0 = stablehlo.constant dense<"0xBA00184185E87FBDA31C70404CBD353FD11E08BCCB330440D1CC7FBF64378ABF5AEF743F2A0509BF716D00C0FF63843F216D31C00B98423F102A323FAA09EB3F18A4A5BF80D091BEF2E02D405CFB20407D41E8C06833BA3F9B397F3F9CAD1940193486BFACA7A53F65BE33C1A95FD0C0BA90F63FD64B13414FD7AC3E0C4987BF075FA5407C49913E647BB3C063F84BBD6CC494BD5C5552C06A2ED4BFB1D8943F94C474BC3BA97A408158EA3F8A4CA9C0D7A4CE3FE36517BFCA0E01C0F0618B3E69D1A4BE71C803403D43903F61FD834046AD2C400A174A3FB0E92AC0E8A497C01830E9403EE3F4BF4C4CF7C037019C400B0947C0E9A654C07A061D4138906B40799DFC3F30BACD3E887745C0FC29CCBF20FE8BBF698499400F9FE3BF0BAFF9BEE58907BF193EE63F3206A13F2A642FC01C6EDF3F43C9CD3F5134CA4075A437C00B6F4CBFEAC8633F52BA72402E6190BF7F6029C054847C3E71FDA1400217FB3E09542FBF28D28DC0B49BDEBC73CBEA3D3BFFB3C045F6153F8F151D40E42833401E4411C0945C96C0F48E14BF2753AA3F64840FBF1E8CD2BE735D433F70C8E3C05C317440F69F26C0EA1EC33E7239853F6AACDDC09751A83F1581433F07D009C1B63033401AF2E1BFBC64DA3DC5E5054078F32D4039732EC05D299240BD5975BFE3E63740B90F353E35CEAC3F4CBEDABE4028A4C03DDD9C3F43C580400D786340FF29333E784A563F64AADF3FA4FD9BC08EBBE23F40249BBE758AAD3F84D853BF9978114005C485C0D76376C0C8D13C40012E86BFD03F05BF47A92240742DF93FD54D32C0D7FD89BEA66F4EC04C20613FEA7E1CC0B158C23C48BAEA3FAE09D5BF58EA82C06F4F9D40231274401838B73F93944B3F3605C33E9DF3D3C0E21F073F9948AD3FA128BE3D6A6755C0257536C0ABBDE53FE08E034084F453BF101D1C40FB0341C0A574943F80562040C73590BC4C4E48BF3C5A80C0E9439EBF642A243EC38D2D3C9FE293C01CE3A2406B527EC0810B95BEC58723408AF3A93FA43564BF8095BB3F73DCDB3F951D35BFC993A13F2656D43F02643840B8534BC0038C303EBF9230C073C6F73E809229C0A323E2C0864D5DC02B9FC8BE29E72E40C56D8E3F3C376F40A2049E3E474F3340E96757C0FCC27DBFFB2025BE2F79EF3F3CD37D3F56016A40FC76B2BF"> : tensor<5x6x7xf32>
    %1 = stablehlo.constant dense<[[[0.119623557, 1.96830297], [1.03557742, 0.460562527]], [[2.41246986, -2.43538237], [-3.29994321, 1.54218435]], [[6.06444454, -1.64758885], [0.394036144, 0.0968512222]], [[-1.30740643, -0.219225064], [1.27124453, -0.943866848]], [[-0.215699703, 0.792419791], [-4.954310e+00, -4.12602234]]]> : tensor<5x2x2xf32>
    return %0, %1 : tensor<5x6x7xf32>, tensor<5x2x2xf32>
  }
  func.func private @expected() -> tensor<5x6x7xf32> {
    %0 = stablehlo.constant dense<"0xBA00184132FDF43DA31C70404CBD353FD11E08BCCB330440D1CC7FBF64378ABF5AEF743FDACEEB3E716D00C0FF63843F216D31C00B98423F102A323FAA09EB3F18A4A5BF5AF1FB3FF2E02D405CFB20407D41E8C06833BA3F9B397F3F9CAD1940193486BFACA7A53F65BE33C1A95FD0C0CD8D843FD64B13414FD7AC3E0C4987BF075FA5407C49913E647BB3C063F84BBD6CC494BD5C5552C06A2ED4BFB1D8943F94C474BC3BA97A408158EA3FE8651A40D7A4CE3FE36517BFCA0E01C0F0618B3E69D1A4BE71C803403D43903F4C66C53F46AD2C400A174A3FB0E92AC0E8A497C01830E9403EE3F4BF4C4CF7C04EDD1BC00B0947C0E9A654C07A061D4138906B40799DFC3F30BACD3E887745C0FC29CCBF20FE8BBF69849940453253C00BAFF9BEE58907BF193EE63F3206A13F2A642FC01C6EDF3F43C9CD3F5134CA4075A437C00B6F4CBFEAC8633F52BA72402E6190BF7F6029C0EE0FC24071FDA1400217FB3E09542FBF28D28DC0B49BDEBC73CBEA3D3BFFB3C0EF59C63D8F151D40E42833401E4411C0945C96C0F48E14BF2753AA3F64840FBF31E4D2BF735D433F70C8E3C05C317440F69F26C0EA1EC33E7239853F6AACDDC09751A83F1581433F07D009C11BBFC93E1AF2E1BFBC64DA3DC5E5054078F32D4039732EC05D299240BD5975BFE3E63740B90F353E35CEAC3F4CBEDABE4028A4C03DDD9C3F43C580401859A7BFFF29333E784A563F64AADF3FA4FD9BC08EBBE23F40249BBE758AAD3F42A171BF9978114005C485C0D76376C0C8D13C40012E86BFD03F05BF47A92240897C60BED54D32C0D7FD89BEA66F4EC04C20613FEA7E1CC0B158C23C48BAEA3FAE09D5BF58EA82C06F4F9D4024B8A23F1838B73F93944B3F3605C33E9DF3D3C0E21F073F9948AD3FA128BE3D6A6755C0257536C0ABBDE53FE08E034084F453BF101D1C40FB0341C062E05CBE80562040C73590BC4C4E48BF3C5A80C0E9439EBF642A243EC38D2D3C600884C01CE3A2406B527EC0810B95BEC58723408AF3A93FA43564BF8095BB3F06DC4A3F951D35BFC993A13F2656D43F02643840B8534BC0038C303EBF9230C073C6F73E809229C0A323E2C0B5899EC02B9FC8BE29E72E40C56D8E3F3C376F40A2049E3E474F3340E96757C0FCC27DBFFB2025BE2F79EF3F3CD37D3F56016A40FC76B2BF"> : tensor<5x6x7xf32>
    return %0 : tensor<5x6x7xf32>
  }
}

