// RUN-DISABLED: stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt -inline | stablehlo-translate --interpret
// RUN: diff <(stablehlo-translate --deserialize %s.0_9_0.bc | stablehlo-opt) <(stablehlo-opt %s)
// RUN: diff <(stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt) <(stablehlo-opt %s)

module @jit_testcase {
  func.func public @main() -> tensor<i1> {
    %0:2 = call @inputs() : () -> (tensor<2x8x8xf32>, tensor<2x10x8xf32>)
    %1 = call @expected() : () -> tensor<2x10x8xf32>
    %2 = "stablehlo.triangular_solve"(%0#0, %0#1) {left_side = false, lower = false, transpose_a = #stablehlo<transpose NO_TRANSPOSE>, unit_diagonal = false} : (tensor<2x8x8xf32>, tensor<2x10x8xf32>) -> tensor<2x10x8xf32>
    %3 = stablehlo.custom_call @check.eq(%2, %1) : (tensor<2x10x8xf32>, tensor<2x10x8xf32>) -> tensor<i1>
    return %3 : tensor<i1>
  }
  func.func private @inputs() -> (tensor<2x8x8xf32>, tensor<2x10x8xf32>) {
    %0 = stablehlo.constant dense<"0xCB08873E749FC8C0823DE7BF57DF23C04D6FF6BD635E08BF8C1F44C02EE382405FA754C00FE208C04347CC3F264E0DBFAD9D0FBF45E1543FFCF38C40DA0F2BC151AC62BE3FD0DF3E66BF89BD19DB1EBE29E39EBF7C3EC140B3DA7B4034B35340EBF7913F0135A2BE0BEB963FE2A459BF60953D40954E214063C9573FDB3E9C40D28B76406EAD0DC0A2909ABF0F6E3840C04E2CC0ED701AC06335B53F61A8EFBB16CE1D409758AF3F7839BBBF01AFCBBF7F97C13FFE7ACCBFFCD9E7C08260113F2CA410C02A431740E7A9433F08E8A0C0589260C019412B3F6B287EBD3B378B40EA5BA44014B303C004386740CAD224BF7C0060C099A95DC08087ABBFC3CDB0C0AFE1F0BF7C6C8D3E81E7EF3D17548A3F27BA89C00AFB03BF592FDCBF07913B403D641A40F627A0BF95AA0FBFF835B73F335D18C090344AC07644F63FA251C5BF49CABEBFC65E1FC0A8D8244047420640B2428340DF7E5EC0312521BF708741C0C6B316C02673033D632049BD8990F03E9F359B40CAA3003F10576BBF1277354023062F3F5198A5BE2C76C64033A910C093F82840E55565C00BCA1AC05CB716C1380451404B1A83BF85C019C0E1DFADBFE442323FE7694DBF12B1ADC0A61545C0662149BF7671B6C0BD0C0F3F230545BF7AC83040BB95D03F126AA7BFC533C2BE2C372DC02203C2BE0B4AEFBFD4580FC09FB613402706C440098C09C0920E06C0"> : tensor<2x8x8xf32>
    %1 = stablehlo.constant dense<"0x8A16AA3F3A70ECBE196D29C0EB9FB5BD1D1E453F6716F340A285A6405DF77FBF6EB33240137CAFC03886053F2FDBA6406F95CA4045DED0BF54E81F3FF48280BFB23877C0087AC2BED21B9A3FBEFE6E4075BD55406EFB55401D06AD40D30983400ADEBF40C9BD56C04CDFCF3DE5557ABF4297953F59141FC0C4211CC0588E18BE140D9340756705C1EE1CBC3F2B9040403B2458C0D90986C0DFAC0EC067C99E3F03B2FEBDEB33CEBF7278913F5E094EC056BAB6402309AABFF4240F4034E0EA3F98B6D2BEB49231C0770DCFBE2E1709C01393473EB92257BF710900413FD95940F02F0EC02905AFBF4147FBBFEDCBEDBE564D82BFE97D03C0F95B16BF9F29FC3E6A2CFA40695086C0B63707BF20CABAC08AB0B7BEDFB88BC022FB64C034374EC08168693EC54480BF223CD6BFCD3D55C0EF03114055D81940018538C09737E8C0139FB83E7A7970409CA0B53E29FA78BF6ECB6BC0555FAC3F5AB906C0BE0ACEBEF22BAAC07BDA19C0A285D23F0C2F40C000441FC00F36724086F71DC0E16F8DC0F4F7E7BF6B1466C0DF95B5BF86B4663F715AFC3F8EDC4840A576713FB84F38C0ED53D3C02EEC81BDEF38E3BFEBBAEFBFCF0912409333123FF85FC5C0746B70402BDD0F40D14AA3BF939458BF67E3323E893467C052E85BC0FAE942C01F179FC0A04587BF5EAF7140EB74254067A9513F9BE0B43F33B0223F5C157640A842A4401F70D7BF327C38406F40FABF832193C080735F400C265AC0CB8D14C0D8507240CAD33BC0CE298240985D1B40590417BBEA1C12C0569D5F3F93693AC0112A993F23017ABF31146E3F0C2BE8BF73E328C0F5A40A41482F3BC0E5E516C0C2E38140D95620BFF380D3C0B6AD873EB3FD9DC0066A85407AD78B3FC6DF00BF587183C0"> : tensor<2x10x8xf32>
    return %0, %1 : tensor<2x8x8xf32>, tensor<2x10x8xf32>
  }
  func.func private @expected() -> tensor<2x10x8xf32> {
    %0 = stablehlo.constant dense<"0x473AA14056D968C112A4DCC3E5CC95429131904338F3F9C4A2C44E48567222484F642941E2C1E3C1FEE871C460081D436E811B44717888C5D2BEE1484059B148CC576AC165712C427BCDAE44847173C30C8B66C4AF83C545909123C9BA8100C955DFB541A92482C250C206C5AF2EB8436670B0443E3618C657037C4970FD454908648B4177B43CC29927C9C49920864303ED8244702FE3C5E1083C4969B91349716DF1BEE0AA0840E4BF39426CE694C02A99E8C196385643CC00B1C68B0D8BC690BCC7BF6EE2BB40A03D3B436E12F6C1A1CBF2C2A6B05344526EAFC703D389C7C1C706C1C9A7CA41232156441BD212C3003E0CC440ED7145C14EC8C83C5E9DC82624ED41B8DBA9C256382FC5A225F2430B3EE64413EE45C63EE1A34916C08049D13F5D3FAA2604C0A14B3DC242AC3441492C07421FFE56C34CC8B246F9808C46713544BE38E642C0A05E04BF844D1F415A88AFC10ACCE942D1F5E2C30F33CB4125DA344038E322404E43883F002DCBC14CD94B425F5484C322D67F44E27F64C20F87763F7E7D4540E0409F3D34B620C1FE72BB41F0E4FFC2B49CF8431D86A4C164976040574D533F87402BBF725D39C19037ED41A7FE0EC3E4170944B2860AC2ACE498BFFB81413F1623E0BD2A0EA73FDE919BC0209BC841C2DAB5C2A423624014C30F3FB23939C02EF7B13E3DEAF64074FD7DC13AECA842B457A7C318D89141A0F5643FDBCE06C0A21BA1BF9C36463E1BC81E4056CACE40A0BE05C2177A38C1AA9DC73F57063AC070FC733EDA5D8640E07010C184114D42DC3A4BC382E3314104D9043F3AF320BF30625DBFD34E84BF60B7D94058FAABC1B5F09B42272D60C11167AA3EA163AB40A099A03F00C404C2DDF483425BC4ABC399C6A644D408A3C2"> : tensor<2x10x8xf32>
    return %0 : tensor<2x10x8xf32>
  }
}
